<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Android 坐标系和 View 滑动方法 - l0neman 的博客</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="l0neman 的博客"><meta name="msapplication-TileImage" content="/img/avatar.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="l0neman 的博客"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Android 二维坐标系和 Java 图形化界面开发类似，Android 中也有一种坐标系，这里说说二维平面的坐标系，在 Android 中，坐标系起始点以左上角为原点，竖直向下是 y 轴的方向，横向向右是 x 轴延伸方向，对于 Android 中的 View 来说，它本身所具有的一些位置相关的参数会根据这个坐标系来确定数值和正负，掌握这些有助于理解 View 在布局层次中所处位置的意义。 下面"><meta property="og:type" content="blog"><meta property="og:title" content="Android 坐标系和 View 滑动方法"><meta property="og:url" content="https://l0neman.github.io/2019/02/12/android-%E5%9D%90%E6%A0%87%E7%B3%BB%E5%92%8C-view-%E6%BB%91%E5%8A%A8%E6%96%B9%E6%B3%95/"><meta property="og:site_name" content="l0neman 的博客"><meta property="og:description" content="Android 二维坐标系和 Java 图形化界面开发类似，Android 中也有一种坐标系，这里说说二维平面的坐标系，在 Android 中，坐标系起始点以左上角为原点，竖直向下是 y 轴的方向，横向向右是 x 轴延伸方向，对于 Android 中的 View 来说，它本身所具有的一些位置相关的参数会根据这个坐标系来确定数值和正负，掌握这些有助于理解 View 在布局层次中所处位置的意义。 下面"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://l0neman.github.io/2019/02/12/android-%E5%9D%90%E6%A0%87%E7%B3%BB%E5%92%8C-view-%E6%BB%91%E5%8A%A8%E6%96%B9%E6%B3%95/base_view_coordinate.png"><meta property="og:image" content="https://l0neman.github.io/2019/02/12/android-%E5%9D%90%E6%A0%87%E7%B3%BB%E5%92%8C-view-%E6%BB%91%E5%8A%A8%E6%96%B9%E6%B3%95/target_view_motion_event.png"><meta property="og:image" content="https://l0neman.github.io/2019/02/12/android-%E5%9D%90%E6%A0%87%E7%B3%BB%E5%92%8C-view-%E6%BB%91%E5%8A%A8%E6%96%B9%E6%B3%95/target_view_position.png"><meta property="og:image" content="https://l0neman.github.io/2019/02/12/android-%E5%9D%90%E6%A0%87%E7%B3%BB%E5%92%8C-view-%E6%BB%91%E5%8A%A8%E6%96%B9%E6%B3%95/target_view_position.png"><meta property="og:image" content="https://l0neman.github.io/2019/02/12/android-%E5%9D%90%E6%A0%87%E7%B3%BB%E5%92%8C-view-%E6%BB%91%E5%8A%A8%E6%96%B9%E6%B3%95/view_scroll_scroll_to.png"><meta property="og:image" content="https://l0neman.github.io/2019/02/12/android-%E5%9D%90%E6%A0%87%E7%B3%BB%E5%92%8C-view-%E6%BB%91%E5%8A%A8%E6%96%B9%E6%B3%95/target_scroll_layout_fun.png"><meta property="og:image" content="https://l0neman.github.io/2019/02/12/android-%E5%9D%90%E6%A0%87%E7%B3%BB%E5%92%8C-view-%E6%BB%91%E5%8A%A8%E6%96%B9%E6%B3%95/view_scroll_layout_params.png"><meta property="og:image" content="https://l0neman.github.io/2019/02/12/android-%E5%9D%90%E6%A0%87%E7%B3%BB%E5%92%8C-view-%E6%BB%91%E5%8A%A8%E6%96%B9%E6%B3%95/drag.gif"><meta property="og:image" content="https://l0neman.github.io/2019/02/12/android-%E5%9D%90%E6%A0%87%E7%B3%BB%E5%92%8C-view-%E6%BB%91%E5%8A%A8%E6%96%B9%E6%B3%95/drag_auto_back.gif"><meta property="article:published_time" content="2019-02-12T10:51:22.000Z"><meta property="article:modified_time" content="2019-02-12T10:51:22.000Z"><meta property="article:author" content="l0neman"><meta property="article:tag" content="Android"><meta property="article:tag" content="View"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="./base_view_coordinate.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://l0neman.github.io/2019/02/12/android-%E5%9D%90%E6%A0%87%E7%B3%BB%E5%92%8C-view-%E6%BB%91%E5%8A%A8%E6%96%B9%E6%B3%95/"},"headline":"Android 坐标系和 View 滑动方法","image":["https://l0neman.github.io/2019/02/12/android-%E5%9D%90%E6%A0%87%E7%B3%BB%E5%92%8C-view-%E6%BB%91%E5%8A%A8%E6%96%B9%E6%B3%95/base_view_coordinate.png","https://l0neman.github.io/2019/02/12/android-%E5%9D%90%E6%A0%87%E7%B3%BB%E5%92%8C-view-%E6%BB%91%E5%8A%A8%E6%96%B9%E6%B3%95/target_view_motion_event.png","https://l0neman.github.io/2019/02/12/android-%E5%9D%90%E6%A0%87%E7%B3%BB%E5%92%8C-view-%E6%BB%91%E5%8A%A8%E6%96%B9%E6%B3%95/target_view_position.png","https://l0neman.github.io/2019/02/12/android-%E5%9D%90%E6%A0%87%E7%B3%BB%E5%92%8C-view-%E6%BB%91%E5%8A%A8%E6%96%B9%E6%B3%95/target_view_position.png","https://l0neman.github.io/2019/02/12/android-%E5%9D%90%E6%A0%87%E7%B3%BB%E5%92%8C-view-%E6%BB%91%E5%8A%A8%E6%96%B9%E6%B3%95/view_scroll_scroll_to.png","https://l0neman.github.io/2019/02/12/android-%E5%9D%90%E6%A0%87%E7%B3%BB%E5%92%8C-view-%E6%BB%91%E5%8A%A8%E6%96%B9%E6%B3%95/target_scroll_layout_fun.png","https://l0neman.github.io/2019/02/12/android-%E5%9D%90%E6%A0%87%E7%B3%BB%E5%92%8C-view-%E6%BB%91%E5%8A%A8%E6%96%B9%E6%B3%95/view_scroll_layout_params.png","https://l0neman.github.io/2019/02/12/android-%E5%9D%90%E6%A0%87%E7%B3%BB%E5%92%8C-view-%E6%BB%91%E5%8A%A8%E6%96%B9%E6%B3%95/drag.gif","https://l0neman.github.io/2019/02/12/android-%E5%9D%90%E6%A0%87%E7%B3%BB%E5%92%8C-view-%E6%BB%91%E5%8A%A8%E6%96%B9%E6%B3%95/drag_auto_back.gif"],"datePublished":"2019-02-12T10:51:22.000Z","dateModified":"2019-02-12T10:51:22.000Z","author":{"@type":"Person","name":"l0neman"},"publisher":{"@type":"Organization","name":"l0neman 的博客","logo":{"@type":"ImageObject","url":"https://l0neman.github.io/img/logo.png"}},"description":"Android 二维坐标系和 Java 图形化界面开发类似，Android 中也有一种坐标系，这里说说二维平面的坐标系，在 Android 中，坐标系起始点以左上角为原点，竖直向下是 y 轴的方向，横向向右是 x 轴延伸方向，对于 Android 中的 View 来说，它本身所具有的一些位置相关的参数会根据这个坐标系来确定数值和正负，掌握这些有助于理解 View 在布局层次中所处位置的意义。 下面"}</script><link rel="canonical" href="https://l0neman.github.io/2019/02/12/android-%E5%9D%90%E6%A0%87%E7%B3%BB%E5%92%8C-view-%E6%BB%91%E5%8A%A8%E6%96%B9%E6%B3%95/"><link rel="icon" href="/img/avatar.png"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.15.2/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?1727d76e0a823184efc8776f32a916a9";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="l0neman 的博客" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/l0neman"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-three-quarters"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-02-12T10:51:22.000Z" title="2019/2/12 下午6:51:22">2019-02-12</time>发表</span><span class="level-item"><time dateTime="2019-02-12T10:51:22.000Z" title="2019/2/12 下午6:51:22">2019-02-12</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/android-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/">Android 应用开发</a></span><span class="level-item">1 小时读完 (大约6851个字)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">Android 坐标系和 View 滑动方法</h1><div class="content"><h2 id="Android-二维坐标系"><a href="#Android-二维坐标系" class="headerlink" title="Android 二维坐标系"></a>Android 二维坐标系</h2><p>和 Java 图形化界面开发类似，Android 中也有一种坐标系，这里说说二维平面的坐标系，在 Android 中，坐标系起始点以左上角为原点，竖直向下是 y 轴的方向，横向向右是 x 轴延伸方向，对于 Android 中的 View 来说，它本身所具有的一些位置相关的参数会根据这个坐标系来确定数值和正负，掌握这些有助于理解 View 在布局层次中所处位置的意义。</p>
<p>下面用一个典型例子来说明 Android 中的坐标系：</p>
<span id="more"></span>

<p><img src="./base_view_coordinate.png"></p>
<p>上图中的布局包含两个 View，一个是外层的 <code>parent view</code> 和内部的一个 <code>child view</code>，其中 <code>parent view</code> 设置了 <code>padding=&quot;16dp&quot;</code> 的属性，<code>child view</code> 设置了 <code>layout_margin=&quot;16dp&quot;</code> 的属性，为了更明显的表现布局的，其中绿色区域表示 <code>parent view</code> 设置 <code>padding</code> 后绘制子 View 的区域，灰色区域表示 <code>child view</code> 设置 <code>margin</code> 值后所占的空间。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- parent view --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">com.runing.corrdinateandscroll.ScrollerLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/fl_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;240dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">&quot;@color/colorPrimary&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:padding</span>=<span class="string">&quot;16dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;com.runing.corrdinateandscroll.MainActivity&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">2<span class="comment">&lt;!-- child view --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/iv_target&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;120dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;120dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_margin</span>=<span class="string">&quot;16dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:contentDescription</span>=<span class="string">&quot;@string/app_name&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:src</span>=<span class="string">&quot;@drawable/img0&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">com.runing.corrdinateandscroll.ScrollerLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>下面分主要从和几个角度分析和 <code>child view</code> 相关的坐标参数</p>
<h3 id="Parent-View"><a href="#Parent-View" class="headerlink" title="Parent View"></a>Parent View</h3><p>下面两个方法都是对 <code>child view</code> 调用的，他们返回的是两个重要位置参数的值，<code>mScrollX</code> 和 <code>mScrollY</code></p>
<ul>
<li><code>getScrollX</code> 返回相对于 View 左边缘 x 轴滑动的偏移量，它会影响 View 内容的绘制位置，如果向右偏移，返回的都是负值，反之返回正值，下面会细说它的含义。</li>
<li><code>getScrollY</code> 返回相对于 View 上边缘 y 轴滑动的偏移量，如果向下偏移，返回的都是负值，反之返回正值。</li>
</ul>
<h3 id="Motion-Event"><a href="#Motion-Event" class="headerlink" title="Motion Event"></a>Motion Event</h3><p>现在假设在 <code>child view</code> 上发生一个触摸事件，下面的这些方法将会从 <code>child view</code> 的 <code>onTouchEvent(MotionEvent event)</code> 或者 <code>onTouchListener</code> 的 <code>onTouch(MotionEvent event)</code> 方法中的 <code>event</code> 对象中获取值。</p>
<p><img src="./target_view_motion_event.png"></p>
<ul>
<li><code>getRawX</code> 触摸事件发生点相对屏幕左边缘的 x 轴偏移，因为触点一定会在屏幕内，所以一直是正值。</li>
<li><code>getRawY</code> 触摸事件发生点相对屏幕上边缘的 y 轴偏移，同上一直会是正值。</li>
<li><code>getX</code> <code>child view</code> 触摸事件发生点相对自身左边缘的 x 轴偏移，如果触点在自身左边缘的左边，值会为负。</li>
<li><code>getY</code> <code>child view</code> 触摸事件发生点相对自身上边缘的 y 轴偏移，如果触点在自身上边缘的上面，值会为负。</li>
</ul>
<h3 id="Child-View"><a href="#Child-View" class="headerlink" title="Child View"></a>Child View</h3><p>下图是一个 View 调用 <code>setTranslation</code> 的方法使 View 发生偏移前后的两个 View 的位置。</p>
<p><img src="./target_view_position.png"></p>
<p>下以的方法均是针对 <code>child view</code> 来说的。</p>
<ul>
<li><code>getLeft</code> <code>child view</code> 左边缘距离 <code>parent view</code> 左边缘的 x 轴偏移量，相对于 <code>parent view</code> 右边时为正数。由图上看出，<code>getLeft</code> 的值会受到 <code>parent view</code> 的 <code>padding</code> 和 <code>child view</code> 自身的 <code>layout_margin</code>  属性的影响。</li>
<li><code>getTop</code> <code>child view</code> 上边缘距离 <code>parent view</code> 上边缘的 y 轴偏移量，相对于 <code>parent view</code> 偏下时为正数，<code>getTop</code> 的值会受到 <code>parent view</code> 的 <code>padding</code> 和 <code>child view</code> 自身的 <code>layout_margin</code>  属性的影响。</li>
<li><code>getRight</code> <code>child view</code> 右边缘距离 <code>parent view</code> 左边缘的 x 轴偏移量，即 <code>getLeft</code> 加view自身宽度。</li>
<li><code>getBottom</code> <code>child view</code> 下边缘距离 <code>parent view</code> 上边缘的 y 轴偏移量，即 <code>getRight</code> 加view自身高度。</li>
<li><code>getTranslationX</code> <code>child view</code> 相于自身 <code>getLeft</code> 向右的 x 轴偏移量，改变这个值不会改变 <code>getLeft</code> 的值。</li>
<li><code>getTranslationY</code> <code>child view</code> 相于自身 <code>getTop</code> 向下的 y 轴偏移量，改变这个值不会改变 <code>getTop</code> 的值。</li>
<li><code>getX</code> <code>child view</code> 发生 translationX 平移后的自身左边缘距离 <code>parent view</code> 左边缘的 x 轴偏移，即 <code>getLeft + getTranslationX </code>。</li>
<li><code>getY</code> <code>child view</code> 发生 translationY 平移后的自身左边缘距离 <code>parent view</code> 左边缘的 y 轴偏移，即 <code>getTop + getTranslationY </code>。</li>
</ul>
<p>上面只是简单列举了 Android 中与 View 中坐标相关的一些属性，下面将介绍 View 滑动的几种方法，了解上面这些有助于理解 View 滑动的一些原理，下面将会把这些知识融入到 View 滑动的实例中去。</p>
<h2 id="View-滑动方法"><a href="#View-滑动方法" class="headerlink" title="View 滑动方法"></a>View 滑动方法</h2><p>下面通过一个实例的实现来介绍 5 种 View 的滑动方法，并用这些方法实现相同需求的 View 滑动示例。</p>
<h3 id="拖拽滑动实例"><a href="#拖拽滑动实例" class="headerlink" title="拖拽滑动实例"></a>拖拽滑动实例</h3><p>首先确定实例需求，基于上面的条件来确定一些需求，并依次递进实现每一个需求：</p>
<ol>
<li>一个 ViewGroup 中放置一个 ImageView</li>
<li>其中可以使用手指触摸和拖动其中的ImageView，并让其跟随触摸点自由移动。</li>
<li>在拖动过程中需要保证ImageView只能在ViewGroup的范围内滑动，并保持ViewGroup设置的 <code>padding</code> 属性和ImageView设置的 <code>layout_margin</code> 属性依然有效。</li>
<li>模拟悬浮窗的横向吸附效果，当松手时，如果ImageView偏左，则ImageView会平滑吸附到ViewGroup的左边缘，反之吸附到右边缘。</li>
</ol>
<p>针对以上需求，使用以下 5 种方法一一实现，其中第 4 个需求属于弹性滑动也就是平滑滚动，这里先实现上面 3 种需求。</p>
<p>现在在外部对 ImageView 设置 <code>OnTouchListener</code> 来监听它的触摸事件，使用两个变量来标记手指按下的坐标，在手指移动时即可计算平移的偏移量，注意 <code>onTouch</code> 返回 <code>true</code> 来消耗事件，其中计算的偏移量将作为滑动的基础数值，对于每种滑动都会针对这个偏移值进行处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> mLastX;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> mLastY;</span><br><span class="line">mTarget.setOnTouchListener(<span class="keyword">new</span> View.OnTouchListener() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> x = (<span class="keyword">int</span>) event.getX();</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> y = (<span class="keyword">int</span>) event.getY();</span><br><span class="line">        <span class="keyword">switch</span> (event.getActionMasked()) &#123;</span><br><span class="line">          <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">            <span class="comment">/* 手指按下的坐标 */</span></span><br><span class="line">            mLastX = x;</span><br><span class="line">            mLastY = y;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">            <span class="comment">/* 偏移量 */</span></span><br><span class="line">            <span class="keyword">int</span> xOffset = x - mLastX;</span><br><span class="line">            <span class="keyword">int</span> yOffset = y - mLastY;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>



<h3 id="Translation"><a href="#Translation" class="headerlink" title="Translation"></a>Translation</h3><p>使用 View 的 <code>setTranslationX</code> 和 <code>setTranslationY</code> 方法可直接使 View 发生平移，所以让 View 根据偏移滑动可以这样写，其中累加 <code>getTranslation</code> 的结果是为了基于当前位置滑动，而不是从头开始：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">scrollByOffset</span><span class="params">(<span class="keyword">int</span> xOffset, <span class="keyword">int</span> yOffset)</span> </span>&#123;</span><br><span class="line">  mTarget.setTranslationX(mTarget.getTranslationX() + xOffset);</span><br><span class="line">  mTarget.setTranslationY(mTarget.getTranslationY() + yOffset);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样 View 就会跟随手指滑动了，接下来开始限制 View 滑动范围，逻辑就是先计算出 <code>translation</code> 在 x 轴和 y 轴的滑动上限和下限，再判断新的 <code>translation</code> 位置否超出限制，如果超出限制，则重新设置原始偏移值在范围内。</p>
<p>这里由于初始位置的 <code>translationX</code> 和 <code>translationY</code> 都为 0，则他们的下限就是 0</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> transXLowerLimit = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> transYLowerLimit = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>假设 View 已经通过 <code>translation</code> 滑动到右下角边缘，现在可以计算出上限了。</p>
<p><img src="./target_view_position.png"></p>
<p>从图上简单分析，很容易就能计算了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 其中P = Padding，M = Margin，W = width，H = height</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> transXUpperLimit = mParentW - mTargetW - mParentPL - mParentPR - mTargetML - mTargetMR;</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> transYUpperLimit = mParentH - mTargetH - mParentPT - mParentPB - mTargetMT - mTargetMB;</span><br></pre></td></tr></table></figure>

<p>那么根据这四个变量值即可限制 <code>translation</code> 的变化，下面是完整代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用 translation 的方法进行滑动</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startScrollWithTranslation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  mTarget.setOnTouchListener(<span class="keyword">new</span> View.OnTouchListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent event)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">int</span> x = (<span class="keyword">int</span>) event.getX();</span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">int</span> y = (<span class="keyword">int</span>) event.getY();</span><br><span class="line">      <span class="keyword">switch</span> (event.getActionMasked()) &#123;</span><br><span class="line">        <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">          stopAllAnimAndThread();</span><br><span class="line">          mLastX = x;</span><br><span class="line">          mLastY = y;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">          <span class="keyword">int</span> xOffset = x - mLastX;</span><br><span class="line">          <span class="keyword">int</span> yOffset = y - mLastY;</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> oldTransX = (<span class="keyword">int</span>) mTarget.getTranslationX();</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> newTransX = oldTransX + xOffset;</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> transXLowerLimit = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">if</span> (newTransX &lt; transXLowerLimit) &#123;</span><br><span class="line">            <span class="comment">/* 重新设置偏移量，使其在范围内滚动，下同 */</span></span><br><span class="line">            xOffset = transXLowerLimit - oldTransX;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> transXUpperLimit = mParentW - mTargetW - mParentPL - mParentPR - mTargetML - mTargetMR;</span><br><span class="line">          <span class="keyword">if</span> (newTransX &gt; transXUpperLimit) &#123;</span><br><span class="line">            xOffset = transXUpperLimit - oldTransX;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> oldTransY = (<span class="keyword">int</span>) mTarget.getTranslationY();</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> newTransY = oldTransY + yOffset;</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> transYLowerLimit = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">if</span> (newTransY &lt; transYLowerLimit) &#123;</span><br><span class="line">            yOffset = transYLowerLimit - oldTransY;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> transYUpperLimit = mParentH - mTargetH - mParentPT - mParentPB - mTargetMT - mTargetMB;</span><br><span class="line">          <span class="keyword">if</span> (newTransY &gt; transYUpperLimit) &#123;</span><br><span class="line">            yOffset = transYUpperLimit - oldTransY;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          scrollByOffset(xOffset, yOffset);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样就完成了第一种方法了。</p>
<h3 id="Scroll-To"><a href="#Scroll-To" class="headerlink" title="Scroll To"></a>Scroll To</h3><p><code>scrollTo</code> 和 <code>scrollBy</code> 可以对 View 的绘制内容进行滑动，实质上是对 Canvas 绘制区域的滚动。下面是 View 的 <code>draw(Canvas canvas)</code> 的部分源码，可以体现 <code>scrollTo</code> 方法对绘制的影响。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* mScrollX影响left的取值 */</span></span><br><span class="line"><span class="keyword">int</span> left = mScrollX + paddingLeft;</span><br><span class="line"><span class="keyword">int</span> right = left + mRight - mLeft - mPaddingRight - paddingLeft;</span><br><span class="line"><span class="keyword">int</span> top = mScrollY + getFadeTop(offsetRequired);</span><br><span class="line"><span class="keyword">int</span> bottom = top + getFadeHeight(offsetRequired);</span><br><span class="line">...</span><br><span class="line"><span class="keyword">if</span> (solidColor == <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> flags = Canvas.HAS_ALPHA_LAYER_SAVE_FLAG;</span><br><span class="line">  <span class="keyword">if</span> (drawTop) &#123;</span><br><span class="line">    canvas.saveLayer(left, top, right, top + length, <span class="keyword">null</span>, flags);</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">if</span> (drawTop) &#123;</span><br><span class="line">  matrix.setScale(<span class="number">1</span>, fadeHeight * topFadeStrength);</span><br><span class="line">  matrix.postTranslate(left, top);</span><br><span class="line">  fade.setLocalMatrix(matrix);</span><br><span class="line">  p.setShader(fade);</span><br><span class="line">  canvas.drawRect(left, top, right, top + length, p);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中的 <code>mScrollX</code> 和 <code>mScrollY</code> 的值，会受到 <code>scrollTo</code> 的影响而发生改变 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Set the scrolled position of your view. This will cause a call to</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> #onScrollChanged(int, int, int, int)&#125; and the view will be</span></span><br><span class="line"><span class="comment"> * invalidated.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> x the x position to scroll to</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> y the y position to scroll to</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scrollTo</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (mScrollX != x || mScrollY != y) &#123;</span><br><span class="line">    <span class="keyword">int</span> oldX = mScrollX;</span><br><span class="line">    <span class="keyword">int</span> oldY = mScrollY;</span><br><span class="line">    mScrollX = x;</span><br><span class="line">    mScrollY = y;</span><br><span class="line">    invalidateParentCaches();</span><br><span class="line">    onScrollChanged(mScrollX, mScrollY, oldX, oldY);</span><br><span class="line">    <span class="keyword">if</span> (!awakenScrollBars()) &#123;</span><br><span class="line">      postInvalidateOnAnimation();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>scollBy</code> 帮我们处理了相对当前位置滑动的问题。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Move the scrolled position of your view. This will cause a call to</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> #onScrollChanged(int, int, int, int)&#125; and the view will be</span></span><br><span class="line"><span class="comment"> * invalidated.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> x the amount of pixels to scroll by horizontally</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> y the amount of pixels to scroll by vertically</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scrollBy</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">  scrollTo(mScrollX + x, mScrollY + y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里需要让 ImageView 滑动，就是调用 <code>parent view</code> 的 <code>scrollBy</code> 方法，来进行内容的滑动，但是有一个弊端是，<code>parent view</code>内部的所有子 View 都会滑动，这里只不过这里只有一个 <code>child view</code>，而且 <code>scrollTo</code> 并不只限制于ViewGroup，还可以对View进行内容的滑动，比如ImageView中可对内部的图片进行滑动，如果扩展一下，就可以做出一个图片浏览控件。</p>
<p>下面根据之前 <code>translation</code> 的套路，还是先实现自由滚动，上代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">scrollByOffset</span><span class="params">(<span class="keyword">int</span> xOffset, <span class="keyword">int</span> yOffset)</span> </span>&#123;</span><br><span class="line">  mParent.scrollBy(-xOffset, -yOffset);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于 scroll 和坐标系方向是相反的，所以这里为负值。接下来计算上限和下限。</p>
<p>下限默认是 0，上限也和之前 <code>translation</code> 的计算结果是相同的。</p>
<p><img src="./view_scroll_scroll_to.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> scrollXLowerLimit = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> scrollYLowerLimit = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> scrollXUpperLimit = mParentW - mTargetW - mParentPL - mParentPR - mTargetML - mTargetMR;</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> scrollYUpperLimit = mParentH - mTargetH - mParentPT - mParentPB - mTargetMT - mTargetMB;</span><br></pre></td></tr></table></figure>

<p>得到最终偏移值的完整代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用 scroll to 的方法进行滑动</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startScrollWithScrollTo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  mTarget.setOnTouchListener(<span class="keyword">new</span> View.OnTouchListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent event)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">int</span> x = (<span class="keyword">int</span>) event.getX();</span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">int</span> y = (<span class="keyword">int</span>) event.getY();</span><br><span class="line">      <span class="keyword">switch</span> (event.getActionMasked()) &#123;</span><br><span class="line">        <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">          mLastX = x;</span><br><span class="line">          mLastY = y;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">          <span class="keyword">int</span> xOffset = x - mLastX;</span><br><span class="line">          <span class="keyword">int</span> yOffset = y - mLastY;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> oldScrollX = -mParent.getScrollX();</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> newScrollX = oldScrollX + xOffset;</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> scrollXLowerLimit = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">if</span> (newScrollX &lt; scrollXLowerLimit) &#123;</span><br><span class="line">            xOffset = scrollXLowerLimit - oldScrollX;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> scrollXUpperLimit = mParentW - mTargetW - mParentPL - mParentPR - mTargetML - mTargetMR;</span><br><span class="line">          <span class="keyword">if</span> (newScrollX &gt; scrollXUpperLimit) &#123;</span><br><span class="line">            xOffset = scrollXUpperLimit - oldScrollX;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> oldScrollY = -mParent.getScrollY();</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> newScrollY = oldScrollY + yOffset;</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> scrollYLowerLimit = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">if</span> (newScrollY &lt; scrollXLowerLimit) &#123;</span><br><span class="line">            yOffset = scrollYLowerLimit - oldScrollY;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> scrollYUpperLimit = mParentH - mTargetH - mParentPT - mParentPB - mTargetMT - mTargetMB;</span><br><span class="line">          <span class="keyword">if</span> (newScrollY &gt; scrollYUpperLimit) &#123;</span><br><span class="line">            yOffset = scrollYUpperLimit - oldScrollY;</span><br><span class="line">          &#125;</span><br><span class="line">          scrollByOffset(xOffset, yOffset);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Layout-Fun"><a href="#Layout-Fun" class="headerlink" title="Layout Fun"></a>Layout Fun</h3><p>使用 <code>layout</code> 方法对目标 View 进行重新布局，也可以做到对 View 的滑动，那么对于针对偏移的滑动就可以这样写：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">scrollByOffset</span><span class="params">(<span class="keyword">int</span> xOffset, <span class="keyword">int</span> yOffset)</span> </span>&#123;</span><br><span class="line">  mTarget.layout(mTarget.getLeft() + xOffset, mTarget.getTop() + yOffset,</span><br><span class="line">                 mTarget.getRight() + xOffset, mTarget.getBottom() + yOffset);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意这种方法只是在滑动时临时改变 View 的 <code>mLeft,mRight,mTop,mBottom</code> 属性，如果 View 重新调用 <code>requesstLayout</code> 方法请求布局的重绘，View 将会重新回到初始位置，可以提前保存 View 的位置。</p>
<p>接下来是计算 layout 绘制的上下限：</p>
<p><img src="./target_scroll_layout_fun.png"></p>
<p>可以看出，View 的 <code>getLeft</code> 是有初始值的，同理 <code>getTop</code> 也是一样，那么这就是它们的下限。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 原始left值，也可以在前面直接保存getLeft值，这里重新计算了left值 */</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> leftLowerLimit = mParentPL + mTargetML;</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> topLowerLimit = mParentPT + mTargetMT;</span><br></pre></td></tr></table></figure>

<p>那么上限就是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> leftUpperLimit = mParentW - mTargetW - mParentPR - mTargetMR;</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> topUpperLimit = mParentH - mTargetH - mParentPB - mTargetMB;</span><br></pre></td></tr></table></figure>

<p>由此可以限制偏移值了，完整代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用 layout 方法进行滑动</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startScrollWithOffsetFun</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  mTarget.setOnTouchListener(<span class="keyword">new</span> View.OnTouchListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent event)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">int</span> x = (<span class="keyword">int</span>) event.getX();</span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">int</span> y = (<span class="keyword">int</span>) event.getY();</span><br><span class="line">      <span class="keyword">switch</span> (event.getActionMasked()) &#123;</span><br><span class="line">        <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">          stopAllAnimAndThread();</span><br><span class="line">          mLastX = x;</span><br><span class="line">          mLastY = y;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">          <span class="keyword">int</span> xOffset = x - mLastX;</span><br><span class="line">          <span class="keyword">int</span> yOffset = y - mLastY;</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> oldLeft = mTarget.getLeft();</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> newLeft = oldLeft + xOffset;</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> leftLowerLimit = mParentPL + mTargetML;</span><br><span class="line">          <span class="keyword">if</span> (newLeft &lt; leftLowerLimit) &#123;</span><br><span class="line">            xOffset = leftLowerLimit - oldLeft;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> leftUpperLimit = mParentW - mTargetW - mParentPR - mTargetMR;</span><br><span class="line">          <span class="keyword">if</span> (newLeft &gt; leftUpperLimit) &#123;</span><br><span class="line">            xOffset = leftUpperLimit - oldLeft;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> oldTop = mTarget.getTop();</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> newTop = oldTop + yOffset;</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> topLowerLimit = mParentPT + mTargetMT;</span><br><span class="line">          <span class="keyword">if</span> (newTop &lt; topLowerLimit) &#123;</span><br><span class="line">            yOffset = topLowerLimit - oldTop;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> topUpperLimit = mParentH - mTargetH - mParentPB - mTargetMB;</span><br><span class="line">          <span class="keyword">if</span> (newTop &gt; topUpperLimit) &#123;</span><br><span class="line">            yOffset = topUpperLimit - oldTop;</span><br><span class="line">          &#125;</span><br><span class="line">          scrollByOffset(xOffset, yOffset);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="offsetXXAndXX"><a href="#offsetXXAndXX" class="headerlink" title="offsetXXAndXX"></a>offsetXXAndXX</h3><p>使用 <code>offsetLeftAndRight</code> 和 <code>offsetTopAndBottom</code> 两种方法可以直接对 View 进行滑动，使用这两种方法和 layout 相同，只不过更方便一些，直接传入偏移值即可使 View 滑动，经过测试，它和调用 <code>layout</code> 方法所照成的影响一致，都会使 <code>mLeft,mRight,mTop,mBottom</code> 发生变化，当 View 调用 <code>requestLayout</code> 后，View 依然会回到原始位置。</p>
<p>那么直接就直接使用吧：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mTarget.offsetLeftAndRight(xOffset);</span><br><span class="line">mTarget.offsetTopAndBottom(yOffset);</span><br></pre></td></tr></table></figure>

<p>既然和 <code>layout</code> 方法一样，那么对边界限制的代码也是一模一样，这里就不用写了，和 <code>layout</code> 是一样的。</p>
<p>在 Android 中存在一个 View 拖动的辅助类 <code>ViewDragHelper</code> ，使用它可以很方便的对 View 进行拖拽和边界限制，这里就不说了，其内部滑动就是调用了 <code>offsetXXAndXX</code> 系列方法，下面是它内部的一个方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">dragTo</span><span class="params">(<span class="keyword">int</span> left, <span class="keyword">int</span> top, <span class="keyword">int</span> dx, <span class="keyword">int</span> dy)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> clampedX = left;</span><br><span class="line">  <span class="keyword">int</span> clampedY = top;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> oldLeft = mCapturedView.getLeft();</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> oldTop = mCapturedView.getTop();</span><br><span class="line">  <span class="keyword">if</span> (dx != <span class="number">0</span>) &#123;</span><br><span class="line">    clampedX = mCallback.clampViewPositionHorizontal(mCapturedView, left, dx);</span><br><span class="line">    ViewCompat.offsetLeftAndRight(mCapturedView, clampedX - oldLeft);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (dy != <span class="number">0</span>) &#123;</span><br><span class="line">    clampedY = mCallback.clampViewPositionVertical(mCapturedView, top, dy);</span><br><span class="line">    ViewCompat.offsetTopAndBottom(mCapturedView, clampedY - oldTop);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (dx != <span class="number">0</span> || dy != <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> clampedDx = clampedX - oldLeft;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> clampedDy = clampedY - oldTop;</span><br><span class="line">    mCallback.onViewPositionChanged(mCapturedView, clampedX, clampedY,</span><br><span class="line">                                    clampedDx, clampedDy);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Layout-Params"><a href="#Layout-Params" class="headerlink" title="Layout Params"></a>Layout Params</h3><p>使用 <code>LayoutParams</code> 就有很灵活了，它是作为 View 的布局参数映射类而存在的，最先想到的就的是动态更改 View 设置的 <code>layout_margin</code> 属性，即可做到 View 位置的更改，也就能控制 View 的滑动了，不过必须在支持 <code>layout_margin</code> 的父布局中才可以使用，相对于父布局来说，只要是支持 View 位置的属性，都可以拿来用，并不限制于 <code>layout_margin</code> 参数。</p>
<p>下面，我们在 FrameLayout 里面进行滑动，那么可以这样来：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">scrollByOffset</span><span class="params">(<span class="keyword">int</span> xOffset, <span class="keyword">int</span> yOffset)</span> </span>&#123;</span><br><span class="line">  FrameLayout.LayoutParams params = (FrameLayout.LayoutParams) mTarget.getLayoutParams();</span><br><span class="line">  params.leftMargin += xOffset;</span><br><span class="line">  params.topMargin += yOffset;</span><br><span class="line">  mTarget.setLayoutParams(params);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>处理上下限也很好弄了。</p>
<p><img src="./view_scroll_layout_params.png"></p>
<p>下限不用说，就是 <code>marginLeft</code> 和 <code>marginTop</code> 的初始值：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> marginLeftLowerLimit = mTargetML;</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> marginTopLowerLimit = mTargetMT;</span><br></pre></td></tr></table></figure>

<p>上限从图上分析也很容易计算：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> marginLeftUpperLimit = mParentW - mTargetW - mParentPL - mParentPR - mTargetMR;</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> marginTopUpperLimit = mParentH - mTargetH - mParentPT - mParentPB - mTargetMB;</span><br></pre></td></tr></table></figure>

<p>那么完整的就是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用 layout params 的方法进行滑动</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startScrollWithLayoutParams</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  mTarget.setOnTouchListener(<span class="keyword">new</span> View.OnTouchListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent event)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">int</span> x = (<span class="keyword">int</span>) event.getX();</span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">int</span> y = (<span class="keyword">int</span>) event.getY();</span><br><span class="line">      <span class="keyword">switch</span> (event.getActionMasked()) &#123;</span><br><span class="line">        <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">          stopAllAnimAndThread();</span><br><span class="line">          mLastX = x;</span><br><span class="line">          mLastY = y;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">          <span class="keyword">int</span> xOffset = x - mLastX;</span><br><span class="line">          <span class="keyword">int</span> yOffset = y - mLastY;</span><br><span class="line">          FrameLayout.LayoutParams params = (FrameLayout.LayoutParams) mTarget.getLayoutParams();</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> oldMarginLeft = params.leftMargin;</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> newMarginLeft = oldMarginLeft + xOffset;</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> marginLeftLowerLimit = mTargetML;</span><br><span class="line">          <span class="keyword">if</span> (newMarginLeft &lt; marginLeftLowerLimit) &#123;</span><br><span class="line">            xOffset = marginLeftLowerLimit - oldMarginLeft;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> marginLeftUpperLimit = mParentW - mTargetW - mParentPL - mParentPR - mTargetMR;</span><br><span class="line">          <span class="keyword">if</span> (newMarginLeft &gt; marginLeftUpperLimit) &#123;</span><br><span class="line">            xOffset = marginLeftUpperLimit - oldMarginLeft;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> oldMarginTop = params.topMargin;</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> newMarginTop = oldMarginTop + yOffset;</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> marginTopLowerLimit = mTargetMT;</span><br><span class="line">          <span class="keyword">if</span> (newMarginTop &lt; marginLeftLowerLimit) &#123;</span><br><span class="line">            yOffset = marginTopLowerLimit - oldMarginTop;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">int</span> marginTopUpperLimit = mParentH - mTargetH - mParentPT - mParentPB - mTargetMB;</span><br><span class="line">          <span class="keyword">if</span> (newMarginTop &gt; marginTopUpperLimit) &#123;</span><br><span class="line">            yOffset = marginTopUpperLimit - oldMarginTop;</span><br><span class="line">          &#125;</span><br><span class="line">          scrollByOffset(xOffset, yOffset);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么最终就可以达到这样的效果：</p>
<p><img src="./drag.gif"></p>
<p>其中的信息输出是一个 <code>Toast</code> ，可以在 <code>move</code> 事件中加入。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">  ...</span><br><span class="line">  scrollByOffset(xOffset, yOffset);</span><br><span class="line">  <span class="comment">/* 打印滑动时的view信息 */</span></span><br><span class="line">  printViewInfo(event, xOffset, yOffset);</span><br><span class="line">  <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 在屏幕打印坐标信息</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> event   触摸事件</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> xOffset x轴偏移</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> yOffset y轴偏移</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">printViewInfo</span><span class="params">(MotionEvent event, <span class="keyword">final</span> <span class="keyword">int</span> xOffset, <span class="keyword">final</span> <span class="keyword">int</span> yOffset)</span> </span>&#123;</span><br><span class="line">    T.show(</span><br><span class="line">        getOutPutString(</span><br><span class="line">            mParent.getScrollX(), mParent.getScrollY(),</span><br><span class="line">            (<span class="keyword">int</span>) event.getX(), (<span class="keyword">int</span>) event.getY(), (<span class="keyword">int</span>) event.getRawX(), (<span class="keyword">int</span>) event.getRawY(),</span><br><span class="line">            xOffset, yOffset,</span><br><span class="line">            mTarget.getWidth(), mTarget.getHeight(),</span><br><span class="line">            (<span class="keyword">int</span>) mTarget.getX(), (<span class="keyword">int</span>) mTarget.getY(),</span><br><span class="line">            mTarget.getScrollX(), mTarget.getScrollY(),</span><br><span class="line">            (<span class="keyword">int</span>) mTarget.getTranslationX(), (<span class="keyword">int</span>) mTarget.getTranslationY(),</span><br><span class="line">            mTarget.getLeft(), mTarget.getRight(), mTarget.getTop(), mTarget.getBottom()</span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取格式化的坐标信息字符串</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> pScrollX      parent view getScrollX</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> pScrollY      parent view getScrollY</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> mGetX         motion event getX</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> mGetY         motion event getY</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> mGetRawX      motion event getRawX</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> mGetRawY      motion event getRawY</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> mOffsetX      x轴偏移</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> mOffsetY      y轴偏移</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> tWidth        target view width</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> tHeight       target view height</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> tGetX         target view getX</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> tGetY         target view getY</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> tScrollX      target view getScrollX</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> tScrollY      target view getScrollY</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> tTranslationX target view getTranslationX</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> tTranslationY target view getTranslationY</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> tLeft         target view getLeft</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> tRight        target view getRight</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> tTop          target view getTop</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> tBottom       target view getBottom</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> result string</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getOutPutString</span><span class="params">(<span class="keyword">int</span> pScrollX, <span class="keyword">int</span> pScrollY,</span></span></span><br><span class="line"><span class="params"><span class="function">                                        <span class="keyword">int</span> mGetX, <span class="keyword">int</span> mGetY, <span class="keyword">int</span> mGetRawX, <span class="keyword">int</span> mGetRawY,</span></span></span><br><span class="line"><span class="params"><span class="function">                                        <span class="keyword">int</span> mOffsetX, <span class="keyword">int</span> mOffsetY,</span></span></span><br><span class="line"><span class="params"><span class="function">                                        <span class="keyword">int</span> tWidth, <span class="keyword">int</span> tHeight, <span class="keyword">int</span> tGetX, <span class="keyword">int</span> tGetY,</span></span></span><br><span class="line"><span class="params"><span class="function">                                        <span class="keyword">int</span> tScrollX, <span class="keyword">int</span> tScrollY,</span></span></span><br><span class="line"><span class="params"><span class="function">                                        <span class="keyword">int</span> tTranslationX, <span class="keyword">int</span> tTranslationY,</span></span></span><br><span class="line"><span class="params"><span class="function">                                        <span class="keyword">int</span> tLeft, <span class="keyword">int</span> tRight, <span class="keyword">int</span> tTop, <span class="keyword">int</span> tBottom)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Parent: &#123;&quot;</span> +</span><br><span class="line">        <span class="string">&quot;\nscrollX: &quot;</span> + pScrollX +</span><br><span class="line">        <span class="string">&quot;\nscrollY: &quot;</span> + pScrollY +</span><br><span class="line">        <span class="string">&quot;\n&#125;\n&quot;</span> +</span><br><span class="line">        <span class="string">&quot;MotionEvent: &#123;&quot;</span> +</span><br><span class="line">        <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;getX: &quot;</span> + mGetX +</span><br><span class="line">        <span class="string">&quot;\ngetY: &quot;</span> + mGetY +</span><br><span class="line">        <span class="string">&quot;\ngetRawX: &quot;</span> + mGetRawX +</span><br><span class="line">        <span class="string">&quot;\ngetRawY: &quot;</span> + mGetRawY +</span><br><span class="line">        <span class="string">&quot;\noffsetX: &quot;</span> + mOffsetX +</span><br><span class="line">        <span class="string">&quot;\noffsetY:&quot;</span> + mOffsetY +</span><br><span class="line">        <span class="string">&quot;\n&#125;\n&quot;</span> +</span><br><span class="line">        <span class="string">&quot;TargetView: &#123;&quot;</span> +</span><br><span class="line">        <span class="string">&quot;\nwidth: &quot;</span> + tWidth +</span><br><span class="line">        <span class="string">&quot;\nheight: &quot;</span> + tHeight +</span><br><span class="line">        <span class="string">&quot;\ngetX: &quot;</span> + tGetX +</span><br><span class="line">        <span class="string">&quot;\ngetY: &quot;</span> + tGetY +</span><br><span class="line">        <span class="string">&quot;\ngetScrollX: &quot;</span> + tScrollX +</span><br><span class="line">        <span class="string">&quot;\ngetScrollY: &quot;</span> + tScrollY +</span><br><span class="line">        <span class="string">&quot;\ngetTranslationX: &quot;</span> + tTranslationX +</span><br><span class="line">        <span class="string">&quot;\ngetTranslationY: &quot;</span> + tTranslationY +</span><br><span class="line">        <span class="string">&quot;\ngetLeft: &quot;</span> + tLeft +</span><br><span class="line">        <span class="string">&quot;\ngetRight: &quot;</span> + tRight +</span><br><span class="line">        <span class="string">&quot;\ngetTop: &quot;</span> + tTop +</span><br><span class="line">        <span class="string">&quot;\ngetBottom: &quot;</span> + tBottom +</span><br><span class="line">        <span class="string">&quot;\n&#125;&quot;</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* toast 工具类 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">T</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Toast sToast;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SuppressLint(&quot;ShowToast&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">    sToast = Toast.makeText(context, <span class="string">&quot;&quot;</span>, Toast.LENGTH_SHORT);</span><br><span class="line">    TextView view = <span class="keyword">new</span> TextView(context);</span><br><span class="line">    view.setTextColor(Color.BLACK);</span><br><span class="line">    view.setLayoutParams(</span><br><span class="line">      <span class="keyword">new</span> ViewGroup.LayoutParams(</span><br><span class="line">        ViewGroup.LayoutParams.WRAP_CONTENT,</span><br><span class="line">        ViewGroup.LayoutParams.WRAP_CONTENT</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">    sToast.setView(view);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">    ((TextView)sToast.getView()).setText(text);</span><br><span class="line">    sToast.setDuration(Toast.LENGTH_SHORT);</span><br><span class="line">    sToast.show();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="弹性滑动"><a href="#弹性滑动" class="headerlink" title="弹性滑动"></a>弹性滑动</h2><p>上面介绍了 View 的滑动方法，也实现了实例中的前 3 个需求，但这些都只是被动的被控制的滑动，那么怎么让它自动滑动呢，就是自动从一个地方平滑到另一个地方，那么针对以上的 5 中方法，每种都有对应的处理方式，现在就有了以下三个方法，这些方法将被用来实现第4个需求：模拟悬浮窗的横向吸附效果，当松手时，如果ImageView偏左，则ImageView会平滑吸附到ViewGroup的左边缘，反之吸附到右边缘。 </p>
<h3 id="Animator"><a href="#Animator" class="headerlink" title="Animator"></a>Animator</h3><p>首先就想到了属性动画，它会使用内部线程自动更新 View 的属性，再通过 View 的重绘，使 View 的形态发生变化，平常都很常用的就是平移、缩放、旋转动画，其中平移动画就是更新的 <code>translationX</code> 和 <code>translationY</code> 两种属性，那么很自然的就把滑动方法中的 <code>translation</code> 给搞定了，当然还可以使用动画更新自定的属性，好的，现在来着手实现自动吸附吧，首先就想到是在 View 的触摸事件中的 <code>ACTION_UP</code> 事件中判断 View 的当前位置，看它偏左还是偏右，如果偏左，就让它向左平滑滑向下限位置也就是初始位置，否则向右滑向上限位置，然后在开始具体的不同方法的平滑滚动。下面是使用属性动画的两种解决方案，</p>
<ul>
<li>使用 <code>ObjectAnimator</code> 更新 <code>translationX</code> 属性实现平滑滚动。</li>
</ul>
<p>属性动画实例化：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 初始化为默认值 */</span></span><br><span class="line">mTransAnimator = ObjectAnimator.ofFloat(mTarget, <span class="string">&quot;translationX&quot;</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>处理 <code>ACTION_UP</code> 事件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * (此方法将在ACTION_UP事件中调用)</span></span><br><span class="line"><span class="comment"> * 通过 object animator 更新 &quot;translationX&quot; 属性进行平滑</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">scrollToSideWithTranslation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">/* translation滑动上限 */</span></span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> transXLimit = mParentW - mParentPL - mParentPR - mTargetMR - mTargetML - mTargetW;</span><br><span class="line">  <span class="comment">/* 中间值 */</span></span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> transXHalfLimit = transXLimit / <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">float</span> translationX = mTarget.getTranslationX();</span><br><span class="line">  <span class="keyword">if</span> (translationX == <span class="number">0</span> || translationX == transXLimit) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (translationX &lt; transXHalfLimit) &#123;</span><br><span class="line">    <span class="comment">/* 根据滑动距离设置滑动时间 */</span></span><br><span class="line">    mTransAnimator.setDuration((<span class="keyword">long</span>) (SPEED_A_PIXEL * translationX));</span><br><span class="line">    <span class="comment">/* 从当前值更新到初始值0 */</span></span><br><span class="line">    mTransAnimator.setFloatValues(translationX, <span class="number">0</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    mTransAnimator.setDuration((<span class="keyword">long</span>) (SPEED_A_PIXEL * (transXLimit - translationX)));</span><br><span class="line">    <span class="comment">/* 从当前值更新到上限值 */</span></span><br><span class="line">    mTransAnimator.setFloatValues(translationX, transXLimit);</span><br><span class="line">  &#125;</span><br><span class="line">  mTransAnimator.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用 <code>ValueAnimator</code> 自定义更新 <code>LayoutParams</code> 中 <code>margin</code> 属性实现平滑滚动。</li>
</ul>
<p>初始化动画：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mLayoutParamsAnimator = ValueAnimator.ofInt(<span class="number">0</span>);</span><br><span class="line"><span class="comment">/* 在动画监听器中自定义更新layoutParams的属性 */</span></span><br><span class="line">mLayoutParamsAnimator.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> marginLeft = (<span class="keyword">int</span>) animation.getAnimatedValue();</span><br><span class="line">    <span class="comment">/* 动态更新layoutParams中的margin属性来做到平滑滚动 */</span></span><br><span class="line">    FrameLayout.LayoutParams params = (FrameLayout.LayoutParams) mTarget.getLayoutParams();</span><br><span class="line">    params.leftMargin = marginLeft;</span><br><span class="line">    mTarget.setLayoutParams(params);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>实现吸附：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * (此方法将在ACTION_UP事件中调用)</span></span><br><span class="line"><span class="comment"> * 通过使用 value animator 更新 layout params 的方法进行平滑</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">scrollToSideWithLayoutParams</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">/* marginLeft下限 */</span></span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> marginLeftMinLimit = mTargetML;</span><br><span class="line">  <span class="comment">/* marginLeft上限 */</span></span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> marginLeftMaxLimit = mParentW - mParentPR - mTargetMR - mTargetW - mParentPL;</span><br><span class="line">  <span class="comment">/* 中间分界线 */</span></span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> marginLeftHalfLimit = (marginLeftMaxLimit + marginLeftMinLimit) / <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> marginLeft = ((FrameLayout.LayoutParams) mTarget.getLayoutParams()).leftMargin;</span><br><span class="line">  <span class="keyword">if</span> (marginLeft &lt; marginLeftHalfLimit) &#123;</span><br><span class="line">    <span class="comment">/* 滚动到下限也就是初始位置 */</span></span><br><span class="line">    mLayoutParamsAnimator.setIntValues(marginLeft, marginLeftMinLimit);</span><br><span class="line">    mLayoutParamsAnimator.setDuration(SPEED_A_PIXEL * (marginLeft - marginLeftMinLimit));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">/* 滚动到上限位置 */</span></span><br><span class="line">    mLayoutParamsAnimator.setIntValues(marginLeft, marginLeftMaxLimit);</span><br><span class="line">    mLayoutParamsAnimator.setDuration(SPEED_A_PIXEL * (marginLeftMaxLimit - marginLeft));</span><br><span class="line">  &#125;</span><br><span class="line">  mLayoutParamsAnimator.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样就非常容易的实现吸附到边缘的效果了。注意在 <code>ACION_DOWM</code> 事件中停止动画，还有最后对动画的回收。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 停止所有可能的动画</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">stopAllAnimAndThread</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (mTransAnimator != <span class="keyword">null</span> &amp;&amp; mTransAnimator.isRunning()) &#123;</span><br><span class="line">    mTransAnimator.cancel();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (mLayoutParamsAnimator != <span class="keyword">null</span> &amp;&amp; mLayoutParamsAnimator.isRunning()) &#123;</span><br><span class="line">    mLayoutParamsAnimator.cancel();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里已经实现了 <code>translation</code> 和 <code>layout params </code> 两种方法的滑动解决方案。</p>
<h3 id="Scroller"><a href="#Scroller" class="headerlink" title="Scroller"></a>Scroller</h3><p><code>Scroller</code> 是 Android 的 API 提供的一个帮助平滑滚动的工具类，它专为 <code>scrollTo</code>方法设计，使用它可以轻易的实现 View 内容的平滑滚动，首先介绍它的使用方法：</p>
<p>第一步实例化对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mScroller = <span class="keyword">new</span> Scroller(mParent.getContext());</span><br></pre></td></tr></table></figure>

<p>然后在使用它来平滑滚动之前需要在 View 的 <code>void computeScroll()</code> 方法中实现它滑动所必须的逻辑，因为它本身并不具备直接使 View 滑动的能力，而是在外部模拟滚动发生时的数值变化：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">computeScroll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">/* 继续滚动直到到mScroller设置的结束点 */</span></span><br><span class="line">  <span class="keyword">if</span> (mScroller.computeScrollOffset()) &#123;</span><br><span class="line">    <span class="comment">/* 调用scrollTo对view内容进行滚动 */</span></span><br><span class="line">    view.scrollTo(mScroller.getCurrX(), mScroller.getCurrY());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Scroller</code> 提供了 3 个 API 以供使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 开始平滑滚动，start为scroll 起始值，d为偏移量，向右偏移 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">startScroll</span><span class="params">(<span class="keyword">int</span> startX, <span class="keyword">int</span> startY, <span class="keyword">int</span> dx, <span class="keyword">int</span> dy)</span></span>;</span><br><span class="line"><span class="comment">/* 这个可以指定时间 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">startScroll</span><span class="params">(<span class="keyword">int</span> startX, <span class="keyword">int</span> startY, <span class="keyword">int</span> dx, <span class="keyword">int</span> dy, <span class="keyword">int</span> duration)</span></span>;</span><br><span class="line"><span class="comment">/* 模拟抛出的动作，start为起始值，velocity为初速度，min为下限，max上限 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fling</span><span class="params">(<span class="keyword">int</span> startX, <span class="keyword">int</span> startY, <span class="keyword">int</span> velocityX, <span class="keyword">int</span> velocityY, <span class="keyword">int</span> minX, <span class="keyword">int</span> maxX, <span class="keyword">int</span> minY, <span class="keyword">int</span> maxY)</span></span>;</span><br></pre></td></tr></table></figure>

<p>这里平滑滚动可使用前两个，最后一个可以模拟抛出，可以用这个实现 <code>ListView</code> 的抛出效果。</p>
<p>那么直接可以使用这个来实现了，首先需要重写 <code>computeScroll()</code> 方法，但是现在是从外部调用触摸事件的，而且需要对 <code>parent view</code> 进行滚动的，怎么办，有一个办法就是实现 <code>parent view</code> 的子类，写一个回调就行，这里继承了 FrameLayout 写了一个 <code>ScrollerLayout</code>，其中就有 <code>computeScroll()</code> 对外部的回调</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ScrollerLayout</span> <span class="keyword">extends</span> <span class="title">FrameLayout</span> </span>&#123;</span><br><span class="line">   ...<span class="comment">//此处省略构造器</span></span><br><span class="line">   <span class="keyword">private</span> OnComputeScrollListener mOnComputeScrollListener;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOnComputeScrollListener</span><span class="params">(OnComputeScrollListener onComputeScrollListener)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.mOnComputeScrollListener = onComputeScrollListener;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OnComputeScrollListener</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onComputeScroll</span><span class="params">()</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">computeScroll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mOnComputeScrollListener != <span class="keyword">null</span>) &#123;</span><br><span class="line">      mOnComputeScrollListener.onComputeScroll();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在可以初始化 <code>Scroller</code> 了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mScroller = <span class="keyword">new</span> Scroller(mParent.getContext());</span><br><span class="line">((ScrollerLayout) mParent).setOnComputeScrollListener(</span><br><span class="line">  <span class="keyword">new</span> ScrollerLayout.OnComputeScrollListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComputeScroll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (mScroller.computeScrollOffset()) &#123;</span><br><span class="line">        mParent.scrollTo(mScroller.getCurrX(), mScroller.getCurrY());</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>初始化完毕，现在可以直接使用了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过 Scroller 进行平滑</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">scrollToSideWithScrollTo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">/* scroll最大值 */</span></span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> scrollXLimit = mParentW - mParentPR - mTargetMR - mTargetW - mTargetML;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> scrollX = -mParent.getScrollX();</span><br><span class="line">  <span class="comment">/* 中值 */</span></span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> scrollXHalfLimit = scrollXLimit / <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">if</span> (scrollX &lt; scrollXHalfLimit) &#123;</span><br><span class="line">    <span class="comment">/* 向x轴的起始位置滚动 */</span></span><br><span class="line">    mScroller.startScroll(mParent.getScrollX(), mParent.getScrollY(), scrollX, <span class="number">0</span>,</span><br><span class="line">        SPEED_A_PIXEL * scrollX);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">/* 向x轴的终点位置滚动 */</span></span><br><span class="line">    mScroller.startScroll(mParent.getScrollX(), mParent.getScrollY(), -(scrollXLimit - scrollX),</span><br><span class="line">        <span class="number">0</span>, SPEED_A_PIXEL * (scrollXLimit - scrollX));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/* 激活computeScroll的回调 */</span></span><br><span class="line">  mParent.invalidate();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Handler"><a href="#Handler" class="headerlink" title="Handler"></a>Handler</h3><p>使用 <code>Handler</code> 进行平滑处理的方法主要是在它的消息处理方法中不断调用view的滑动方法，以此达到view不断滑动的效果，可以使用线程向 <code>Handler</code> 不断发送消息，也可以使用 <code>Handler</code>的 <code>post</code> 方法发送 <code>Runnable</code> 任务，在 <code>Runnable</code> 中再次发送自身即可，不断更新handler。</p>
<p>那么现在还剩下 <code>offsetXXAndXX</code> 和 <code>layout</code> 方法没有对应的平滑处理方法了，现在就用 handler来完成它们的平滑处理吧。</p>
<p>初始化：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Handler mLayoutHandler = <span class="keyword">new</span> Handler(<span class="keyword">new</span> Handler.Callback() &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">    <span class="comment">/* arg1为需要滚动的x轴偏移 */</span></span><br><span class="line">    scrollByOffset(msg.arg1, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">scrollByOffset</span><span class="params">(<span class="keyword">int</span> xOffset, <span class="keyword">int</span> yOffset)</span> </span>&#123;</span><br><span class="line">  <span class="comment">/* 选用一种即可 */</span></span><br><span class="line">  mTarget.offsetLeftAndRight(xOffset);</span><br><span class="line">  mTarget.offsetTopAndBottom(yOffset);</span><br><span class="line">  <span class="comment">//mTarget.layout(mTarget.getLeft() + xOffset, mTarget.getTop() + yOffset,</span></span><br><span class="line">  <span class="comment">//               mTarget.getRight() + xOffset, mTarget.getBottom() + yOffset);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过使用 thread 发送消息至 handler 不断调用 offset 或 layout 方法进行平滑</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">scrollToSideWithLayoutOrOffsetFun</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> layoutXMaxLimit = mParentW - mParentPR - mTargetMR - mTargetW;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> layoutXMinLimit = mParentPL + mTargetML;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> layoutXHalfLimit = (layoutXMaxLimit + layoutXMinLimit) / <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> targetLeft = mTarget.getLeft();</span><br><span class="line">  <span class="keyword">if</span> (targetLeft == layoutXMinLimit || targetLeft == layoutXMaxLimit) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  mStartLayoutThread = <span class="keyword">true</span>;</span><br><span class="line">  <span class="keyword">if</span> (targetLeft &lt; layoutXHalfLimit) &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> transDistance = targetLeft - layoutXMinLimit;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> time = SPEED_A_PIXEL * transDistance;</span><br><span class="line">    <span class="comment">/* 以10ms为单位计算每次需要累加的偏移 */</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> buffer = transDistance * <span class="number">10</span> / time;</span><br><span class="line">    mLayoutThread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> left = targetLeft;</span><br><span class="line">        <span class="keyword">while</span> (mStartLayoutThread) &#123;</span><br><span class="line">          Message msg = Message.obtain(mLayoutHandler);</span><br><span class="line">          left -= buffer;</span><br><span class="line">          <span class="keyword">if</span> (left &lt; layoutXMinLimit) &#123;</span><br><span class="line">            msg.arg1 = -(layoutXMinLimit - left);</span><br><span class="line">            msg.sendToTarget();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            msg.arg1 = -buffer;</span><br><span class="line">            msg.sendToTarget();</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (left == layoutXMinLimit) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">10</span>);</span><br><span class="line">          &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> transDistance = layoutXMaxLimit - targetLeft;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> time = SPEED_A_PIXEL * transDistance;</span><br><span class="line">    <span class="comment">/* 以10ms为单位计算每次需要累减的偏移 */</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> buffer = transDistance * <span class="number">10</span> / time;</span><br><span class="line">    mLayoutThread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> left = targetLeft;</span><br><span class="line">        <span class="keyword">while</span> (mStartLayoutThread) &#123;</span><br><span class="line">          Message msg = Message.obtain(mLayoutHandler);</span><br><span class="line">          left += buffer;</span><br><span class="line">          <span class="keyword">if</span> (left &gt; layoutXMaxLimit) &#123;</span><br><span class="line">            msg.arg1 = layoutXMaxLimit - left;</span><br><span class="line">            msg.sendToTarget();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            msg.arg1 = buffer;</span><br><span class="line">            msg.sendToTarget();</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">10</span>);</span><br><span class="line">          &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  mLayoutThread.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 <code>ACTION_DOWM</code> 事件里面检查并关闭线程：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 停止所有可能执行的线程</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">stopAllThread</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (mLayoutThread != <span class="keyword">null</span>) &#123;</span><br><span class="line">    mStartLayoutThread = <span class="keyword">false</span>;</span><br><span class="line">    mLayoutThread = <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最终效果如下，这里我把这几种方法整合到菜单里了，这和一种方法的效果是一样的：</p>
<p><img src="./drag_auto_back.gif"></p>
<h2 id="滑动方法总结"><a href="#滑动方法总结" class="headerlink" title="滑动方法总结"></a>滑动方法总结</h2><p>首先总结5中滑动方法：</p>
<ol>
<li>通过改变 <code>translation</code> 的值使 View 的位置发生平移，但是并未真正改变view的布局位置，可以使用属性动画直接对其进行更新，可以很方便的做出各种平移效果。</li>
<li>通过改变 View 的<code>LayoutParams</code> 的 <code>margin</code> 属性使 View 发生平移，比较灵活，但是受到父 View 的限制，父 View 必须支持 <code>margin</code> 等一些属性，并且改变 <code>margin</code> 值可能会对同一个父 View 下的其他子 View 造成影响。</li>
<li>使用 <code>offsetXXAndXX</code> 和 <code>layout</code> 方法使 View 平移，这两种方法所造成的影响是一致的，它们是通过直接改变 View 的位置参数来使 View 发生平移的，但是要注意调用 <code>requestLayout</code> 会使 View 重新布局导致它的 <code>mLeft,mRight</code> 等属性重新赋值，View 会还原到原位置。</li>
<li>使用 <code>scrollTo</code> 和 <code>scrollBy</code> 方法使 View 的内容发生滚动，这个方法不适用于单个 View 的平移，更适合做一些内容滑动的控件，类似的有 <code>ScrollView</code> 和 <code>ListView</code> 这种控件。</li>
</ol>
<p>平滑滚动：</p>
<ol>
<li><code>Animator</code> 使用属性动画，可以直接使用 View 已经有的属性 <code>translation</code> 来进行平滑，还可以自定义动画来更新自定义的属性。在这里它比线程更好用，同时还能使用丰富的差值器来改变平移时的速率，非常方便。</li>
<li>使用 <code>Scroller</code> ，它只配合于 <code>scrollTo</code> 方法来使view的内容发生平滑滚动，使用方便，还有一个方法可以模拟甩出的动作，可以用它来做一些内部滑动的控件。</li>
<li>使用 <code>Handler</code> ，<code>Handler</code> 能干很多事，它是android中很重要的线程间通讯工具，配合线程可以自由的选择 View 的平移方式，但是使用起来可能麻烦一些，因为需要自己控制线程，但是自由发挥的空间更大。 </li>
</ol>
<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><p><a target="_blank" rel="noopener" href="https://github.com/l0neman/AnalysisAndCreate/tree/master/coordinateandscroll">https://github.com/l0neman/AnalysisAndCreate/tree/master/coordinateandscroll</a></p>
</div><div class="article-licensing box"><div class="licensing-title"><p>Android 坐标系和 View 滑动方法</p><p><a href="https://l0neman.github.io/2019/02/12/android-坐标系和-view-滑动方法/">https://l0neman.github.io/2019/02/12/android-坐标系和-view-滑动方法/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>l0neman</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2019-02-12</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2019-02-12</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/android/">Android</a><a class="link-muted mr-2" rel="tag" href="/tags/view/">View</a></div><div class="addthis_inline_share_toolbox"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5f0f12c19a2af379" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/img/qrcode/alipay.jpg" alt="支付宝"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/img/qrcode/wxpay.jpg" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2019/02/12/android-view-%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E6%9C%BA%E5%88%B6/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Android View 事件分发机制</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2019/02/12/android-activity-%E4%BB%BB%E5%8A%A1%E6%A0%88/"><span class="level-item">Android Activity 任务栈</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><script src="https://utteranc.es/client.js" repo="l0neman/l0neman.github.io" issue-term="pathname" label="comment" theme="github-light" crossorigin="anonymous" async></script></div></div></div><!--!--><div class="column column-right  order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Android-二维坐标系"><span class="level-left"><span class="level-item">1</span><span class="level-item">Android 二维坐标系</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Parent-View"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">Parent View</span></span></a></li><li><a class="level is-mobile" href="#Motion-Event"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">Motion Event</span></span></a></li><li><a class="level is-mobile" href="#Child-View"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">Child View</span></span></a></li></ul></li><li><a class="level is-mobile" href="#View-滑动方法"><span class="level-left"><span class="level-item">2</span><span class="level-item">View 滑动方法</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#拖拽滑动实例"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">拖拽滑动实例</span></span></a></li><li><a class="level is-mobile" href="#Translation"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">Translation</span></span></a></li><li><a class="level is-mobile" href="#Scroll-To"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">Scroll To</span></span></a></li><li><a class="level is-mobile" href="#Layout-Fun"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">Layout Fun</span></span></a></li><li><a class="level is-mobile" href="#offsetXXAndXX"><span class="level-left"><span class="level-item">2.5</span><span class="level-item">offsetXXAndXX</span></span></a></li><li><a class="level is-mobile" href="#Layout-Params"><span class="level-left"><span class="level-item">2.6</span><span class="level-item">Layout Params</span></span></a></li></ul></li><li><a class="level is-mobile" href="#弹性滑动"><span class="level-left"><span class="level-item">3</span><span class="level-item">弹性滑动</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Animator"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">Animator</span></span></a></li><li><a class="level is-mobile" href="#Scroller"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">Scroller</span></span></a></li><li><a class="level is-mobile" href="#Handler"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">Handler</span></span></a></li></ul></li><li><a class="level is-mobile" href="#滑动方法总结"><span class="level-left"><span class="level-item">4</span><span class="level-item">滑动方法总结</span></span></a></li><li><a class="level is-mobile" href="#源码"><span class="level-left"><span class="level-item">5</span><span class="level-item">源码</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/android-%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/"><span class="level-start"><span class="level-item">Android 实用工具</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/android-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/"><span class="level-start"><span class="level-item">Android 应用开发</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/categories/android-%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/"><span class="level-start"><span class="level-item">Android 系统原理</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/android-%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/"><span class="level-start"><span class="level-item">Android 逆向工程</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3/"><span class="level-start"><span class="level-item">参考文档</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/"><span class="level-start"><span class="level-item">实用工具</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/"><span class="level-start"><span class="level-item">编程基础</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-11-14T16:18:50.000Z">2021-11-15</time></p><p class="title"><a href="/2021/11/15/staruml-%E7%A0%B4%E8%A7%A3%E6%96%B9%E6%B3%95/">StarUML 破解方法</a></p><p class="categories"><a href="/categories/%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/">实用工具</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-11-14T15:59:06.000Z">2021-11-14</time></p><p class="title"><a href="/2021/11/14/android-filter-%E5%88%86%E6%9E%90/">Android Filter 分析</a></p><p class="categories"><a href="/categories/android-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/">Android 应用开发</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-06-29T16:45:50.000Z">2021-06-30</time></p><p class="title"><a href="/2021/06/30/%E6%94%AF%E6%8C%81%E8%A7%A6%E6%91%B8%E6%8B%96%E5%8A%A8%E7%9A%84-touchdelegate/">支持触摸拖动的 TouchDelegate</a></p><p class="categories"><a href="/categories/android-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/">Android 应用开发</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-04-21T15:08:15.000Z">2021-04-21</time></p><p class="title"><a href="/2021/04/21/gdb-arm-%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">GDB ARM 交叉编译环境搭建</a></p><p class="categories"><a href="/categories/android-%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/">Android 实用工具</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-04-21T15:04:39.000Z">2021-04-21</time></p><p class="title"><a href="/2021/04/21/dropbear-android-%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4/">Dropbear Android 安装步骤</a></p><p class="categories"><a href="/categories/android-%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/">Android 实用工具</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2021/11/"><span class="level-start"><span class="level-item">十一月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/06/"><span class="level-start"><span class="level-item">六月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">四月 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/01/"><span class="level-start"><span class="level-item">一月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/11/"><span class="level-start"><span class="level-item">十一月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">十月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/09/"><span class="level-start"><span class="level-item">九月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">七月 2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/06/"><span class="level-start"><span class="level-item">六月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/04/"><span class="level-start"><span class="level-item">四月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/02/"><span class="level-start"><span class="level-item">二月 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/arm/"><span class="tag">ARM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/avd/"><span class="tag">AVD</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/activity/"><span class="tag">Activity</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/android/"><span class="tag">Android</span><span class="tag">24</span></a></div><div class="control"><a class="tags has-addons" href="/tags/assembly/"><span class="tag">Assembly</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/binder/"><span class="tag">Binder</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/classloader/"><span class="tag">ClassLoader</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/computer/"><span class="tag">Computer</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dex/"><span class="tag">Dex</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/elf/"><span class="tag">ELF</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/emulator/"><span class="tag">Emulator</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">Git</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jni/"><span class="tag">JNI</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/java/"><span class="tag">Java</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/log/"><span class="tag">Log</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/make/"><span class="tag">Make</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/makefile/"><span class="tag">Makefile</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/markdown/"><span class="tag">MarkDown</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/metrial/"><span class="tag">Metrial</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ndk/"><span class="tag">NDK</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/regex/"><span class="tag">Regex</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssh/"><span class="tag">SSH</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/theme/"><span class="tag">Theme</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/touch/"><span class="tag">Touch</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/view/"><span class="tag">View</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xposed/"><span class="tag">Xposed</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/zygote/"><span class="tag">Zygote</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/aapt/"><span class="tag">aapt</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/uml/"><span class="tag">uml</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%83%AD%E4%BF%AE%E5%A4%8D/"><span class="tag">热修复</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%83%AD%E6%9B%B4%E6%96%B0/"><span class="tag">热更新</span><span class="tag">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="l0neman 的博客" height="28"></a><p class="is-size-7"><span>&copy; 2021 l0neman</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/l0neman"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>