<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Android 自定义 View - l0neman 的博客</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="l0neman 的博客"><meta name="msapplication-TileImage" content="/img/avatar.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="l0neman 的博客"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="概述View 是由视图和属性组成的控件，实现一个 View 的自定义，主要包括定义它自身的尺寸，以及绘制它的内容，并且在自身属性发生改变时能正确更新其绘制的内容。 ViewGroup 是 View 的容器类型，内部可容纳多个 View，并对子 View 的位置进行规划，根据自身特性的不同，子 View 的摆放特点也各不相同。由于 ViewGroup 本身也是 View 的子类，所以 ViewGro"><meta property="og:type" content="blog"><meta property="og:title" content="Android 自定义 View"><meta property="og:url" content="https://l0neman.github.io/2019/02/12/android-%E8%87%AA%E5%AE%9A%E4%B9%89-view/"><meta property="og:site_name" content="l0neman 的博客"><meta property="og:description" content="概述View 是由视图和属性组成的控件，实现一个 View 的自定义，主要包括定义它自身的尺寸，以及绘制它的内容，并且在自身属性发生改变时能正确更新其绘制的内容。 ViewGroup 是 View 的容器类型，内部可容纳多个 View，并对子 View 的位置进行规划，根据自身特性的不同，子 View 的摆放特点也各不相同。由于 ViewGroup 本身也是 View 的子类，所以 ViewGro"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://l0neman.github.io/2019/02/12/android-%E8%87%AA%E5%AE%9A%E4%B9%89-view/border_layout_sample.jpg"><meta property="article:published_time" content="2019-02-12T10:51:15.000Z"><meta property="article:modified_time" content="2019-02-12T10:51:15.000Z"><meta property="article:author" content="l0neman"><meta property="article:tag" content="Android"><meta property="article:tag" content="View"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="./border_layout_sample.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://l0neman.github.io/2019/02/12/android-%E8%87%AA%E5%AE%9A%E4%B9%89-view/"},"headline":"Android 自定义 View","image":["https://l0neman.github.io/2019/02/12/android-%E8%87%AA%E5%AE%9A%E4%B9%89-view/border_layout_sample.jpg"],"datePublished":"2019-02-12T10:51:15.000Z","dateModified":"2019-02-12T10:51:15.000Z","author":{"@type":"Person","name":"l0neman"},"publisher":{"@type":"Organization","name":"l0neman 的博客","logo":{"@type":"ImageObject","url":"https://l0neman.github.io/img/logo.png"}},"description":"概述View 是由视图和属性组成的控件，实现一个 View 的自定义，主要包括定义它自身的尺寸，以及绘制它的内容，并且在自身属性发生改变时能正确更新其绘制的内容。 ViewGroup 是 View 的容器类型，内部可容纳多个 View，并对子 View 的位置进行规划，根据自身特性的不同，子 View 的摆放特点也各不相同。由于 ViewGroup 本身也是 View 的子类，所以 ViewGro"}</script><link rel="canonical" href="https://l0neman.github.io/2019/02/12/android-%E8%87%AA%E5%AE%9A%E4%B9%89-view/"><link rel="icon" href="/img/avatar.png"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.15.2/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?1727d76e0a823184efc8776f32a916a9";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="l0neman 的博客" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/l0neman"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-three-quarters"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-02-12T10:51:15.000Z" title="2019/2/12 下午6:51:15">2019-02-12</time>发表</span><span class="level-item"><time dateTime="2019-02-12T10:51:15.000Z" title="2019/2/12 下午6:51:15">2019-02-12</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/android-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/">Android 应用开发</a></span><span class="level-item">35 分钟读完 (大约5176个字)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">Android 自定义 View</h1><div class="content"><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>View 是由视图和属性组成的控件，实现一个 View 的自定义，主要包括定义它自身的尺寸，以及绘制它的内容，并且在自身属性发生改变时能正确更新其绘制的内容。</p>
<p>ViewGroup 是 View 的容器类型，内部可容纳多个 View，并对子 View 的位置进行规划，根据自身特性的不同，子 View 的摆放特点也各不相同。由于 ViewGroup 本身也是 View 的子类，所以 ViewGroup 本身也可作为子View 出现。自定义 ViewGroup 时，更着重于对子 View 位置的处理，并且尺寸由子 View 的尺寸和摆放位置决定，在一些复杂的自定义 View 中，内容的绘制和子 View 位置的处理可能显的同等重要。</p>
<span id="more"></span>


<h2 id="MeasureSpec"><a href="#MeasureSpec" class="headerlink" title="MeasureSpec"></a>MeasureSpec</h2><p>MeasureSpec 负责生成 View 的 <code>onMeasure</code>方法中所传递的  measureSpec 参数和从中提取信息，measureSpec 参数将携带父 View 提供的尺寸和测量模式信息，作为确定 View 自身尺寸和 View 继续子View的测量参考。</p>
<p>measureSpec 参数是一个32位int型值，其中高两位将保存测量模式的值，低30位保存尺寸大小，MeasureSpec 提供了生成 measureSpec 参数的方法，它使用位运算将模式和尺寸信息保存至 measureSpec 参数中。</p>
<p>MeasureSpec 部分源码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 移位 */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MODE_SHIFT = <span class="number">30</span>;</span><br><span class="line"><span class="comment">/* 1100 0000 0000 0000 0000 0000 0000 0000 方便取mode值 */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MODE_MASK = <span class="number">0x3</span> &lt;&lt; MODE_SHIFT;</span><br><span class="line"><span class="comment">/* 三种测量模式 */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> UNSPECIFIED = <span class="number">0</span> &lt;&lt; MODE_SHIFT;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> EXACTLY = <span class="number">1</span> &lt;&lt; MODE_SHIFT;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> AT_MOST = <span class="number">2</span> &lt;&lt; MODE_SHIFT;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 产生MeasureSpec */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">makeMeasureSpec</span><span class="params">(<span class="keyword">int</span> size, <span class="keyword">int</span> mode)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(isUseBrokenMakeMeasureSpec)&#123;</span><br><span class="line">        <span class="keyword">return</span> size + mode;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">/* 合并mode和size */</span></span><br><span class="line">        <span class="keyword">return</span> (size &amp; ~MODE_MASK) | (mode &amp; MODE_MASK);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/** 取出高2位的 mode 值 */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getMode</span><span class="params">(<span class="keyword">int</span> measureSpec)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (measureSpec &amp; MODE_MASK);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/** 取出低30位的 size 大小 */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">(<span class="keyword">int</span> measureSpec)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (measureSpec &amp; ~MODE_MASK);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当实现View的 <code>onMeasure</code> 方法时，可根据测量模式确定View的尺寸，下面是3种测量模式。</p>
<table>
<thead>
<tr>
<th>模式</th>
<th>描述</th>
<th>对应布局参数</th>
</tr>
</thead>
<tbody><tr>
<td>AT_MOST</td>
<td>父容器指定了 View 最大可用大小</td>
<td>一般对应 WRAP_CONTENT</td>
</tr>
<tr>
<td>EXACTLY</td>
<td>父容器检测到 View 精确大小</td>
<td>MATCH_PARENT 或 固定 dp</td>
</tr>
<tr>
<td>UNSPECIFIED</td>
<td>父容器对 View 大小无限制</td>
<td>其他</td>
</tr>
</tbody></table>
<p>每个 View 的 measureSpec 参数由父容器结合 View 自身的布局参数将要对 View 进行测量时生成，下面是 ViewGroup 的 <code>getChildMeasureSpec</code> 方法，负责生成子 View 的 measureSpec。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getChildMeasureSpec</span><span class="params">(<span class="keyword">int</span> spec, <span class="keyword">int</span> padding, <span class="keyword">int</span> childDimension)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> specMode = MeasureSpec.getMode(spec);</span><br><span class="line">  <span class="keyword">int</span> specSize = MeasureSpec.getSize(spec);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> size = Math.max(<span class="number">0</span>, specSize - padding);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> resultSize = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int</span> resultMode = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (specMode) &#123;</span><br><span class="line">  <span class="keyword">case</span> MeasureSpec.EXACTLY:</span><br><span class="line">    <span class="keyword">if</span> (childDimension &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">      resultSize = childDimension;</span><br><span class="line">      resultMode = MeasureSpec.EXACTLY;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (childDimension == ViewGroup.LayoutParams.MATCH_PARENT) &#123;</span><br><span class="line">      resultSize = size;</span><br><span class="line">      resultMode = MeasureSpec.EXACTLY;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (childDimension == ViewGroup.LayoutParams.WRAP_CONTENT) &#123;</span><br><span class="line">      resultSize = size;</span><br><span class="line">      resultMode = MeasureSpec.AT_MOST;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">case</span> MeasureSpec.AT_MOST:</span><br><span class="line">    <span class="keyword">if</span> (childDimension &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">      resultSize = childDimension;</span><br><span class="line">      resultMode = MeasureSpec.EXACTLY;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (childDimension == ViewGroup.LayoutParams.MATCH_PARENT) &#123;</span><br><span class="line">      resultSize = size;</span><br><span class="line">      resultMode = MeasureSpec.AT_MOST;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (childDimension == ViewGroup.LayoutParams.WRAP_CONTENT) &#123;</span><br><span class="line">      resultSize = size;</span><br><span class="line">      resultMode = MeasureSpec.AT_MOST;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">case</span> MeasureSpec.UNSPECIFIED:</span><br><span class="line">    <span class="keyword">if</span> (childDimension &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">      resultSize = childDimension;</span><br><span class="line">      resultMode = MeasureSpec.EXACTLY;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (childDimension == ViewGroup.LayoutParams.MATCH_PARENT) &#123;</span><br><span class="line">      resultSize = View.sUseZeroUnspecifiedMeasureSpec ? <span class="number">0</span> : size;</span><br><span class="line">      resultMode = MeasureSpec.UNSPECIFIED;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (childDimension == ViewGroup.LayoutParams.WRAP_CONTENT) &#123;</span><br><span class="line">      resultSize = View.sUseZeroUnspecifiedMeasureSpec ? <span class="number">0</span> : size;</span><br><span class="line">      resultMode = MeasureSpec.UNSPECIFIED;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> MeasureSpec.makeMeasureSpec(resultSize, resultMode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 ViewGroup 的 <code>measureChild</code> 方法中有对 <code>getChildMeasureSpec</code> 的调用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">measureChild</span><span class="params">(View child, <span class="keyword">int</span> parentWidthMeasureSpec,</span></span></span><br><span class="line"><span class="params"><span class="function">                            <span class="keyword">int</span> parentHeightMeasureSpec)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> ViewGroup.LayoutParams lp = child.getLayoutParams();</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> childWidthMeasureSpec = getChildMeasureSpec(parentWidthMeasureSpec,</span><br><span class="line">      mPaddingLeft + mPaddingRight, lp.width);</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> childHeightMeasureSpec = getChildMeasureSpec(parentHeightMeasureSpec,</span><br><span class="line">      mPaddingTop + mPaddingBottom, lp.height);</span><br><span class="line">  child.measure(childWidthMeasureSpec, childHeightMeasureSpec);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="自定义-View-属性"><a href="#自定义-View-属性" class="headerlink" title="自定义 View 属性"></a>自定义 View 属性</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><p>一个合格的 View 是拥有多种可设置属性的，包括从 Java 代码和 XML 布局文件中设置两种方式，Android SDK 提供的原生 View 本身具有丰富的属性，这里实现自定义 View 的 XML 属性。</p>
<ul>
<li><p>首先需要创建自定义 View 的 Java 类型</p>
</li>
<li><p>然后在 <code>res/values/</code> 目录下建立 <code>attrs.xml</code>，在其中建立自定义View对应的自定义属性</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="line">&lt;resources&gt;</span><br><span class="line">    &lt;declare-styleable name=<span class="string">&quot;TestView&quot;</span>&gt;</span><br><span class="line">        &lt;attr name=<span class="string">&quot;attr name&quot;</span> format=<span class="string">&quot;value type&quot;</span> /&gt;</span><br><span class="line">        ...</span><br><span class="line">    &lt;/declare-styleable&gt;</span><br><span class="line">&lt;/resources&gt;</span><br></pre></td></tr></table></figure>

<p>使用 <code>&lt;declare-styleable/&gt;</code> 标签创建view的自定义属性，其中 <code>name</code> 最好指定为自定义View的名字，方便和 View 对应。在内部包含的 <code>&lt;attr/&gt;</code> 标签为该 View 支持的自定义属性列表，包含一个属性名字和引用的类型，定义后即可在布局中使用自定义 View 的属性，与系统属性所用的 <code>android</code> 命名空间不同，自定义属性需要使用 <code>app</code> 命名空间，自定义属性支持以下的所有 Format 类型。</p>
<table>
<thead>
<tr>
<th>format类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>integer</td>
<td>指定一个整型数值</td>
</tr>
<tr>
<td>boolean</td>
<td>指定一个布尔型值</td>
</tr>
<tr>
<td>float</td>
<td>指定一个浮点型数值</td>
</tr>
<tr>
<td>string</td>
<td>指定一个字符串类型值</td>
</tr>
<tr>
<td>color</td>
<td>指定一个颜色的16进制数值或color资源的引用</td>
</tr>
<tr>
<td>dimension</td>
<td>指定Android中支持的尺寸类型（dp,sp,px…）或dimen资源的引用</td>
</tr>
<tr>
<td>fraction</td>
<td>指定一个百分比（20%，10%p），带p的支持分母因子</td>
</tr>
<tr>
<td>reference</td>
<td>指定一个引用类型，可以使任何资源的引用（drawable,color,dimen…）</td>
</tr>
<tr>
<td>flag</td>
<td>只能使用flag内定义的值，值的类型只能为整型</td>
</tr>
<tr>
<td>enum</td>
<td>和flag功能相同，但可以和integer类型混用，可指定定义外的int值</td>
</tr>
</tbody></table>
<ul>
<li>定义完属性后，即可在view的构造方法里，通过 <code>AttributeSet</code> 参数获取在xml中定义的属性值 。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">constrac</span><span class="params">(Context context, <span class="meta">@Nullable</span> AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">super</span>(context, attrs);</span><br><span class="line">  <span class="comment">/* 解析出自定义属性 */</span></span><br><span class="line">  TypedArray array = getContext().obtainStyledAttributes(attrs, R.styleable.AttrTestView);</span><br><span class="line">  <span class="comment">/* 获取色彩资源 */</span></span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> colorAttr = array.getColor(R.styleable.AttrTestView_colorAttr, <span class="number">0</span>); </span><br><span class="line">  <span class="keyword">final</span> xx attr = array.getXX(..);</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面是每种类型定义以及获取的完整示例：</p>
<h3 id="基本类型"><a href="#基本类型" class="headerlink" title="基本类型"></a>基本类型</h3><p>基本类型 int，boolean，float，String。</p>
<ul>
<li>定义</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">declare-styleable</span> <span class="attr">name</span>=<span class="string">&quot;AttrTestView&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;intAttr&quot;</span> <span class="attr">format</span>=<span class="string">&quot;integer&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;boolAttr&quot;</span> <span class="attr">format</span>=<span class="string">&quot;boolean&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;floatAttr&quot;</span> <span class="attr">format</span>=<span class="string">&quot;float&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;stringAttr&quot;</span> <span class="attr">format</span>=<span class="string">&quot;string&quot;</span> /&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">declare-styleable</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>使用</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">com.example.viewtest.view.AttrTestView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">...</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:intAttr</span>=<span class="string">&quot;52&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:boolAttr</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:floatAttr</span>=<span class="string">&quot;0.56&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:stringAttr</span>=<span class="string">&quot;hello&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>获取值，后面的参数提供无结果时默认值</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> intAttr = array.getInt(R.styleable.AttrTestView_intAttr, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">boolean</span> boolAttr = array.getBoolean(R.styleable.AttrTestView_boolAttr, <span class="keyword">false</span>);</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">float</span> floatAttr = array.getFloat(R.styleable.AttrTestView_floatAttr, <span class="number">0F</span>);</span><br><span class="line"><span class="keyword">final</span> String stringAttr = array.getString(R.styleable.AttrTestView_stringAttr);</span><br></pre></td></tr></table></figure>



<h3 id="色彩和尺寸类型"><a href="#色彩和尺寸类型" class="headerlink" title="色彩和尺寸类型"></a>色彩和尺寸类型</h3><ul>
<li>定义</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;dimenAttr&quot;</span> <span class="attr">format</span>=<span class="string">&quot;dimension&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;colorAttr&quot;</span> <span class="attr">format</span>=<span class="string">&quot;color&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>使用，色彩类型可指定16进制颜色值或资源的引用，尺寸类型可指定支持的尺寸类型和引用</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">com.example.viewtest.view.AttrTestView</span></span></span><br><span class="line"><span class="tag">   <span class="attr">...</span></span></span><br><span class="line"><span class="tag">   <span class="attr">app:dimenAttr</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">app:dimenAttr</span>=<span class="string">&quot;15px&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">app:dimenAttr</span>=<span class="string">&quot;@dimen/testDimen&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">app:colorAttr</span>=<span class="string">&quot;@color/testColor&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">app:colorAttr</span>=<span class="string">&quot;#ffaabbcc&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>获取值</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> colorAttr = array.getColor(R.styleable.AttrTestView_colorAttr, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">float</span> dimenAttr = array.getDimension(R.styleable.AttrTestView_dimenAttr, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>



<h3 id="引用类型"><a href="#引用类型" class="headerlink" title="引用类型"></a>引用类型</h3><ul>
<li>定义</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;refAttr&quot;</span> <span class="attr">format</span>=<span class="string">&quot;reference&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>使用，引用类型可指定各种资源的引用</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">com.example.viewtest.view.AttrTestView</span></span></span><br><span class="line"><span class="tag">   <span class="attr">...</span></span></span><br><span class="line"><span class="tag">   <span class="attr">app:refAttr</span>=<span class="string">&quot;@dimen/testDimen&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">app:refAttr</span>=<span class="string">&quot;@drawable/ic_test&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">app:refAttr</span>=<span class="string">&quot;@string/testString&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">app:refAttr</span>=<span class="string">&quot;@color/testColor&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>获取时，针对对应的资源类型获取</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Drawable refIcon = array.getDrawable(R.styleable.AttrTestView_refAttr);</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> refColor = array.getColor(R.styleable.AttrTestView_refAttr, <span class="number">0</span>);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>



<h3 id="百分比类型"><a href="#百分比类型" class="headerlink" title="百分比类型"></a>百分比类型</h3><ul>
<li>定义</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;fractionAttr&quot;</span> <span class="attr">format</span>=<span class="string">&quot;fraction&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>使用，有两种方式，默认(x%)和带有分母因子(x%p)的，在获取时有差异</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">com.example.viewtest.view.AttrTestView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">...</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:fractionAttr</span>=<span class="string">&quot;10%&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:fractionAttr</span>=<span class="string">&quot;10%p&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>获取方法的定义</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> base  标准分数形式的因子</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pbase 母体分数形式的因子(nn%p)</span></span><br><span class="line"><span class="comment"> * base 对应 10% 形式 pbase 对应 10%p 形式，两者不能存在</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">getFraction</span><span class="params">(<span class="keyword">int</span> index, <span class="keyword">int</span> base, <span class="keyword">int</span> pbase, <span class="keyword">float</span> defValue)</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>获取示例</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app:fractionAttr=&quot;10%&quot;</span></span><br><span class="line"><span class="comment">/* result is 0.2 */</span></span><br><span class="line">array.getFraction(R.styleable.AttrTestView_fractionAttr, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0F</span>);</span><br><span class="line"><span class="comment">/* result is 0.2 */</span></span><br><span class="line">array.getFraction(R.styleable.AttrTestView_fractionAttr, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0F</span>);</span><br><span class="line"><span class="comment">// app:fractionAttr=&quot;10%p&quot;</span></span><br><span class="line"><span class="comment">/* result is 0.2 */</span></span><br><span class="line">array.getFraction(R.styleable.AttrTestView_fractionAttr, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0F</span>);</span><br><span class="line"><span class="comment">/* result is 0.2 */</span></span><br><span class="line">array.getFraction(R.styleable.AttrTestView_fractionAttr, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0F</span>);</span><br></pre></td></tr></table></figure>



<h3 id="flag-类型"><a href="#flag-类型" class="headerlink" title="flag 类型"></a>flag 类型</h3><ul>
<li>定义，flag 可指定一组限制值，定义后，属性只能使用组内的数值，数值类型为数字</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;flagAttr&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">flag</span> <span class="attr">name</span>=<span class="string">&quot;FLAG_0&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0x01&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">flag</span> <span class="attr">name</span>=<span class="string">&quot;FLAG_1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0x02&quot;</span> /&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">attr</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>使用，使用时还可以使用按位或 <code>|</code> 运算符组合多个值</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">com.example.viewtest.view.AttrTestView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">...</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:flagAttr</span>=<span class="string">&quot;FLAG_0|FLAG_1&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:flagAttr</span>=<span class="string">&quot;FLAG_0&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>使用获取整形的方式获取值</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> flagAttr = array.getInt(R.styleable.AttrTestView_flagAttr, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>



<h3 id="枚举类型"><a href="#枚举类型" class="headerlink" title="枚举类型"></a>枚举类型</h3><ul>
<li>定义，和 flag 定义形式相同，不过可以组合 integer 类型</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;enumAttr&quot;</span> <span class="attr">format</span>=<span class="string">&quot;integer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">flag</span> <span class="attr">name</span>=<span class="string">&quot;ENUM_0&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">flag</span> <span class="attr">name</span>=<span class="string">&quot;ENUM_1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">attr</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>当组合 Integer 类型时，可直接指定数字，否则和 flag 一样，只能使用组内定义的值</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">com.example.viewtest.view.AttrTestView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">...</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:flagAttr</span>=<span class="string">&quot;123&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:flagAttr</span>=<span class="string">&quot;ENUM_0|ENUM_1&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:flagAttr</span>=<span class="string">&quot;ENUM_0&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>获取</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> enumAttr = array.getInt(R.styleable.AttrTestView_enumAttr, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>



<h2 id="自定义-View"><a href="#自定义-View" class="headerlink" title="自定义 View"></a>自定义 View</h2><ul>
<li>实现一个自定义 View，首先需要定义自身尺寸，然后绘制自身内容，最后提供自定义的 View 属性。</li>
</ul>
<ul>
<li>首先需要实现 <code>onMeasure</code> 测量方法，以指明 View 尺寸，根据 measureSpec 参数中的模式和基础尺寸，确定最终尺寸，下面提供一种通用的实现：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> baseWidth = View.MeasureSpec.getSize(widthMeasureSpec);</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> baseHeight = View.MeasureSpec.getSize(heightMeasureSpec);</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> widthMode = View.MeasureSpec.getMode(widthMeasureSpec);</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> heightMode = View.MeasureSpec.getMode(heightMeasureSpec);</span><br><span class="line">  <span class="comment">/* </span></span><br><span class="line"><span class="comment">    如果是精确模式（match_parent 或 固定尺寸）则使用获取的基础尺寸，否则使用</span></span><br><span class="line"><span class="comment">    基础尺寸和提供的 wrapSize 的最小值。</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> width = widthMode == MeasureSpec.EXACTLY ?</span><br><span class="line">      baseWidth : Math.min(baseWidth, getWrapWidth(baseWidth));</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> height = heightMode == MeasureSpec.EXACTLY ?</span><br><span class="line">      baseHeight : Math.min(baseWidth, getWrapHeight(baseHeight));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">super</span>.onMeasure(MeasureSpec.makeMeasureSpec(width, widthMode),</span><br><span class="line">      MeasureSpec.makeMeasureSpec(height, heightMode));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里最后调用的父类的 <code>onMeasure</code> 方法，将会调用 <code>setMeasuredDimension</code> 方法设置自身尺寸，当然也可以直接调用这个方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class="line">    setMeasuredDimension(getDefaultSize(getSuggestedMinimumWidth(), widthMeasureSpec),</span><br><span class="line">        getDefaultSize(getSuggestedMinimumHeight(), heightMeasureSpec));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 <code>onMeasure</code> 方法执行后，可以使用 <code>getMeasuredWidth()</code> 和 <code>getMeasuredHeight()</code> 获取自身宽高</p>
<ul>
<li>实现 <code>onDraw</code> 方法，绘制 View 内容，使用 Canvas 和 Paint 组合进行绘制工作</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">super</span>.onDraw(canvas);</span><br><span class="line">  <span class="comment">/* 绘制自定义图形 */</span></span><br><span class="line">  canvas.drawXX(...);</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面编写一个非常简单的自定义View，模拟一个简单的按钮，当手触摸上去时，会变色，手指放开时，颜色还原。</p>
<h3 id="SimpleButtonTest-实例"><a href="#SimpleButtonTest-实例" class="headerlink" title="SimpleButtonTest 实例"></a>SimpleButtonTest 实例</h3><p>首先建立一个空的 SimpleButtonTest 类，需要实现父类的构造器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSimpleButton</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">TestSimpleButton</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(context, <span class="keyword">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">TestSimpleButton</span><span class="params">(Context context, <span class="meta">@Nullable</span> AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">TestSimpleButton</span><span class="params">(Context context, <span class="meta">@Nullable</span> AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义控件的尺寸，重写 <code>onMeasure</code>，这里为内容包裹模式提供了一个固定的尺寸</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> baseWidth = View.MeasureSpec.getSize(widthMeasureSpec);</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> baseHeight = View.MeasureSpec.getSize(heightMeasureSpec);</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> widthMode = View.MeasureSpec.getMode(widthMeasureSpec);</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> heightMode = View.MeasureSpec.getMode(heightMeasureSpec);</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    如果是精确模式（match_parent 或 固定尺寸）则使用获取的基础尺寸，否则使用</span></span><br><span class="line"><span class="comment">    基础尺寸和提供的 wrapSize 的最小值。</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">int</span> wrapWidth = getWrapWidth();</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> width = widthMode == MeasureSpec.EXACTLY ?</span><br><span class="line">      baseWidth : Math.min(baseWidth, wrapWidth);</span><br><span class="line">  <span class="keyword">int</span> wrapHeight = getWrapHeight();</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> height = heightMode == MeasureSpec.EXACTLY ?</span><br><span class="line">      baseHeight : Math.min(baseWidth, wrapHeight);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">super</span>.onMeasure(MeasureSpec.makeMeasureSpec(width, widthMode),</span><br><span class="line">      MeasureSpec.makeMeasureSpec(height, heightMode));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 提供内容包裹时的宽和高 88dp, 64dp */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getWrapWidth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">int</span>)TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, <span class="number">88F</span>,</span><br><span class="line">      getResources().getDisplayMetrics());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getWrapHeight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">int</span>)TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, <span class="number">64F</span>,</span><br><span class="line">      getResources().getDisplayMetrics());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后实现手指触摸时的颜色变化，首先绘制颜色，重写 <code>onDraw</code> 方法绘制内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> mColor;</span><br><span class="line">...</span><br><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">    canvas.drawColor(mBtnColor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义两种状态时的色彩</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> mPressedColor;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> mBtnColor;</span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">TestSimpleButton</span><span class="params">(Context context, <span class="meta">@Nullable</span> AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line"></span><br><span class="line">  mColor = getResources().getColor(R.color.colorPrimary);</span><br><span class="line">  mPressedColor = getResources().getColor(R.color.colorPrimaryDark);</span><br><span class="line">  mBtnColor = mColor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现触摸的监听需要重写 <code>onTouchEvent</code> 方法，为了使 View 的事件默认不被拦截，所以需要在构造器中设置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setClickable(<span class="keyword">true</span>);</span><br><span class="line">setFocusable(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>

<p>最后实现 <code>onTouchEvent</code> 方法的内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> actionMasked = event.getActionMasked();</span><br><span class="line">    <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">      mBtnColor = mPressedColor;</span><br><span class="line">      <span class="comment">/* 重绘 */</span></span><br><span class="line">      invalidate();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_UP) &#123;</span><br><span class="line">      mBtnColor = mColor;</span><br><span class="line">      invalidate();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(event);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>其中的 <code>invalidate</code> 方法为请求 View 重新绘制，他将会再次回调 <code>onDraw</code> 方法刷新绘制的内容，此时颜色改变，View 的显示自然发生变化。<br>以上就完成了一个简单 View 的自定义。</p>
<h2 id="LayoutParams"><a href="#LayoutParams" class="headerlink" title="LayoutParams"></a>LayoutParams</h2><p>LayoutParams 是设置在 View 上的与父布局相关属性的映射。一个View在xml文件中设置的属性由两部分组成，一部分属于 View 自身的属性，交给 View 自身处理，另一部分属于 LayoutParams，交给所在的 ViewGroup 处理。</p>
<p>系统默认提供了 <code>ViewGroup.LayoutParams</code>，它本身拥有丰富的属性，如果需要自定义自己的 LayoutParams，需要实现它的子类。</p>
<p>一般 LayoutParams 的属性都是带有 <code>layout_</code> 前缀的属性，例如 <code>layout_width</code> ，<code>layout_Height</code> ，自定义属性时也许需要遵循这个命名规范。</p>
<p>下面自定义一个简单的 LayoutParams，由于 LayoutParams 必须有关联的的 ViewGroup 的支持，所以这里先定义一个空的 ViewGroup。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestViewGroup</span> <span class="keyword">extends</span> <span class="title">ViewGroup</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure>

<p>然后和 View 的自定义属性一样，首先定义 <code>attrs.xml</code> 文件，一般 LayoutParams 的 <code>styleable</code> 的 <code>name</code> 属性定义为 ViewGroup 的名称加 <code>_Layout</code> 后缀。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">declare-styleable</span> <span class="attr">name</span>=<span class="string">&quot;TestViewGroup_Layout&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;layout_gravity&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flag</span> <span class="attr">name</span>=<span class="string">&quot;left&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0x0001&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flag</span> <span class="attr">name</span>=<span class="string">&quot;right&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0x0002&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flag</span> <span class="attr">name</span>=<span class="string">&quot;top&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0x0004&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flag</span> <span class="attr">name</span>=<span class="string">&quot;bottom&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0x0008&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">attr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">declare-styleable</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样就定义了一个简单的 <code>layout_gravity</code> 属性。<br>接下来在 <code>TestViewGroup</code> 实现一个 <code>LayoutParams</code> 来承载上面自定义的属性。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">LayoutParams</span> <span class="keyword">extends</span> <span class="title">LayoutParams</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">LayoutParams</span><span class="params">(Context c, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(c, attrs);</span><br><span class="line">    getGravity(c, attrs);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/* 从 attrs 中解析出 layout_gravity 属性的值 */</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getGravity</span><span class="params">(Context c, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">    TypedArray array = c.obtainStyledAttributes(attrs, R.styleable.TestViewGroup_Layout);</span><br><span class="line">    gravity = array.getInt(R.styleable.TestViewGroup_Layout_layout_gravity, <span class="number">0</span>);</span><br><span class="line">    array.recycle();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后一步，将这个 LayoutParams 与 ViewGroup 相关联，需要重写 ViewGroup 的几个方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestViewGroup</span> <span class="keyword">extends</span> <span class="title">ViewGroup</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">checkLayoutParams</span><span class="params">(ViewGroup.LayoutParams p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> p <span class="keyword">instanceof</span> LayoutParams;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">protected</span> LayoutParams <span class="title">generateDefaultLayoutParams</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> LayoutParams();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">protected</span> LayoutParams <span class="title">generateLayoutParams</span><span class="params">(ViewGroup.LayoutParams p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> LayoutParams(p);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> LayoutParams <span class="title">generateLayoutParams</span><span class="params">(AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> LayoutParams(getContext(), attrs);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现了这些方法后，LayoutParams 就与 ViewGroup 建立了关联，在 ViewGroup 调用 <code>addView</code> 添加子 View 时，会使用上面重新的方法为每个子 View 建立一个 LayoutParams。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ViewGroup.java */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addView</span><span class="params">(View child, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">       ...</span><br><span class="line">       LayoutParams params = child.getLayoutParams();</span><br><span class="line">       <span class="keyword">if</span> (params == <span class="keyword">null</span>) &#123;</span><br><span class="line">           params = generateDefaultLayoutParams();</span><br><span class="line">           <span class="keyword">if</span> (params == <span class="keyword">null</span>) &#123;</span><br><span class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;generateDefaultLayoutParams() cannot return null&quot;</span>);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       addView(child, index, params);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>最后在 XML 布局中使用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">com.example.viewtest.view.TestViewGroup</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">View</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_gravity</span>=<span class="string">&quot;left&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">com.example.viewtest.view.TestViewGroup</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>如果想让自定义的 LayoutParams 支持 Margin 属性， 可以继承 <code>ViewGroup.MarginLayoutParams</code>。</li>
</ul>
<h2 id="自定义-ViewGroup"><a href="#自定义-ViewGroup" class="headerlink" title="自定义 ViewGroup"></a>自定义 ViewGroup</h2><ul>
<li>实现一个 ViewGroup，除了需要实现 View 的基本的尺寸定义和提供自定义属性，还需要实现对子 View 位置的控制，如果需要更为细致的针对每个子 View 有不同的处理，则需要实现自定义的 LayoutParams，</li>
</ul>
<ul>
<li><code>onLayout</code> 方法为必须实现的抽象方法，它是 ViewGroup 的核心，负责控制所有子 View 的位置摆放，具体方法是通过计算子 View 的 left, right, top, bottom 的位置后，调用它们的 <code>layout</code> 方法为每个子 View 设置最终位置。</li>
</ul>
<p>下面将会用一个实例来说明 ViewGroup 的自定义。</p>
<h3 id="BorderLayoutSample-实例"><a href="#BorderLayoutSample-实例" class="headerlink" title="BorderLayoutSample 实例"></a>BorderLayoutSample 实例</h3><p>下面要定义一个类似 Java中的 Border 布局的 ViewGroup，它拥有以下特性：</p>
<ol>
<li>子 View 可使用 <code>layout_gravity</code> 属性设置自身的位置，基本位置属性值包括 <code>left, right, top, bottom, centerX, centerY, center</code> ，还可使用按位或  <code>|</code>  符号组合属性值使用，例如 <code>left | bottom</code> 代表左下方。</li>
<li>为了简单，一旦放入布局中，所有子 View 的尺寸将统一，默认使用最小宽度和最小高度的子View（宽高不为0dp）的尺寸作为统一子 View 尺寸，可以使用 <code>requestWidth</code> 和 <code>requestHeight</code> 请求统一的子 view 的宽和高，BorderLayout 的宽高为统一子 View 宽高的3倍（为了给其他方位的子View留出空间），如果默认和请求的子View尺寸的3倍超过尺寸限制（measureSpec包含的 size），则强制另统一子 View 的尺寸为限制尺寸的 1/3。</li>
<li>如果所有子 View 的宽高都为0，则 BorderLayout 的宽高为0。</li>
</ol>
<p>最终效果如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">com.example.viewtest.view.BorderLayoutSample</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">&quot;#dadada&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:requestHeight</span>=<span class="string">&quot;60dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:requestWidth</span>=<span class="string">&quot;60dp&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--右上方--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">View</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;60dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;60dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">&quot;#ff7474&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_gravity</span>=<span class="string">&quot;right&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--正中间--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">View</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">&quot;#74ff74&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_gravity</span>=<span class="string">&quot;center&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--左边中间--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">View</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;60dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;60dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">&quot;#74b0ff&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_gravity</span>=<span class="string">&quot;centerY&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--右下方--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">View</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;60dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;60dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">&quot;#ffe874&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_gravity</span>=<span class="string">&quot;bottom|right&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">com.example.viewtest.view.BorderLayoutSample</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>实机测试</p>
<p><img src="./border_layout_sample.jpg" alt="border_layout_sample"></p>
<p>下面开始实现 BorderLayoutSample</p>
<p>首先建立 <code>BorderLayoutSample</code> 类，由于继承了 <code>ViewGroup</code> ，并且需要支持自定义属性，所以这里重写了三个构造器方法和一个 <code>onLayout</code> 方法的空实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BorderLayoutSample</span>  <span class="keyword">extends</span> <span class="title">ViewGroup</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">BorderLayoutSample</span> <span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(context, <span class="keyword">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">BorderLayoutSample</span> <span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">BorderLayoutSample</span> <span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> l, <span class="keyword">int</span> t, <span class="keyword">int</span> r, <span class="keyword">int</span> b)</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后是对两个自定义属性 <code>requestWidth</code> 和 <code>requestHeight</code> 的支持，新建 <code>borderlayoutsample_attrs.xml</code> 文件，定义如下属性：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">declare-styleable</span> <span class="attr">name</span>=<span class="string">&quot;BorderLayoutSample&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--请求子View宽度--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;requestWidth&quot;</span> <span class="attr">format</span>=<span class="string">&quot;dimension&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--请求子View高度--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;requestHeight&quot;</span> <span class="attr">format</span>=<span class="string">&quot;dimension&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">declare-styleable</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在构造器中获取值，方便后面访问</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">BorderLayoutSample</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">  init(attrs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">  TypedArray array = getContext().obtainStyledAttributes(attrs, R.styleable.BorderLayoutSample);</span><br><span class="line">  mRequestWidth = array.getDimensionPixelOffset(R.styleable.BorderLayoutSample_requestWidth, -<span class="number">1</span>);</span><br><span class="line">  mRequestHeight = array.getDimensionPixelOffset(R.styleable.BorderLayoutSample_requestHeight, -<span class="number">1</span>);</span><br><span class="line">  array.recycle();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>根据前面定义的 Border布局特性，实现 <code>onMeasure</code> 定义自身尺寸</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">...                                              -</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> mChildWidth = -<span class="number">1</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> mChild Height = -<span class="number">1</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> mRequestWidth;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> mRequestHeight;</span><br><span class="line">...</span><br><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> count = getChildCount();</span><br><span class="line">  <span class="keyword">if</span> (count == <span class="number">0</span>) &#123; <span class="keyword">return</span>; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> baseWidth = MeasureSpec.getSize(widthMeasureSpec);</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> baseHeight = MeasureSpec.getSize(heightMeasureSpec);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (mRequestWidth != -<span class="number">1</span> &amp;&amp; mRequestHeight != -<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">/* 如果指定了最终子View尺寸 则根据 指定的最终子View尺寸 确定 最终子View的尺寸 */</span></span><br><span class="line">    mChildWidth = mRequestWidth * <span class="number">3</span> &gt; baseWidth ? baseWidth / <span class="number">3</span> : mRequestWidth;</span><br><span class="line">    mChildHeight = mRequestHeight * <span class="number">3</span> &gt; baseHeight ? baseHeight / <span class="number">3</span> : mRequestHeight;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">/* 确定请求的子View宽和高(最小的子View尺寸) */</span></span><br><span class="line">    <span class="keyword">int</span> minWidth = Integer.MAX_VALUE;</span><br><span class="line">    <span class="keyword">int</span> minHeight = Integer.MAX_VALUE;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">      View child = getChildAt(i);</span><br><span class="line">      measureChild(child, widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">      <span class="keyword">if</span> (child.getMeasuredWidth() == <span class="number">0</span> || child.getMeasuredHeight() == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      minWidth = Math.min(minWidth, child.getMeasuredWidth());</span><br><span class="line">      minHeight = Math.min(minHeight, child.getMeasuredHeight());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* 如果所有子View尺寸都是0 */</span></span><br><span class="line">    <span class="keyword">if</span> (minWidth == Integer.MAX_VALUE) &#123; minWidth = <span class="number">0</span>; &#125;</span><br><span class="line">    <span class="keyword">if</span> (minHeight == Integer.MAX_VALUE) &#123; minHeight = <span class="number">0</span>; &#125;</span><br><span class="line"></span><br><span class="line">    mChildWidth = minWidth * <span class="number">3</span> &gt; baseWidth ? baseWidth / <span class="number">3</span> : minWidth;</span><br><span class="line">    mChildHeight = minHeight * <span class="number">3</span> &gt; baseHeight ? baseHeight / <span class="number">3</span> : minHeight;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">super</span>.onMeasure(getMeasureSpec(widthMeasureSpec, mChildWidth * <span class="number">3</span>),</span><br><span class="line">      getMeasureSpec(heightMeasureSpec, mChildHeight * <span class="number">3</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 生成 measureSpec */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getMeasureSpec</span><span class="params">(<span class="keyword">int</span> measureSpec, <span class="keyword">int</span> wrapSize)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> baseSize = View.MeasureSpec.getSize(measureSpec);</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> mode = View.MeasureSpec.getMode(measureSpec);</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> size = mode == View.MeasureSpec.AT_MOST <span class="comment">/* dp or match parent */</span> ?</span><br><span class="line">      Math.min(wrapSize, baseSize) : baseSize;</span><br><span class="line">  <span class="keyword">return</span> View.MeasureSpec.makeMeasureSpec(size, mode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中使用了 <code>measureChild</code> 对子 View 进行测量，还可使用 <code>measureChildWithMargins</code> 测量子 View 尺寸，它会在测量时考虑子 View 的 margin 值。</p>
<p> 接着实现核心方法 <code>onLayout</code>，由于需要给子 View 提供 <code>layout_gravity</code> 的属性，这个属性将会影响每个子 View 自身所处位置，这里首先定义 LayoutParams 类来支持这个属性。</p>
<p>在刚才的 <code>borderlayoutsample_attrs.xml</code> 文件中加一个自定义属性</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">declare-styleable</span> <span class="attr">name</span>=<span class="string">&quot;BorderLayoutSample_Layout&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--布局重力--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;layout_gravity&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flag</span> <span class="attr">name</span>=<span class="string">&quot;left&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0x0001&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flag</span> <span class="attr">name</span>=<span class="string">&quot;right&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0x0002&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flag</span> <span class="attr">name</span>=<span class="string">&quot;top&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0x0004&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flag</span> <span class="attr">name</span>=<span class="string">&quot;bottom&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0x0008&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flag</span> <span class="attr">name</span>=<span class="string">&quot;centerX&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0x0010&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flag</span> <span class="attr">name</span>=<span class="string">&quot;centerY&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0x0020&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--centerY | centerX--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flag</span> <span class="attr">name</span>=<span class="string">&quot;center&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0x0030&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">attr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">declare-styleable</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在定义 <code>layout_gravity</code> 的属性值的时候，由于需要支持 <code>left|right</code> 形式的组合值，所以需要对属性值进行设计，这里用的就是，<code>0x0001, 0x0002, 0x0004...</code>，他们对应的二进制值分别为 <code>0001,0010,0100,1000...</code> 可以使用按位或运算进行组合和区分。</p>
<p>定义属性文件后，实现对应的 LayoutParams 类，这里先抽出一个对应 <code>gravity</code> 属性值的类 <code>Gravity</code>，它包含 gravity 属性值的定义和计算。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Gravity</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BASE = <span class="number">0x0001</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> LEFT = BASE;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RIGHT = BASE &lt;&lt; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TOP = BASE &lt;&lt; <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BOTTOM = BASE &lt;&lt; <span class="number">3</span>;</span><br><span class="line">  <span class="comment">/** 0x0010 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CENTER_X = BASE &lt;&lt; <span class="number">4</span>;</span><br><span class="line">  <span class="comment">/** 0x0020 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CENTER_Y = BASE &lt;&lt; <span class="number">5</span>;</span><br><span class="line">  <span class="comment">/** 0x0030 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CENTER = CENTER_X | CENTER_Y;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">hasLeft</span><span class="params">(<span class="keyword">int</span> gravity)</span> </span>&#123; <span class="keyword">return</span> (gravity &amp; LEFT) == LEFT; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">hasRight</span><span class="params">(<span class="keyword">int</span> gravity)</span> </span>&#123; <span class="keyword">return</span> (gravity &amp; RIGHT) == RIGHT; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">hasTop</span><span class="params">(<span class="keyword">int</span> gravity)</span> </span>&#123; <span class="keyword">return</span> (gravity &amp; TOP) == TOP; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">hasBottom</span><span class="params">(<span class="keyword">int</span> gravity)</span> </span>&#123; <span class="keyword">return</span> (gravity &amp; BOTTOM) == BOTTOM; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">hasCenterX</span><span class="params">(<span class="keyword">int</span> gravity)</span> </span>&#123; <span class="keyword">return</span> (gravity &amp; CENTER_X) == CENTER_X; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">hasCenterY</span><span class="params">(<span class="keyword">int</span> gravity)</span> </span>&#123; <span class="keyword">return</span> (gravity &amp; CENTER_Y) == CENTER_Y; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面是 LayoutParams 类的实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">LayoutParams</span> <span class="keyword">extends</span> <span class="title">ViewGroup</span>.<span class="title">LayoutParams</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> gravity = Gravity.LEFT | Gravity.TOP;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">LayoutParams</span><span class="params">()</span> </span>&#123; <span class="keyword">super</span>(<span class="number">0</span>, <span class="number">0</span>); &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">LayoutParams</span><span class="params">(ViewGroup.LayoutParams source)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(source);</span><br><span class="line">    <span class="keyword">if</span> (source <span class="keyword">instanceof</span> LayoutParams) &#123;</span><br><span class="line">      setGravity(((LayoutParams)source).gravity);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">LayoutParams</span><span class="params">(Context c, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(c, attrs);</span><br><span class="line">    getGravity(c, attrs);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getGravity</span><span class="params">(Context c, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">    TypedArray array = c.obtainStyledAttributes(attrs, R.styleable.BorderLayoutSample_Layout);</span><br><span class="line">    gravity = array.getInt(R.styleable.BorderLayoutSample_Layout_layout_gravity, <span class="number">0</span>);</span><br><span class="line">    array.recycle();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGravity</span><span class="params">(<span class="keyword">int</span> gravity)</span> </span>&#123; <span class="keyword">this</span>.gravity = gravity; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getGravity</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> gravity; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后建立 BorderLayoutSample 的关联</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">checkLayoutParams</span><span class="params">(ViewGroup.LayoutParams p)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> p <span class="keyword">instanceof</span> LayoutParams;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">protected</span> LayoutParams <span class="title">generateDefaultLayoutParams</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> LayoutParams();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">protected</span> LayoutParams <span class="title">generateLayoutParams</span><span class="params">(ViewGroup.LayoutParams p)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> LayoutParams(p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> LayoutParams <span class="title">generateLayoutParams</span><span class="params">(AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> LayoutParams(getContext(), attrs);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在完成了 LayoutParams 的定义后，就可以结合属性值进行 <code>onLayout</code> 的最终实现了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> l, <span class="keyword">int</span> t, <span class="keyword">int</span> r, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (mChildWidth == <span class="number">0</span> || mChildHeight == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> count = getChildCount();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">    View child = getChildAt(i);</span><br><span class="line">    LayoutParams layoutParams = (LayoutParams)child.getLayoutParams();</span><br><span class="line">    layoutChild(child, layoutParams.getGravity());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">layoutChild</span><span class="params">(View child, <span class="keyword">int</span> gravity)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> left = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int</span> right = left + mChildWidth;</span><br><span class="line">  <span class="keyword">int</span> top = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int</span> bottom = top + mChildHeight;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> width = getMeasuredWidth();</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> height = getMeasuredHeight();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (Gravity.hasLeft(gravity)) &#123;</span><br><span class="line">    left = <span class="number">0</span>;</span><br><span class="line">    right = left + mChildWidth;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (Gravity.hasRight(gravity)) &#123;</span><br><span class="line">    right = width;</span><br><span class="line">    left = right - mChildWidth;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (Gravity.hasTop(gravity)) &#123;</span><br><span class="line">    top = <span class="number">0</span>;</span><br><span class="line">    bottom = top + mChildHeight;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (Gravity.hasBottom(gravity)) &#123;</span><br><span class="line">    bottom = height;</span><br><span class="line">    top = bottom - mChildHeight;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (Gravity.hasCenterX(gravity)) &#123;</span><br><span class="line">    left = (width - mChildWidth) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    right = left + mChildWidth;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (Gravity.hasCenterY(gravity)) &#123;</span><br><span class="line">    top = (height - mChildHeight) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    bottom = top + mChildHeight;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  child.layout(left, top, right, bottom);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上就完成了一个 BorderLayoutSample 实例。</p>
<h2 id="常用方法总结"><a href="#常用方法总结" class="headerlink" title="常用方法总结"></a>常用方法总结</h2><p>以下记录一些自定义 View 时常用的辅助方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 一般在 onMeasure 方法的末尾调用，用来保存测量后的View宽高，保存后可使用 getMeasureWidth() 和 getMeasureHeight() 方法获取 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setMeasuredDimension</span><span class="params">(<span class="keyword">int</span> measuredWidth, <span class="keyword">int</span> measuredHeight)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 将View的绘制层次提到顶层，在api19(android 4.4)之前调用，还需要在其后调用 requestLayout 和 invalidate 方法刷新图层 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bringToFront</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 使View绘制无效，之后会回调 onDraw 重新绘制，只能在主线程 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">invalidate</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 同 invalidate 可在子线程调用 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">postInvalidate</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 使View布局无效，之后将触发视图树的layout过程 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">requestLayout</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 用父级调用，请求子View计算 mScrollX 和 mScrollY 的新值，通常在使用 Scroller 类的时候重写 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">computeScroll</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>



<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://staticallytyped.wordpress.com/2011/04/16/android-custom-xml-attributes-and-views/">https://staticallytyped.wordpress.com/2011/04/16/android-custom-xml-attributes-and-views/</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://developer.android.com/reference/android/view/View.html">https://developer.android.com/reference/android/view/View.html</a></p>
</li>
</ul>
</div><div class="article-licensing box"><div class="licensing-title"><p>Android 自定义 View</p><p><a href="https://l0neman.github.io/2019/02/12/android-自定义-view/">https://l0neman.github.io/2019/02/12/android-自定义-view/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>l0neman</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2019-02-12</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2019-02-12</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/android/">Android</a><a class="link-muted mr-2" rel="tag" href="/tags/view/">View</a></div><div class="addthis_inline_share_toolbox"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5f0f12c19a2af379" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/img/qrcode/alipay.jpg" alt="支付宝"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/img/qrcode/wxpay.jpg" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2019/02/12/android-activity-%E4%BB%BB%E5%8A%A1%E6%A0%88/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Android Activity 任务栈</span></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><script src="https://utteranc.es/client.js" repo="l0neman/l0neman.github.io" issue-term="pathname" label="comment" theme="github-light" crossorigin="anonymous" async></script></div></div></div><!--!--><div class="column column-right  order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#概述"><span class="level-left"><span class="level-item">1</span><span class="level-item">概述</span></span></a></li><li><a class="level is-mobile" href="#MeasureSpec"><span class="level-left"><span class="level-item">2</span><span class="level-item">MeasureSpec</span></span></a></li><li><a class="level is-mobile" href="#自定义-View-属性"><span class="level-left"><span class="level-item">3</span><span class="level-item">自定义 View 属性</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#概述-1"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">概述</span></span></a></li><li><a class="level is-mobile" href="#基本类型"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">基本类型</span></span></a></li><li><a class="level is-mobile" href="#色彩和尺寸类型"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">色彩和尺寸类型</span></span></a></li><li><a class="level is-mobile" href="#引用类型"><span class="level-left"><span class="level-item">3.4</span><span class="level-item">引用类型</span></span></a></li><li><a class="level is-mobile" href="#百分比类型"><span class="level-left"><span class="level-item">3.5</span><span class="level-item">百分比类型</span></span></a></li><li><a class="level is-mobile" href="#flag-类型"><span class="level-left"><span class="level-item">3.6</span><span class="level-item">flag 类型</span></span></a></li><li><a class="level is-mobile" href="#枚举类型"><span class="level-left"><span class="level-item">3.7</span><span class="level-item">枚举类型</span></span></a></li></ul></li><li><a class="level is-mobile" href="#自定义-View"><span class="level-left"><span class="level-item">4</span><span class="level-item">自定义 View</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#SimpleButtonTest-实例"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">SimpleButtonTest 实例</span></span></a></li></ul></li><li><a class="level is-mobile" href="#LayoutParams"><span class="level-left"><span class="level-item">5</span><span class="level-item">LayoutParams</span></span></a></li><li><a class="level is-mobile" href="#自定义-ViewGroup"><span class="level-left"><span class="level-item">6</span><span class="level-item">自定义 ViewGroup</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#BorderLayoutSample-实例"><span class="level-left"><span class="level-item">6.1</span><span class="level-item">BorderLayoutSample 实例</span></span></a></li></ul></li><li><a class="level is-mobile" href="#常用方法总结"><span class="level-left"><span class="level-item">7</span><span class="level-item">常用方法总结</span></span></a></li><li><a class="level is-mobile" href="#参考"><span class="level-left"><span class="level-item">8</span><span class="level-item">参考</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/android-%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/"><span class="level-start"><span class="level-item">Android 实用工具</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/android-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/"><span class="level-start"><span class="level-item">Android 应用开发</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/android-%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/"><span class="level-start"><span class="level-item">Android 系统原理</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/android-%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/"><span class="level-start"><span class="level-item">Android 逆向工程</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3/"><span class="level-start"><span class="level-item">参考文档</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/"><span class="level-start"><span class="level-item">实用工具</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/"><span class="level-start"><span class="level-item">编程基础</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-06-29T16:45:50.000Z">2021-06-30</time></p><p class="title"><a href="/2021/06/30/%E6%94%AF%E6%8C%81%E8%A7%A6%E6%91%B8%E6%8B%96%E5%8A%A8%E7%9A%84-touchdelegate/">支持触摸拖动的 TouchDelegate</a></p><p class="categories"><a href="/categories/android-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/">Android 应用开发</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-04-21T15:08:15.000Z">2021-04-21</time></p><p class="title"><a href="/2021/04/21/gdb-arm-%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">GDB ARM 交叉编译环境搭建</a></p><p class="categories"><a href="/categories/android-%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/">Android 实用工具</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-04-21T15:04:39.000Z">2021-04-21</time></p><p class="title"><a href="/2021/04/21/dropbear-android-%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4/">Dropbear Android 安装步骤</a></p><p class="categories"><a href="/categories/android-%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/">Android 实用工具</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-04-21T14:49:48.000Z">2021-04-21</time></p><p class="title"><a href="/2021/04/21/material-design-%E5%8F%82%E8%80%83/">Material Design 参考</a></p><p class="categories"><a href="/categories/%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3/">参考文档</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-04-21T10:20:58.000Z">2021-04-21</time></p><p class="title"><a href="/2021/04/21/android-avd-%E4%BD%8D%E7%BD%AE%E4%BF%AE%E6%94%B9/">Android AVD 位置修改</a></p><p class="categories"><a href="/categories/android-%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/">Android 实用工具</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2021/06/"><span class="level-start"><span class="level-item">六月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">四月 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/01/"><span class="level-start"><span class="level-item">一月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/11/"><span class="level-start"><span class="level-item">十一月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">十月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/09/"><span class="level-start"><span class="level-item">九月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">七月 2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/06/"><span class="level-start"><span class="level-item">六月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/04/"><span class="level-start"><span class="level-item">四月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/02/"><span class="level-start"><span class="level-item">二月 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/arm/"><span class="tag">ARM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/avd/"><span class="tag">AVD</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/activity/"><span class="tag">Activity</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/android/"><span class="tag">Android</span><span class="tag">23</span></a></div><div class="control"><a class="tags has-addons" href="/tags/assembly/"><span class="tag">Assembly</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/binder/"><span class="tag">Binder</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/classloader/"><span class="tag">ClassLoader</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/computer/"><span class="tag">Computer</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dex/"><span class="tag">Dex</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/elf/"><span class="tag">ELF</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/emulator/"><span class="tag">Emulator</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">Git</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jni/"><span class="tag">JNI</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/java/"><span class="tag">Java</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/log/"><span class="tag">Log</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/make/"><span class="tag">Make</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/makefile/"><span class="tag">Makefile</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/markdown/"><span class="tag">MarkDown</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/metrial/"><span class="tag">Metrial</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ndk/"><span class="tag">NDK</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/regex/"><span class="tag">Regex</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssh/"><span class="tag">SSH</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/theme/"><span class="tag">Theme</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/touch/"><span class="tag">Touch</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/view/"><span class="tag">View</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xposed/"><span class="tag">Xposed</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/zygote/"><span class="tag">Zygote</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/aapt/"><span class="tag">aapt</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%83%AD%E4%BF%AE%E5%A4%8D/"><span class="tag">热修复</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%83%AD%E6%9B%B4%E6%96%B0/"><span class="tag">热更新</span><span class="tag">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="l0neman 的博客" height="28"></a><p class="is-size-7"><span>&copy; 2021 l0neman</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/l0neman"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>