<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Android 二进制 XML 文件解析 - l0neman 的博客</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="l0neman 的博客"><meta name="msapplication-TileImage" content="/img/avatar.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="l0neman 的博客"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="前言Android SDK 在编译 Android 工程时，将会把诸如资源文件和清单文件之类的相关 XML 文件编译为特定的二进制格式，目的是为了压缩其容量以及优化其在运行时的解析效率。 将 XML 文件编译为二进制的 XML 文件是 Android 编译资源时的一个子步骤，Android 在完整的资源编译过程结束后将会生成一个 resources.arsc 文件，它是一个资源文件表，应用在运行时"><meta property="og:type" content="blog"><meta property="og:title" content="Android 二进制 XML 文件解析"><meta property="og:url" content="https://l0neman.github.io/2020/05/04/android-%E4%BA%8C%E8%BF%9B%E5%88%B6-xml-%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90/"><meta property="og:site_name" content="l0neman 的博客"><meta property="og:description" content="前言Android SDK 在编译 Android 工程时，将会把诸如资源文件和清单文件之类的相关 XML 文件编译为特定的二进制格式，目的是为了压缩其容量以及优化其在运行时的解析效率。 将 XML 文件编译为二进制的 XML 文件是 Android 编译资源时的一个子步骤，Android 在完整的资源编译过程结束后将会生成一个 resources.arsc 文件，它是一个资源文件表，应用在运行时"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://l0neman.github.io/2020/05/04/android-%E4%BA%8C%E8%BF%9B%E5%88%B6-xml-%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90/android_xml_struct.png"><meta property="article:published_time" content="2020-05-04T15:03:52.000Z"><meta property="article:modified_time" content="2020-05-04T15:03:52.000Z"><meta property="article:author" content="l0neman"><meta property="article:tag" content="Android"><meta property="article:tag" content="aapt"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="./android_xml_struct.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://l0neman.github.io/2020/05/04/android-%E4%BA%8C%E8%BF%9B%E5%88%B6-xml-%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90/"},"headline":"Android 二进制 XML 文件解析","image":["https://l0neman.github.io/2020/05/04/android-%E4%BA%8C%E8%BF%9B%E5%88%B6-xml-%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90/android_xml_struct.png"],"datePublished":"2020-05-04T15:03:52.000Z","dateModified":"2020-05-04T15:03:52.000Z","author":{"@type":"Person","name":"l0neman"},"publisher":{"@type":"Organization","name":"l0neman 的博客","logo":{"@type":"ImageObject","url":"https://l0neman.github.io/img/logo.png"}},"description":"前言Android SDK 在编译 Android 工程时，将会把诸如资源文件和清单文件之类的相关 XML 文件编译为特定的二进制格式，目的是为了压缩其容量以及优化其在运行时的解析效率。 将 XML 文件编译为二进制的 XML 文件是 Android 编译资源时的一个子步骤，Android 在完整的资源编译过程结束后将会生成一个 resources.arsc 文件，它是一个资源文件表，应用在运行时"}</script><link rel="canonical" href="https://l0neman.github.io/2020/05/04/android-%E4%BA%8C%E8%BF%9B%E5%88%B6-xml-%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90/"><link rel="icon" href="/img/avatar.png"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.15.2/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?1727d76e0a823184efc8776f32a916a9";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="l0neman 的博客" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/l0neman"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-three-quarters"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-05-04T15:03:52.000Z" title="2020/5/4 下午11:03:52">2020-05-04</time>发表</span><span class="level-item"><time dateTime="2020-05-04T15:03:52.000Z" title="2020/5/4 下午11:03:52">2020-05-04</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/android-%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/">Android 逆向工程</a></span><span class="level-item">36 分钟读完 (大约5404个字)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">Android 二进制 XML 文件解析</h1><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Android SDK 在编译 Android 工程时，将会把诸如资源文件和清单文件之类的相关 XML 文件编译为特定的二进制格式，目的是为了压缩其容量以及优化其在运行时的解析效率。</p>
<p>将 XML 文件编译为二进制的 XML 文件是 Android 编译资源时的一个子步骤，Android 在完整的资源编译过程结束后将会生成一个 <code>resources.arsc</code> 文件，它是一个资源文件表，应用在运行时会将它映射在内存中，为了资源的查询和引用。编译 Xml 文件为生成 arsc 文件的一个子步骤，如果 Xml 文件中引用了资源，例如字符串资源，那么 Xml 文件中引用字符串的位置将会包含一个全局字串池的索引，通过索引在 arsc 文件中的全局字符串池中即可查询到引用的具体字符串。</p>
<p>有关 arsc 文件的结构和解析方法可参考：<a href="/2020/07/17/android-arsc-%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90/">Android arsc 文件解析</a>。</p>
<span id="more"></span>


<h2 id="XML-文件结构"><a href="#XML-文件结构" class="headerlink" title="XML 文件结构"></a>XML 文件结构</h2><p>编译后的二进制文件结构如下图：</p>
<p><img src="./android_xml_struct.png"></p>
<p>和 arsc 文件的构成方式类似，二进制 XML 文件的结构也是由若干 Chunk 结构组成，且它们在 Android 源码中的 <code>ResourceTypes.h</code> 头文件中均有对应结构的定义。下面分别说明二进制 Xml 中 4 部分 Chunk 的内容。</p>
<h3 id="XML-Chunk-Header"><a href="#XML-Chunk-Header" class="headerlink" title="XML Chunk Header"></a>XML Chunk Header</h3><p>XML Chunk Header 描述了 XML 文件的基本信息，它在 <code>ResourceTypes.h</code> 中的结构为 <code>struct ResXMLTree_header</code>，这里使用 Java 描述为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResXMLTreeHeader</span> <span class="keyword">implements</span> <span class="title">Struct</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * &#123;<span class="doctag">@link</span> ResChunkHeader#type&#125; = &#123;<span class="doctag">@link</span> ResourceTypes#RES_XML_TYPE&#125;</span></span><br><span class="line"><span class="comment">   * &lt;p&gt;</span></span><br><span class="line"><span class="comment">   * &#123;<span class="doctag">@link</span> ResChunkHeader#headerSize&#125; = sizeOf(ResXMLTreeHeader.class) 表示头部大小。</span></span><br><span class="line"><span class="comment">   * &lt;p&gt;</span></span><br><span class="line"><span class="comment">   * &#123;<span class="doctag">@link</span> ResChunkHeader#size&#125; = 整个二进制 Xml 文件的大小，包括头部的大小。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> ResChunkHeader header;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中 <code>ResChunkHeader</code> 为资源 Chunk 的基础描述头部结构，对应的定义为 <code>struct ResChunk_header</code>，Java 表示为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResChunkHeader</span> <span class="keyword">implements</span> <span class="title">Struct</span> </span>&#123;</span><br><span class="line">  <span class="comment">/** Chunk 类型 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">short</span> type;</span><br><span class="line">  <span class="comment">/** Chunk 头部大小 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">short</span> headerSize;</span><br><span class="line">  <span class="comment">/** Chunk 大小 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">int</span> size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 XML 文件中，此时的 <code>type</code> 值为 <code>0x003</code>  等于 <code>ResourceTypes.h</code> 中定义的 XML 类型的 type 值：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里使用 Java 描述。</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResourceTypes</span> </span>&#123;</span><br><span class="line">2<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">short</span> RES_XML_TYPE = <span class="number">0x0003</span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>headerSize</code> 为 <code>ResXMLTreeHeader</code> 头部结构自身的大小，即 <code>ResChunkHeader</code> 的大小，为 8 字节。</p>
<p><code>size</code> 为当前 Chunk 大小，此时为 XML 文件的大小，包括头结构的大小。</p>
<h3 id="String-Pool-Chunk"><a href="#String-Pool-Chunk" class="headerlink" title="String Pool Chunk"></a>String Pool Chunk</h3><p>String Pool Chunk 为字符串池结构，它包含了此 XML 文件中出现的所有字符串内容。它的结构和 arsc 文件中的全局字符串结构完全一致，下面是引用上篇解析 arsc 文件中的字符串池的描述：</p>
<p>字符串池包括如下几个部分：</p>
<ol>
<li>ResStringPool_header 字符串池头部，包含字符串池的信息，大小，数量，数组偏移等。</li>
<li>String Offset Array 字符串在字符串内容中的字节位置数组，32 位 int 类型。</li>
<li>Style Offset Array 字符串样式在字符串样式中的字节位置数组，32 位 int 类型。</li>
<li>String Content 字符串内容块。</li>
<li>Style Content 字符串样式块。</li>
</ol>
<p>字符串池的头部使用 <code>struct ResStringPool_header</code> 数据结构描述，Java 表示为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 字符串池头部。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResStringPoolHeader</span> <span class="keyword">implements</span> <span class="title">Struct</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SORTED_FLAG = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> UTF8_FLAG = <span class="number">1</span> &lt;&lt; <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * &#123;<span class="doctag">@link</span> ResChunkHeader#type&#125; = &#123;<span class="doctag">@link</span> ResourceTypes#RES_STRING_POOL_TYPE&#125;</span></span><br><span class="line"><span class="comment">   * &lt;p&gt;</span></span><br><span class="line"><span class="comment">   * &#123;<span class="doctag">@link</span> ResChunkHeader#headerSize&#125; = sizeOf(ResStringPoolHeader.class) 表示头部大小。</span></span><br><span class="line"><span class="comment">   * &lt;p&gt;</span></span><br><span class="line"><span class="comment">   * &#123;<span class="doctag">@link</span> ResChunkHeader#size&#125; = 整个字符串 Chunk 的大小，包括 headerSize 的大小。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> ResChunkHeader header;</span><br><span class="line">  <span class="comment">/** 字符串的数量 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">int</span> stringCount;</span><br><span class="line">  <span class="comment">/** 字符串样式的数量 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">int</span> styleCount;</span><br><span class="line">  <span class="comment">/** 0, SORTED_FLAG, UTF8_FLAG 它们的组合值 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">int</span> flags;</span><br><span class="line">  <span class="comment">/** 字符串内容块相对于其头部的距离 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">int</span> stringStart;</span><br><span class="line">  <span class="comment">/** 字符串样式块相对于其头部的距离 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">int</span> styleStart;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中 <code>flags</code> 包含 <code>UTF8_FLAG</code> 表示字符串格式为 utf8， <code>SORTED_FLAG</code> 表示已排序。</p>
<p>字符串的偏移数组使用 <code>struct ResStringPool_ref</code> 数据结构描述，Java 表示为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 字符串在字符串内容块中的字节偏移。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResStringPoolRef</span> <span class="keyword">implements</span> <span class="title">Struct</span></span>&#123;</span><br><span class="line">  <span class="comment">/** 字符串在字符串池中的索引 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">int</span> index;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>字符串样式则使用 <code>struct ResStringPool_span</code> 数据结构描述，Java 表示为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 字符串样式块中的字符串样式信息。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResStringPoolSpan</span> <span class="keyword">implements</span> <span class="title">Struct</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> END = <span class="number">0xFFFFFFFF</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 本样式在字符串内容块中的字节位置 */</span></span><br><span class="line">  <span class="keyword">public</span> ResStringPoolRef name;</span><br><span class="line">  <span class="comment">/** 包含样式的字符串的第一个字符索引 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">int</span> firstChar;</span><br><span class="line">  <span class="comment">/** 包含样式的字符串的最后一个字符索引 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">int</span> lastChar;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中 <code>name</code> 表示字符串样式本身字符串的索引，比如 <code>&lt;b&gt;</code> 样式本身的字符串为 b，即为 b 在字符串池中的索引。 </p>
<p><code>firstChar</code> 和 <code>lastChar</code> 则为具有样式的字符串的中字符串首位的索引，例如 <code>he&lt;b&gt;ll&lt;/b&gt;o</code>，则为 2 和 3。</p>
<p>字符串样式块和字符串内容块是一一对应的，就是说第一个字符串的样式对应第一个字符串样式块中的样式，如果对应的字符串中有不具有样式的字符串，则对应的 <code>ResStringPool_span</code> 的 <code>name</code> 为 <code>0xFFFFFFFF</code>，起占位的作用。</p>
<h3 id="Resource-Ids-Chunk"><a href="#Resource-Ids-Chunk" class="headerlink" title="Resource Ids Chunk"></a>Resource Ids Chunk</h3><p>Resource Ids Chunk 包含了 xml 文件中相关的资源 ID，例如 AndroidManifest.xml 中 <code>versionCode</code> 属性的 id 为 <code>0x0101021b</code>，那么 Resource Ids 块中就包括这个 id 值。</p>
<p>这里 Resource Ids Chunk 的结构很简单，包含一个 <code>struct ResChunk_header</code> 结构的 <code>header</code>，然后后面包含一个大小为 <code>header.size - header.headerSize</code> 的 int 型 id 数组。</p>
<h3 id="XML-Content-Chunk"><a href="#XML-Content-Chunk" class="headerlink" title="XML Content Chunk"></a>XML Content Chunk</h3><p>XML Content Chunk 是二进制 XML 的核心块结构，包含了 XML 的主要内容。</p>
<h4 id="ResXMLTree-node"><a href="#ResXMLTree-node" class="headerlink" title="ResXMLTree_node"></a>ResXMLTree_node</h4><p>此 Chunk 结构包含多种子 Chunk 结构，它们都有相同的头部结构，使用 <code>struct ResXMLTree_node</code> 结构描述，Java 表示为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResXMLTreeNode</span> <span class="keyword">implements</span> <span class="title">Struct</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * &#123;<span class="doctag">@link</span> ResChunkHeader#type&#125; =</span></span><br><span class="line"><span class="comment">   * &#123;<span class="doctag">@link</span> ResourceTypes#RES_XML_START_NAMESPACE_TYPE&#125; or</span></span><br><span class="line"><span class="comment">   * &#123;<span class="doctag">@link</span> ResourceTypes#RES_XML_END_NAMESPACE_TYPE&#125; or</span></span><br><span class="line"><span class="comment">   * &#123;<span class="doctag">@link</span> ResourceTypes#RES_XML_START_ELEMENT_TYPE&#125; or</span></span><br><span class="line"><span class="comment">   * &#123;<span class="doctag">@link</span> ResourceTypes#RES_XML_END_ELEMENT_TYPE&#125; or</span></span><br><span class="line"><span class="comment">   * &#123;<span class="doctag">@link</span> ResourceTypes#RES_XML_CDATA_TYPE&#125;</span></span><br><span class="line"><span class="comment">   * &lt;p&gt;</span></span><br><span class="line"><span class="comment">   * &#123;<span class="doctag">@link</span> ResChunkHeader#headerSize&#125; = sizeOf(ResXMLTreeNode.class) 表示头部大小。</span></span><br><span class="line"><span class="comment">   * &lt;p&gt;</span></span><br><span class="line"><span class="comment">   * if (type == RES_XML_START_NAMESPACE_TYPE)</span></span><br><span class="line"><span class="comment">   * &lt;p&gt;</span></span><br><span class="line"><span class="comment">   * &#123;<span class="doctag">@link</span> ResChunkHeader#size&#125; = sizeof(ResXMLTreeNode.class) + sizeof(ResXMLTreeNamespaceExt.class)</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> ResChunkHeader header;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 命名空间开始标签在原来文本格式的 XML 文件出现的行号</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">int</span> lineNumber;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 命名空间的注释在字符池资源池的索引。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> ResStringPoolRef comment;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中 <code>header</code> 描述此 Chunk 的基本信息，<code>lineNumber</code> 保存了原始行号，<code>comment</code> 则为注释信息。</p>
<p>Start Namespace Chunk</p>
<p>当一个 XML 文件包含命名空间时，首次解析到的 Chunk 为 <code>Start Namespace Chunk</code>，然后后面解析到和 XML 命名空间数量一致的 <code>Start Namespace Chunk</code>，它们使用 <code>struct ResXMLTree_namespaceExt </code> 结构描述，Java 表示为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResXMLTreeNamespaceExt</span> <span class="keyword">implements</span> <span class="title">Struct</span> </span>&#123;</span><br><span class="line">  <span class="comment">/** 命名空间字符串在字符串资源池中的索引 */</span></span><br><span class="line">  <span class="keyword">public</span> ResStringPoolRef prefix;</span><br><span class="line">  <span class="comment">/** uri 字符串在字符串资源池中的索引 */</span></span><br><span class="line">  <span class="keyword">public</span> ResStringPoolRef uri;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中包含命名空间的 <code>prefix</code> 和 <code>uri</code>，例如布局文件中经常出现的：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xmlns:http://schemas.android.com/apk/res/android=&quot;android&quot;</span><br></pre></td></tr></table></figure>

<p>它的 <code>prefix</code> 为 <code>android</code>，<code>uri</code> 为 <code>http://schemas.android.com/apk/res/android</code></p>
<h4 id="Start-Element-Chunk"><a href="#Start-Element-Chunk" class="headerlink" title="Start Element Chunk"></a>Start Element Chunk</h4><p>当有 XML 元素标签出现时，将会解析到 <code>Start Element Chunk</code>，它表示一个元素标签的开始，使用 <code>struct  ResXMLTree_attrExt</code> 结构描述，Java 表示为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResXMLTreeAttrExt</span> <span class="keyword">implements</span> <span class="title">Struct</span> </span>&#123;</span><br><span class="line">  <span class="comment">/** 元素所在命令空间在字符池资源池的索引，未指定则为 -1 */</span></span><br><span class="line">  <span class="keyword">public</span> ResStringPoolRef ns;</span><br><span class="line">  <span class="comment">/** 元素名称在字符串池资源的索引 */</span></span><br><span class="line">  <span class="keyword">public</span> ResStringPoolRef name;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 等于 sizeOf(ResXMLTreeAttrExt.class)，表示元素属性 chunk 相对于 RES_XML_START_ELEMENT_TYPE 头部的偏移。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">short</span> attributeStart;</span><br><span class="line">  <span class="comment">/** sizeOf(ResXMLTreeAttribute.class)，表示每一个属性占据的 chunk 大小 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">short</span> attributeSize;</span><br><span class="line">  <span class="comment">/** 表示属性 chunk 数量 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">short</span> attributeCount;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 如果元素有一个名称为 id 的属性，那么将它出现在属性列表中的位置再加上 1 的值记录在 idIndex 中，否则 idIndex 的值等于 0。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">short</span> idIndex;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 如果元素有一个名称为 class 的属性，那么将它出现在属性列表中的位置再加上 1 的值记录在 classIndex 中，否则 classIndex 的值等于 0。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">short</span> classIndex;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 如果元素有一个名称为 style 的属性，那么将它出现在属性列表中的位置再加上 1 的值记录在 styleIndex 中，否则 styleIndex 的值等于 0。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">short</span> styleIndex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:http:</span>//<span class="attr">schemas.android.com</span>/<span class="attr">apk</span>/<span class="attr">res</span>/<span class="attr">android</span>=<span class="string">&quot;android&quot;</span> <span class="attr">xmlns:http:</span>//<span class="attr">schemas.android.com</span>/<span class="attr">apk</span>/<span class="attr">res-auto</span>=<span class="string">&quot;app&quot;</span> <span class="attr">layout_gravity</span>=<span class="string">&quot;0x00000050&quot;</span> <span class="attr">id</span>=<span class="string">&quot;@0x7f09002b&quot;</span> <span class="attr">background</span>=<span class="string">&quot;@0x0106000d&quot;</span> <span class="attr">layout_width</span>=<span class="string">&quot;-1&quot;</span> <span class="attr">layout_height</span>=<span class="string">&quot;-2&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>它的 <code>name</code> 为 <code>LinearLayout</code>，<code>ns</code> 为 <code>null</code>，<code>attributeCount</code> 等于 <code>5</code>。</p>
<p>通过 <code>ResXMLTree_attrExt</code> 结构给出的元素信息，可以解析出它所包含的属性，属性使用 <code>struct ResXMLTree_attribute</code> 结构描述，使用 Java 表示为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResXMLTreeAttribute</span> <span class="keyword">implements</span> <span class="title">Struct</span> </span>&#123;</span><br><span class="line">  <span class="comment">/** 表示属性的命令空间在字符池资源池的索引，未指定则等于 -1 */</span></span><br><span class="line">  <span class="keyword">public</span> ResStringPoolRef ns;</span><br><span class="line">  <span class="comment">/** 属性名称字符串在字符池资源池的索引 */</span></span><br><span class="line">  <span class="keyword">public</span> ResStringPoolRef name;</span><br><span class="line">  <span class="comment">/** 属性的原始值在字符池资源池的索引，这是可选的，如果不保留，它的值等于 -1 */</span></span><br><span class="line">  <span class="keyword">public</span> ResStringPoolRef rawValue;</span><br><span class="line">  <span class="comment">/** resValue */</span></span><br><span class="line">  <span class="keyword">public</span> ResValue typeValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="CData-Chunk"><a href="#CData-Chunk" class="headerlink" title="CData Chunk"></a>CData Chunk</h4><p>当一个元素标签包含值内容时，将会解析到 CData Chunk 结构。</p>
<p>例如 <code>&lt;string&gt;abc&lt;/string&gt;</code>，其中的 <code>CData</code> 为 abc，CData Chunk 使用 <code>struct ResXMLTree_cdataExt</code> 描述，Java 表示为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResXMLTreeCdataExt</span> <span class="keyword">implements</span> <span class="title">Struct</span> </span>&#123;</span><br><span class="line">  <span class="comment">/** CDATA 原始值在字符串池中的索引 */</span></span><br><span class="line">  <span class="keyword">public</span> ResStringPoolRef data;</span><br><span class="line">  <span class="comment">/** CDATA 的资源类型 */</span></span><br><span class="line">  <span class="keyword">public</span> ResValue typeData;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="End-Element-Chunk"><a href="#End-Element-Chunk" class="headerlink" title="End Element Chunk"></a>End Element Chunk</h4><p>End Element Chunk 表示元素标签的结束，和 Start Element Chunk 对应，它使用 <code>struct ResXMLTree_endElementExt</code> 描述，Java 表示为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResXMLTreeEndElementExt</span> <span class="keyword">implements</span> <span class="title">Struct</span> </span>&#123;</span><br><span class="line">  <span class="comment">/** 元素的命名空间的字符串在字符串池中的索引，未指定则为 -1 */</span></span><br><span class="line">  <span class="keyword">public</span> ResStringPoolRef ns;</span><br><span class="line">  <span class="comment">/** 元素名称字符串在字符串池中的索引 */</span></span><br><span class="line">  <span class="keyword">public</span> ResStringPoolRef name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="End-Namespace-Chunk"><a href="#End-Namespace-Chunk" class="headerlink" title="End Namespace Chunk"></a>End Namespace Chunk</h4><p>End Element Chunk 表示命名空间的结束符，和 Start Namespace Chunk 对应，描述结构也是一样的。</p>
<h3 id="Chunk-Header-Type"><a href="#Chunk-Header-Type" class="headerlink" title="Chunk Header Type"></a>Chunk Header Type</h3><p>上述结构对应的 Chunk Header 的 type 值如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResourceTypes</span> </span>&#123;</span><br><span class="line">  <span class="comment">// XML Chunk Header.</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">short</span> RES_XML_TYPE = <span class="number">0x0003</span>;</span><br><span class="line">  <span class="comment">// String Pool Chunk.</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">short</span> RES_STRING_POOL_TYPE = <span class="number">0x0001</span>;</span><br><span class="line">  <span class="comment">// Start Namespace Chunk.</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">short</span> RES_XML_START_NAMESPACE_TYPE = <span class="number">0x0100</span>;</span><br><span class="line">  <span class="comment">// End Namspace Chunk.</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">short</span> RES_XML_END_NAMESPACE_TYPE = <span class="number">0x0101</span>;</span><br><span class="line">  <span class="comment">// Start Element Chunk.</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">short</span> RES_XML_START_ELEMENT_TYPE = <span class="number">0x0102</span>;</span><br><span class="line">  <span class="comment">// End ELement Chunk.</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">short</span> RES_XML_END_ELEMENT_TYPE = <span class="number">0x0103</span>;</span><br><span class="line">  <span class="comment">// CData Chunk.</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">short</span> RES_XML_CDATA_TYPE = <span class="number">0x0104</span>;</span><br><span class="line">  <span class="comment">// Resource IDs Chunk.</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">short</span> RES_XML_RESOURCE_MAP_TYPE = <span class="number">0x0180</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="XML-文件解析"><a href="#XML-文件解析" class="headerlink" title="XML 文件解析"></a>XML 文件解析</h2><p>为了便于解析，这里使用了我自己写的工具类，参考这里的简介： <a target="_blank" rel="noopener" href="https://github.com/l0neman/program-notes/blob/master/android-notes-reverse/utils_parse.md">ObjectIO</a>。</p>
<h3 id="解析方法"><a href="#解析方法" class="headerlink" title="解析方法"></a>解析方法</h3><p>针对上述二进制 XML 文件结构，采用如下方式进行解析：</p>
<ol>
<li>定义指针变量标识当前解析的字节位置，每解析完一个 chunk 则向下移动指针 chunk 的大小。</li>
<li>采用循环解析的方式，通过 chunk 的 <code>type</code> 判断将要解析哪种 chunk，解析对应的结构。</li>
</ol>
<p>这里定义了 <code>AXmlParser</code> 解析器，<code>mIndex</code> 为指针变量，<code>parse(ObjectIO objectIO)</code> 为解析子方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parse</span><span class="params">(ObjectInput objectInput)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  <span class="comment">// 是否到达文件底部。</span></span><br><span class="line">  <span class="keyword">while</span> (!objectInput.isEof(mIndex)) &#123;</span><br><span class="line">    <span class="comment">// 获取将要解析的 chunk 头部信息。 </span></span><br><span class="line">    ResChunkHeader header = objectInput.read(ResChunkHeader.class, mIndex);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据类型解析对应格式。</span></span><br><span class="line">    <span class="keyword">switch</span> (header.type) &#123;</span><br><span class="line">      <span class="keyword">case</span> ResourceTypes.RES_XML_TYPE: ...</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> ResourceTypes.RES_STRING_POOL_TYPE: ...</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> ResourceTypes.RES_XML_RESOURCE_MAP_TYPE: ...</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> ResourceTypes.RES_XML_START_NAMESPACE_TYPE: ...</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> ResourceTypes.RES_XML_START_ELEMENT_TYPE: ...</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> ResourceTypes.RES_XML_CDATA_TYPE: ...</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> ResourceTypes.RES_XML_END_ELEMENT_TYPE: ...</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> ResourceTypes.RES_XML_END_NAMESPACE_TYPE: ...</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="XML-Chunk-Header-1"><a href="#XML-Chunk-Header-1" class="headerlink" title="XML Chunk Header"></a>XML Chunk Header</h3><p>首先解析 XML Chunk Header，直接一步就行。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AXmlParser.java</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parse</span><span class="params">(ObjectInput objectInput)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  ResChunkHeader header = objectInput.read(ResChunkHeader.class, mIndex);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (header.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> ResourceTypes.RES_XML_TYPE:</span><br><span class="line">      parseXMLTreeHeader(objectInput);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">      ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AXmlParser.java</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parseXMLTreeHeader</span><span class="params">(ObjectInput objectInput)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  ResXMLTreeHeader xmlTreeHeader = objectInput.read(ResXMLTreeHeader.class, mIndex);</span><br><span class="line"></span><br><span class="line">  System.out.println(xmlTreeHeader);</span><br><span class="line">  <span class="comment">// 移动到下一个位置。</span></span><br><span class="line">  mIndex += xmlTreeHeader.header.headerSize;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="String-Pool-Chunk-1"><a href="#String-Pool-Chunk-1" class="headerlink" title="String Pool Chunk"></a>String Pool Chunk</h3><p>接下来是符串池的解析了，解析代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AXmlParser.java</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parse</span><span class="params">(ObjectIO objectIO)</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  ResChunkHeader header = objectIO.read(ResChunkHeader.class, mIndex);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (header.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> ResourceTypes.RES_STRING_POOL_TYPE:</span><br><span class="line">      parseStringPool(objectIO);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">      ...</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AXmlParser.java</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parseStringPool</span><span class="params">(ObjectIO objectIO)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">long</span> stringPoolIndex = mIndex;</span><br><span class="line">  ResStringPoolHeader stringPoolHeader = objectIO.read(ResStringPoolHeader.class, stringPoolIndex);</span><br><span class="line">  System.out.println(<span class="string">&quot;string pool header:&quot;</span>);</span><br><span class="line">  System.out.println(stringPoolHeader);</span><br><span class="line"></span><br><span class="line">  StringPoolChunkParser stringPoolChunkParser = <span class="keyword">new</span> StringPoolChunkParser();</span><br><span class="line">  stringPoolChunkParser.parseStringPoolChunk(objectIO, stringPoolHeader, stringPoolIndex);</span><br><span class="line"></span><br><span class="line">  System.out.println();</span><br><span class="line">  System.out.println(<span class="string">&quot;string index array:&quot;</span>);</span><br><span class="line">  System.out.println(Arrays.toString(stringPoolChunkParser.getStringIndexArray()));</span><br><span class="line"></span><br><span class="line">  System.out.println();</span><br><span class="line">  System.out.println(<span class="string">&quot;style index array:&quot;</span>);</span><br><span class="line">  System.out.println(Arrays.toString(stringPoolChunkParser.getStyleIndexArray()));</span><br><span class="line"></span><br><span class="line">  stringPool = stringPoolChunkParser.getStringPool();</span><br><span class="line"></span><br><span class="line">  System.out.println();</span><br><span class="line">  System.out.println(<span class="string">&quot;string pool:&quot;</span>);</span><br><span class="line">  System.out.println(Arrays.toString(stringPool));</span><br><span class="line"></span><br><span class="line">  System.out.println();</span><br><span class="line">  System.out.println(<span class="string">&quot;style pool:&quot;</span>);</span><br><span class="line">  <span class="keyword">final</span> List&lt;ResStringPoolSpan&gt;[] stylePool = stringPoolChunkParser.getStylePool();</span><br><span class="line"></span><br><span class="line">  System.out.println(Arrays.toString(stylePool));</span><br><span class="line"></span><br><span class="line">  System.out.println();</span><br><span class="line">  System.out.println(<span class="string">&quot;style detail:&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> (List&lt;ResStringPoolSpan&gt; spans : stylePool) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;---------&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (ResStringPoolSpan span : spans) &#123;</span><br><span class="line">      System.out.println(stringPool[span.name.index]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 向下移动字符串池的大小。</span></span><br><span class="line">  mIndex += stringPoolHeader.header.size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// StringPoolChunkParser.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringPoolChunkParser</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> ResStringPoolRef[] stringIndexArray;</span><br><span class="line">  <span class="keyword">private</span> ResStringPoolRef[] styleIndexArray;</span><br><span class="line">  <span class="keyword">private</span> String[] stringPool;</span><br><span class="line">  <span class="keyword">private</span> List&lt;ResStringPoolSpan&gt;[] stylePool;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> ResStringPoolRef[] parseStringIndexArray(ObjectIO objectIO, ResStringPoolHeader header, <span class="keyword">long</span> index)</span><br><span class="line">      <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    stringIndexArray = <span class="keyword">new</span> ResStringPoolRef[header.stringCount];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">long</span> start = index;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> resStringPoolRefSize = ObjectIO.sizeOf(ResStringPoolRef.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; header.stringCount; i++) &#123;</span><br><span class="line">      stringIndexArray[i] = objectIO.read(ResStringPoolRef.class, start);</span><br><span class="line">      start += resStringPoolRefSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> stringIndexArray;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> ResStringPoolRef[] parseStyleIndexArray(ObjectIO objectIO, ResStringPoolHeader header, <span class="keyword">long</span> index)</span><br><span class="line">      <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    styleIndexArray = <span class="keyword">new</span> ResStringPoolRef[header.styleCount];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">long</span> start = index;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> resStringPoolRefSize = ObjectIO.sizeOf(ResStringPoolRef.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; header.styleCount; i++) &#123;</span><br><span class="line">      styleIndexArray[i] = objectIO.read(ResStringPoolRef.class, start);</span><br><span class="line">      start += resStringPoolRefSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> styleIndexArray;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">parseStringLength</span><span class="params">(<span class="keyword">byte</span>[] b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> b[<span class="number">1</span>] &amp; <span class="number">0x7F</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> String[] parseStringPool(ObjectIO objectIO, ResStringPoolHeader header, <span class="keyword">long</span> stringPoolIndex)</span><br><span class="line">      <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    String[] stringPool = <span class="keyword">new</span> String[header.stringCount];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; header.stringCount; i++) &#123;</span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">long</span> index = stringPoolIndex + stringIndexArray[i].index;</span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">int</span> parseStringLength = parseStringLength(objectIO.readBytes(index, Short.BYTES));</span><br><span class="line">      <span class="comment">// 经过测试，发现 flags 为0 时，字符串每个字符间会间隔一个空白符，长度变为 2 倍。</span></span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">int</span> stringLength = header.flags == <span class="number">0</span> ? parseStringLength * <span class="number">2</span> : parseStringLength;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// trim 去除多余空白符。</span></span><br><span class="line">      stringPool[i] = Formatter.trim(<span class="keyword">new</span> String(objectIO.readBytes(index + Short.BYTES, stringLength), <span class="number">0</span>,</span><br><span class="line">          stringLength, StandardCharsets.UTF_8));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> stringPool;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> List&lt;ResStringPoolSpan&gt;[] parseStylePool(ObjectIO objectIO, ResStringPoolHeader header, <span class="keyword">long</span> stylePoolIndex)</span><br><span class="line">      <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    List&lt;ResStringPoolSpan&gt;[] stylePool = <span class="keyword">new</span> List[header.styleCount];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; header.styleCount; i++) &#123;</span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">long</span> index = stylePoolIndex + styleIndexArray[i].index;</span><br><span class="line">      <span class="keyword">int</span> end = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">long</span> littleIndex = index;</span><br><span class="line"></span><br><span class="line">      List&lt;ResStringPoolSpan&gt; stringPoolSpans = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">      <span class="keyword">while</span> (end != ResStringPoolSpan.END) &#123;</span><br><span class="line">        ResStringPoolSpan stringPoolSpan = objectIO.read(ResStringPoolSpan.class, littleIndex);</span><br><span class="line">        stringPoolSpans.add(stringPoolSpan);</span><br><span class="line"></span><br><span class="line">        littleIndex += ObjectIO.sizeOf(ResStringPoolSpan.class);</span><br><span class="line"></span><br><span class="line">        end = objectIO.readInt(littleIndex);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      stylePool[i] = stringPoolSpans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> stylePool;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">parseStringPoolChunk</span><span class="params">(ObjectIO objectIO, ResStringPoolHeader header, <span class="keyword">long</span> stringPoolHeaderIndex)</span></span></span><br><span class="line"><span class="function">      <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">// parse string index array.</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">long</span> stringIndexArrayIndex = stringPoolHeaderIndex + ObjectIO.sizeOf(ResStringPoolHeader.class);</span><br><span class="line"></span><br><span class="line">    stringIndexArray = header.stringCount == <span class="number">0</span> ? <span class="keyword">new</span> ResStringPoolRef[<span class="number">0</span>] :</span><br><span class="line">        parseStringIndexArray(objectIO, header, stringIndexArrayIndex);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">long</span> styleIndexArrayIndex = stringIndexArrayIndex + header.stringCount *</span><br><span class="line">        ObjectIO.sizeOf(ResStringPoolRef.class);</span><br><span class="line"></span><br><span class="line">    styleIndexArray = header.styleCount == <span class="number">0</span> ? <span class="keyword">new</span> ResStringPoolRef[<span class="number">0</span>] :</span><br><span class="line">        parseStyleIndexArray(objectIO, header, styleIndexArrayIndex);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// parse string pool.</span></span><br><span class="line">    <span class="keyword">if</span> (header.stringCount != <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">long</span> stringPoolIndex = stringPoolHeaderIndex + header.stringStart;</span><br><span class="line">      stringPool = parseStringPool(objectIO, header, stringPoolIndex);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      stringPool = <span class="keyword">new</span> String[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// parse style pool.</span></span><br><span class="line">    <span class="keyword">if</span> (header.styleCount != <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">long</span> stylePoolIndex = stringPoolHeaderIndex + header.styleStart;</span><br><span class="line">      stylePool = parseStylePool(objectIO, header, stylePoolIndex);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">//noinspection unchecked</span></span><br><span class="line">      stylePool = <span class="keyword">new</span> List[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> ResStringPoolRef[] getStringIndexArray() &#123;</span><br><span class="line">    <span class="keyword">return</span> stringIndexArray;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> ResStringPoolRef[] getStyleIndexArray() &#123;</span><br><span class="line">    <span class="keyword">return</span> styleIndexArray;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String[] getStringPool() &#123;</span><br><span class="line">    <span class="keyword">return</span> stringPool;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> List&lt;ResStringPoolSpan&gt;[] getStylePool() &#123;</span><br><span class="line">    <span class="keyword">return</span> stylePool;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Resource-Ids-Chunk-1"><a href="#Resource-Ids-Chunk-1" class="headerlink" title="Resource Ids Chunk"></a>Resource Ids Chunk</h3><p>解析如下，根据 Chunk 头部，解析出 id 数量，然后逐个解析。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AXmlParser.java</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parse</span><span class="params">(ObjectInput objectInput)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  ResChunkHeader header = objectInput.read(ResChunkHeader.class, mIndex);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (header.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> ResourceTypes.RES_XML_RESOURCE_MAP_TYPE:</span><br><span class="line">      parseResourceIds(objectInput);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">      ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AXmlParser.java</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parseResourceIds</span><span class="params">(ObjectInput objectInput)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  ResChunkHeader header = objectInput.read(ResChunkHeader.class, mIndex);</span><br><span class="line">  <span class="comment">// 解析 xml 文件中出现的资源 ID。</span></span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> size = header.size;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> count = (size - header.headerSize) / Integer.BYTES;</span><br><span class="line">  <span class="keyword">int</span> index = mIndex + header.headerSize;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">    <span class="comment">// 转化为 16 进制输出。</span></span><br><span class="line">    System.out.println(<span class="string">&quot;resId: &quot;</span> + Formatter.toHex(Formatter.fromInt(</span><br><span class="line">        objectInput.readInt(index), <span class="keyword">true</span></span><br><span class="line">    )));</span><br><span class="line">    index += i * Integer.BYTES;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  mIndex += header.size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="XML-Content-Chunk-1"><a href="#XML-Content-Chunk-1" class="headerlink" title="XML Content Chunk"></a>XML Content Chunk</h3><p>解析来是解析 XML 内容，每种 XML Chunk 都包含有相同的头部结构 <code>struct ResXMLTree_node</code>，它包含一个 XML Chunk 块的基本信息和行号，所以需要首先解析它。</p>
<h4 id="Start-Namespace-Chunk"><a href="#Start-Namespace-Chunk" class="headerlink" title="Start Namespace Chunk"></a>Start Namespace Chunk</h4><p>直接解析即可：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AXmlParser.java</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parse</span><span class="params">(ObjectInput objectInput)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  ResChunkHeader header = objectInput.read(ResChunkHeader.class, mIndex);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (header.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> ResourceTypes.RES_XML_START_NAMESPACE_TYPE:</span><br><span class="line">      parseStartNamespace(objectInput);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">      ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AXmlPArser.java</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parseStartNamespace</span><span class="params">(ObjectInput objectInput)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  ResXMLTreeNode node = objectInput.read(ResXMLTreeNode.class, mIndex);</span><br><span class="line">  <span class="comment">// 跳过已解析过的头部字节。</span></span><br><span class="line">  <span class="keyword">int</span> namespaceExtIndex = mIndex + node.header.headerSize;</span><br><span class="line">  <span class="comment">// 解析注释。</span></span><br><span class="line">  System.out.println(<span class="string">&quot;node comment: &quot;</span> + (node.comment.index != -<span class="number">1</span> ? stringPool[node.comment.index] : <span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> ResXMLTreeNamespaceExt namespaceExt =</span><br><span class="line">      objectInput.read(ResXMLTreeNamespaceExt.class, namespaceExtIndex);</span><br><span class="line">  <span class="comment">// 解析命名空间名字。</span></span><br><span class="line">  String namespace = stringPool[namespaceExt.prefix.index];</span><br><span class="line">  System.out.println(<span class="string">&quot;namepsace name: &quot;</span> + namespace);</span><br><span class="line">  <span class="comment">// 解析命名空间 uri。</span></span><br><span class="line">  String namespaceUri = stringPool[namespaceExt.uri.index];</span><br><span class="line">  System.out.println(<span class="string">&quot;namepsace uri: &quot;</span> + namespaceUri);</span><br><span class="line"></span><br><span class="line">  mIndex += node.header.size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="Start-Element-Chunk-1"><a href="#Start-Element-Chunk-1" class="headerlink" title="Start Element Chunk"></a>Start Element Chunk</h4><p>直接上代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AXmlParser.java</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parse</span><span class="params">(ObjectInput objectInput)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  ResChunkHeader header = objectInput.read(ResChunkHeader.class, mIndex);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (header.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> ResourceTypes.RES_XML_START_ELEMENT_TYPE:</span><br><span class="line">      parseStartElement(objectInput);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">      ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AXmlParser.java</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parseStartElement</span><span class="params">(ObjectInput objectInput)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  ResXMLTreeNode node = objectInput.read(ResXMLTreeNode.class, mIndex);</span><br><span class="line">  System.out.println(<span class="string">&quot;node comment: &quot;</span> + (node.comment.index != -<span class="number">1</span> ? stringPool[node.comment.index] : <span class="string">&quot;&quot;</span>));</span><br><span class="line">  <span class="keyword">int</span> index = mIndex + node.header.headerSize;</span><br><span class="line"></span><br><span class="line">  ResXMLTreeAttrExt attrExt = objectInput.read(ResXMLTreeAttrExt.class, index);</span><br><span class="line">  <span class="comment">// 解析元素命名空间 uri。</span></span><br><span class="line">  String ns = attrExt.ns.index != -<span class="number">1</span> ?</span><br><span class="line">      stringPool[attrExt.ns.index] : <span class="keyword">null</span>;</span><br><span class="line">  System.out.println(<span class="string">&quot;element ns: &quot;</span> + ns);</span><br><span class="line">  <span class="comment">// 解析元素名字。</span></span><br><span class="line">  <span class="keyword">final</span> String elementName = stringPool[attrExt.name.index];</span><br><span class="line">  System.out.println(<span class="string">&quot;element name: &quot;</span> + elementName);</span><br><span class="line">  <span class="comment">// 跳过头部字节。</span></span><br><span class="line">  index += ObjectInput.sizeOf(ResXMLTreeAttrExt.class);</span><br><span class="line">  <span class="comment">// 解析元素属性。</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; attrExt.attributeCount; i++) &#123;</span><br><span class="line">    ResXMLTreeAttribute attr = objectInput.read(ResXMLTreeAttribute.class, index);</span><br><span class="line">    <span class="comment">// 解析属性命名空间 uri。</span></span><br><span class="line">    <span class="keyword">final</span> String namespace = attr.ns.index != -<span class="number">1</span> ?</span><br><span class="line">        stringPool[attr.ns.index] : <span class="keyword">null</span>;</span><br><span class="line">    System.out.println(<span class="string">&quot;attr ns: &quot;</span> + namespace);</span><br><span class="line">    <span class="comment">// 解析属性名字。    </span></span><br><span class="line">    <span class="keyword">final</span> String attrName = stringPool[attr.name.index];</span><br><span class="line">    System.out.println(<span class="string">&quot;attr name: &quot;</span> + attrName);</span><br><span class="line">    <span class="comment">// 解析输属性文本或数值。</span></span><br><span class="line">    <span class="keyword">final</span> String attrText = attr.rawValue.index != -<span class="number">1</span> ?</span><br><span class="line">        stringPool[attr.rawValue.index] : <span class="keyword">null</span>;</span><br><span class="line">    System.out.println(<span class="string">&quot;attr text: &quot;</span> + attrText);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> String attrValue = attr.typeValue.dataStr();</span><br><span class="line">    System.out.println(<span class="string">&quot;attr value: &quot;</span> + attr.typeValue);</span><br><span class="line"></span><br><span class="line">    index += ObjectInput.sizeOf(ResXMLTreeAttribute.class);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  mIndex += node.header.size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的属性数值可能为任何资源类型，其中 <code>Res_Value</code> 结构会包含资源类型，这里根据它的 <code>dataType</code> 简单解析了对应类型。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ResValue.java</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">dataStr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (dataType) &#123;</span><br><span class="line">    <span class="keyword">case</span> TYPE_NULL:</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;null&quot;</span>;</span><br><span class="line">    <span class="keyword">case</span> TYPE_REFERENCE:</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;@&quot;</span> + Formatter.toHex(Formatter.fromInt(data, <span class="keyword">true</span>));</span><br><span class="line">    <span class="keyword">case</span> TYPE_ATTRIBUTE:</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;@:id/&quot;</span> + Formatter.toHex(Formatter.fromInt(data, <span class="keyword">true</span>));</span><br><span class="line">    <span class="keyword">case</span> TYPE_STRING:</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;stringPool[&quot;</span> + data + <span class="string">&#x27;]&#x27;</span>;</span><br><span class="line">    <span class="keyword">case</span> TYPE_FLOAT:</span><br><span class="line">      <span class="keyword">return</span> String.valueOf(data);</span><br><span class="line">    <span class="keyword">case</span> TYPE_DIMENSION:</span><br><span class="line">      <span class="keyword">int</span> complex = data &amp; (COMPLEX_UNIT_MASK &lt;&lt; COMPLEX_UNIT_SHIFT);</span><br><span class="line">      <span class="keyword">switch</span> (complex) &#123;</span><br><span class="line">        <span class="keyword">case</span> COMPLEX_UNIT_PX:</span><br><span class="line">          <span class="keyword">return</span> data + <span class="string">&quot;px&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> COMPLEX_UNIT_DIP:</span><br><span class="line">          <span class="keyword">return</span> data + <span class="string">&quot;dip&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> COMPLEX_UNIT_SP:</span><br><span class="line">          <span class="keyword">return</span> data + <span class="string">&quot;sp&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> COMPLEX_UNIT_PT:</span><br><span class="line">          <span class="keyword">return</span> data + <span class="string">&quot;pt&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> COMPLEX_UNIT_IN:</span><br><span class="line">          <span class="keyword">return</span> data + <span class="string">&quot;in&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> COMPLEX_UNIT_MM:</span><br><span class="line">          <span class="keyword">return</span> data + <span class="string">&quot;mm&quot;</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">          <span class="keyword">return</span> data + <span class="string">&quot;(dimension)&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">case</span> TYPE_FRACTION:</span><br><span class="line">      <span class="keyword">return</span> data + <span class="string">&quot;(fraction)&quot;</span>;</span><br><span class="line">    <span class="keyword">case</span> TYPE_DYNAMIC_REFERENCE:</span><br><span class="line">      <span class="keyword">return</span> data + <span class="string">&quot;(dynamic_reference)&quot;</span>;</span><br><span class="line">    <span class="comment">// case TYPE_FIRST_INT: return &quot;TYPE_FIRST_INT&quot;;</span></span><br><span class="line">    <span class="keyword">case</span> TYPE_INT_DEC:</span><br><span class="line">      <span class="keyword">return</span> String.valueOf(data);</span><br><span class="line">    <span class="keyword">case</span> TYPE_INT_HEX:</span><br><span class="line">      <span class="keyword">return</span> Formatter.toHex(Formatter.fromInt(data, <span class="keyword">true</span>));</span><br><span class="line">    <span class="keyword">case</span> TYPE_INT_BOOLEAN:</span><br><span class="line">      <span class="keyword">return</span> data == <span class="number">0</span> ? <span class="string">&quot;false&quot;</span> : <span class="string">&quot;true&quot;</span>;</span><br><span class="line">    <span class="comment">// case TYPE_FIRST_COLOR_INT: return &quot;TYPE_FIRST_COLOR_INT&quot;;</span></span><br><span class="line">    <span class="keyword">case</span> TYPE_INT_COLOR_ARGB8:</span><br><span class="line">      <span class="keyword">return</span> data + <span class="string">&quot;(argb8)&quot;</span>;</span><br><span class="line">    <span class="keyword">case</span> TYPE_INT_COLOR_RGB8:</span><br><span class="line">      <span class="keyword">return</span> data + <span class="string">&quot;(rgb8)&quot;</span>;</span><br><span class="line">    <span class="keyword">case</span> TYPE_INT_COLOR_ARGB4:</span><br><span class="line">      <span class="keyword">return</span> data + <span class="string">&quot;(argb4)&quot;</span>;</span><br><span class="line">    <span class="keyword">case</span> TYPE_INT_COLOR_RGB4:</span><br><span class="line">      <span class="keyword">return</span> data + <span class="string">&quot;(rgb4)&quot;</span>;</span><br><span class="line">    <span class="comment">// case TYPE_LAST_COLOR_INT: return &quot;TYPE_LAST_COLOR_INT&quot;;</span></span><br><span class="line">    <span class="comment">// case TYPE_LAST_INT: return &quot;TYPE_LAST_INT&quot;;</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> Formatter.toHex(Formatter.fromInt(data, <span class="keyword">true</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="CData-Chunk-1"><a href="#CData-Chunk-1" class="headerlink" title="CData Chunk"></a>CData Chunk</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AXmlParser.java</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parse</span><span class="params">(ObjectInput objectInput)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  ResChunkHeader header = objectInput.read(ResChunkHeader.class, mIndex);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (header.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> ResourceTypes.RES_XML_CDATA_TYPE:</span><br><span class="line">      parseCData(objectInput);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">      ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AXmlParser.java</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parseCData</span><span class="params">(ObjectInput objectInput)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  ResXMLTreeNode node = objectInput.read(ResXMLTreeNode.class, mIndex);</span><br><span class="line">  System.out.println(<span class="string">&quot;node comment: &quot;</span> + (node.comment.index != -<span class="number">1</span> ? stringPool[node.comment.index] : <span class="string">&quot;&quot;</span>));</span><br><span class="line">  <span class="keyword">int</span> index = mIndex + node.header.headerSize;</span><br><span class="line"></span><br><span class="line">  ResXMLTreeCdataExt cdataExt = objectInput.read(ResXMLTreeCdataExt.class, index);</span><br><span class="line">  <span class="comment">// 解析标签内部内容。</span></span><br><span class="line">  <span class="keyword">final</span> String cdata = stringPool[cdataExt.data.index];</span><br><span class="line">  System.out.println(<span class="string">&quot;cdata:&quot;</span> + cdata);</span><br><span class="line"></span><br><span class="line">  mIndex += node.header.size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="End-Element-Chunk-1"><a href="#End-Element-Chunk-1" class="headerlink" title="End Element Chunk"></a>End Element Chunk</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AXmlParser.java</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parse</span><span class="params">(ObjectInput objectInput)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  ResChunkHeader header = objectInput.read(ResChunkHeader.class, mIndex);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (header.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> ResourceTypes.RES_XML_END_ELEMENT_TYPE:</span><br><span class="line">      parseEndElement(objectInput);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">      ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AXmlParser.java</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parseEndElement</span><span class="params">(ObjectInput objectInput)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  ResXMLTreeNode node = objectInput.read(ResXMLTreeNode.class, mIndex);</span><br><span class="line">  System.out.println(<span class="string">&quot;node comment: &quot;</span> + (node.comment.index != -<span class="number">1</span> ? stringPool[node.comment.index] : <span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> index = mIndex + node.header.headerSize;</span><br><span class="line">  </span><br><span class="line">  ResXMLTreeEndElementExt endElementExt = objectInput.read(ResXMLTreeEndElementExt.class, index);</span><br><span class="line">  <span class="comment">// 解析结束元素命名空间 Uri。</span></span><br><span class="line">  <span class="keyword">final</span> String ns = endElementExt.ns.index != -<span class="number">1</span> ?</span><br><span class="line">      stringPool[endElementExt.ns.index] : <span class="string">&quot;&quot;</span>;</span><br><span class="line">  System.out.println(<span class="string">&quot;element end ns: &quot;</span> + ns);</span><br><span class="line">  <span class="comment">// 解析结束元素名字。</span></span><br><span class="line">  <span class="keyword">final</span> String elementName = stringPool[endElementExt.name.index];</span><br><span class="line">  System.out.println(<span class="string">&quot;element end name: &quot;</span> + elementName);</span><br><span class="line"></span><br><span class="line">  mIndex += node.header.size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="End-Namespace-Chunk-1"><a href="#End-Namespace-Chunk-1" class="headerlink" title="End Namespace Chunk"></a>End Namespace Chunk</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AXmlParser.java</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parse</span><span class="params">(ObjectInput objectInput)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  ResChunkHeader header = objectInput.read(ResChunkHeader.class, mIndex);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (header.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> ResourceTypes.RES_XML_END_NAMESPACE_TYPE:</span><br><span class="line">      parseEndNamespace(objectInput);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">      ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AXmlParser.java</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parseEndNamespace</span><span class="params">(ObjectInput objectInput)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  ResXMLTreeNode node = objectInput.read(ResXMLTreeNode.class, mIndex);</span><br><span class="line">  System.out.println(<span class="string">&quot;node comment: &quot;</span> + (node.comment.index != -<span class="number">1</span> ? stringPool[node.comment.index] : <span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> index = mIndex + node.header.headerSize;</span><br><span class="line"></span><br><span class="line">  ResXMLTreeNamespaceExt namespaceExt = objectInput.read(ResXMLTreeNamespaceExt.class, index);</span><br><span class="line">  <span class="comment">// 解析结束命名空间名字。</span></span><br><span class="line">  String namespace = stringPool[namespaceExt.prefix.index];</span><br><span class="line">  System.out.println(<span class="string">&quot;namepsace end name: &quot;</span> + namespace);</span><br><span class="line">  <span class="comment">// 解析结束命名空间 uri。</span></span><br><span class="line">  String namespaceUri = stringPool[namespaceExt.uri.index];</span><br><span class="line">  System.out.println(<span class="string">&quot;namepsace end uri: &quot;</span> + namespaceUri);</span><br><span class="line"></span><br><span class="line">  mIndex += node.header.size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="XML-文档输出"><a href="#XML-文档输出" class="headerlink" title="XML 文档输出"></a>XML 文档输出</h3><p>上面的解析只是将数值打印出来，看起来，并不直观，所以现在需求是将二进制的 XML 转化为一个可读且格式标准的 XML 文档。</p>
<p>这里首先定义了一个 <code>AXmlEditor</code> 负责将解析的数值输出为一个标准 XML 文档。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Android XML 编辑工具。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AXmlEditor</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACTION_OPEN = <span class="string">&quot;open&quot;</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACTION_DATA = <span class="string">&quot;data&quot;</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACTION_CLOSE = <span class="string">&quot;close&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> StringBuilder xmlBuilder;</span><br><span class="line">  <span class="keyword">private</span> String tab = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">private</span> List&lt;String[]&gt; namespaceUris = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">  <span class="keyword">private</span> String lastAction;</span><br><span class="line"></span><br><span class="line">  AXmlEditor() &#123;</span><br><span class="line">    xmlBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    addHeader();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addHeader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    xmlBuilder.append(<span class="string">&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;utf-8\&quot;?&gt;&quot;</span>).append(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 输入一个元素的开始 */</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">openElement</span><span class="params">(String elementName)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 上次是 open 操作，证明本次打开了子标签。</span></span><br><span class="line">    <span class="keyword">if</span> (ACTION_OPEN.equals(lastAction)) &#123;</span><br><span class="line">      xmlBuilder.append(<span class="string">&quot;&gt;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    xmlBuilder.append(tab).append(<span class="string">&#x27;&lt;&#x27;</span>).append(elementName);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 最外层的标签添加命名空间。</span></span><br><span class="line">    <span class="keyword">if</span> (!namespaceUris.isEmpty()) &#123;</span><br><span class="line">      <span class="keyword">for</span> (String[] nu : namespaceUris) &#123;</span><br><span class="line">        xmlBuilder.append(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">            .append(<span class="string">&quot;xmlns:&quot;</span>).append(nu[<span class="number">0</span>]).append(<span class="string">&quot;=\&quot;&quot;</span>).append(nu[<span class="number">1</span>]).append(<span class="string">&quot;\&quot;&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      namespaceUris.clear();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 每打开一个新元素就增加 tab。</span></span><br><span class="line">    tab = tab + <span class="string">&quot;  &quot;</span>;</span><br><span class="line">    lastAction = ACTION_OPEN;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 输入一个命名空间的开始 */</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">addNamespace</span><span class="params">(String namespace, String uri)</span> </span>&#123;</span><br><span class="line">    namespaceUris.add(<span class="keyword">new</span> String[]&#123;namespace, uri&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 输入一个元素的属性 */</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">addAttribute</span><span class="params">(String name, String value)</span> </span>&#123;</span><br><span class="line">    xmlBuilder.append(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">        .append(name).append(<span class="string">&quot;=\&quot;&quot;</span>).append(value).append(<span class="string">&quot;\&quot;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 输入一个元素的标签内容 */</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">addData</span><span class="params">(String data)</span> </span>&#123;</span><br><span class="line">    xmlBuilder.append(<span class="string">&#x27;&gt;&#x27;</span>).append(data);</span><br><span class="line"></span><br><span class="line">    lastAction = ACTION_DATA;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 输入一个元素的结束 */</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">closeElement</span><span class="params">(String elementName)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 每关闭一个元素就减少 tab。</span></span><br><span class="line">    tab = tab.substring(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    StringBuilder t = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 上次是 open 操作，证明不含有子标签。</span></span><br><span class="line">    <span class="keyword">if</span> (ACTION_OPEN.equals(lastAction)) &#123;</span><br><span class="line">      t.append(<span class="string">&quot;&gt;&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ACTION_CLOSE.equals(lastAction)) &#123;</span><br><span class="line">      t.append(tab);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    t.append(<span class="string">&quot;&lt;/&quot;</span>).append(elementName).append(<span class="string">&quot;&gt;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 空标签化简。</span></span><br><span class="line">    <span class="keyword">if</span> (t.toString().contains(<span class="string">&quot;&gt;&lt;&quot;</span>)) &#123;</span><br><span class="line">      t.delete(<span class="number">0</span>, t.length()).append(<span class="string">&quot; /&gt;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    xmlBuilder.append(t);</span><br><span class="line"></span><br><span class="line">    lastAction = ACTION_CLOSE;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 输出 xml 文档 */</span></span><br><span class="line">  <span class="function">String <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> xmlBuilder.toString();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过使用上面的解析器即可打印出如下形式的 XML 文档，除了相关资源需要对应的 arsc 文件才能解析出来，输出的文档和标准文档一致。</p>
<p>实例 AM.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:http:</span>//<span class="attr">schemas.android.com</span>/<span class="attr">apk</span>/<span class="attr">res</span>/<span class="attr">android</span>=<span class="string">&quot;android&quot;</span> <span class="attr">versionCode</span>=<span class="string">&quot;2017082900&quot;</span> <span class="attr">versionName</span>=<span class="string">&quot;1.2.455&quot;</span> <span class="attr">package</span>=<span class="string">&quot;com.zuoxia.iconpack&quot;</span> <span class="attr">platformBuildVersionCode</span>=<span class="string">&quot;25&quot;</span> <span class="attr">platformBuildVersionName</span>=<span class="string">&quot;7.1.1&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">uses-sdk</span> <span class="attr">minSdkVersion</span>=<span class="string">&quot;16&quot;</span> <span class="attr">targetSdkVersion</span>=<span class="string">&quot;25&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">name</span>=<span class="string">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">name</span>=<span class="string">&quot;android.permission.INTERNET&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">name</span>=<span class="string">&quot;android.permission.ACCESS_NETWORK_STATE&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">name</span>=<span class="string">&quot;android.permission.ACCESS_WIFI_STATE&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">name</span>=<span class="string">&quot;android.permission.SET_WALLPAPER&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">name</span>=<span class="string">&quot;android.permission.SET_WALLPAPER_HINTS&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">name</span>=<span class="string">&quot;android.permission.WAKE_LOCK&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">name</span>=<span class="string">&quot;android.permission.RECEIVE_BOOT_COMPLETED&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">name</span>=<span class="string">&quot;android.permission.VIBRATE&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">supports-screens</span> <span class="attr">anyDensity</span>=<span class="string">&quot;true&quot;</span> <span class="attr">smallScreens</span>=<span class="string">&quot;true&quot;</span> <span class="attr">normalScreens</span>=<span class="string">&quot;true&quot;</span> <span class="attr">largeScreens</span>=<span class="string">&quot;true&quot;</span> <span class="attr">resizeable</span>=<span class="string">&quot;true&quot;</span> <span class="attr">xlargeScreens</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">name</span>=<span class="string">&quot;com.google.android.c2dm.permission.RECEIVE&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">permission</span> <span class="attr">name</span>=<span class="string">&quot;com.zuoxia.iconpack.permission.C2D_MESSAGE&quot;</span> <span class="attr">protectionLevel</span>=<span class="string">&quot;0x00000002&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">name</span>=<span class="string">&quot;com.zuoxia.iconpack.permission.C2D_MESSAGE&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">application</span> <span class="attr">theme</span>=<span class="string">&quot;@0x7f0b0059&quot;</span> <span class="attr">label</span>=<span class="string">&quot;@0x7f0800f2&quot;</span> <span class="attr">icon</span>=<span class="string">&quot;@0x7f030000&quot;</span> <span class="attr">allowBackup</span>=<span class="string">&quot;true&quot;</span> <span class="attr">largeHeap</span>=<span class="string">&quot;true&quot;</span> <span class="attr">supportsRtl</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-library</span> <span class="attr">name</span>=<span class="string">&quot;com.sec.android.app.multiwindow&quot;</span> <span class="attr">required</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta-data</span> <span class="attr">name</span>=<span class="string">&quot;com.sec.android.support.multiwindow&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta-data</span> <span class="attr">name</span>=<span class="string">&quot;com.sec.android.multiwindow.DEFAULT_SIZE_W&quot;</span> <span class="attr">value</span>=<span class="string">&quot;632.0dip&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta-data</span> <span class="attr">name</span>=<span class="string">&quot;com.sec.android.multiwindow.DEFAULT_SIZE_H&quot;</span> <span class="attr">value</span>=<span class="string">&quot;598.0dip&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta-data</span> <span class="attr">name</span>=<span class="string">&quot;com.sec.android.multiwindow.MINIMUM_SIZE_W&quot;</span> <span class="attr">value</span>=<span class="string">&quot;632.0dip&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta-data</span> <span class="attr">name</span>=<span class="string">&quot;com.sec.android.multiwindow.MINIMUM_SIZE_H&quot;</span> <span class="attr">value</span>=<span class="string">&quot;598.0dip&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta-data</span> <span class="attr">name</span>=<span class="string">&quot;com.lge.support.SPLIT_WINDOW&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activity</span> <span class="attr">theme</span>=<span class="string">&quot;@0x7f0b00d1&quot;</span> <span class="attr">label</span>=<span class="string">&quot;@0x7f0800f2&quot;</span> <span class="attr">name</span>=<span class="string">&quot;com.zuoxia.iconpack.HomeActivity&quot;</span> <span class="attr">noHistory</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">name</span>=<span class="string">&quot;android.intent.category.MULTIWINDOW_LAUNCHER&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">meta-data</span> <span class="attr">name</span>=<span class="string">&quot;android.app.shortcuts&quot;</span> <span class="attr">resource</span>=<span class="string">&quot;@0x7f070008&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">service</span> <span class="attr">name</span>=<span class="string">&quot;com.zuoxia.iconpack.FirebaseService&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;com.google.firebase.MESSAGING_EVENT&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta-data</span> <span class="attr">name</span>=<span class="string">&quot;com.google.firebase.messaging.default_notification_icon&quot;</span> <span class="attr">resource</span>=<span class="string">&quot;@0x7f02014d&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta-data</span> <span class="attr">name</span>=<span class="string">&quot;com.google.firebase.messaging.default_notification_color&quot;</span> <span class="attr">resource</span>=<span class="string">&quot;@0x7f0e0063&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activity</span> <span class="attr">label</span>=<span class="string">&quot;@0x7f0800f2&quot;</span> <span class="attr">name</span>=<span class="string">&quot;jahirfiquitiva.iconshowcase.activities.ShowcaseActivity&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;android.intent.action.VIEW&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">name</span>=<span class="string">&quot;android.intent.category.DEFAULT&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">name</span>=<span class="string">&quot;android.intent.category.BROWSABLE&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;android.intent.action.SET_WALLPAPER&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">name</span>=<span class="string">&quot;android.intent.category.DEFAULT&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;android.intent.action.GET_CONTENT&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">name</span>=<span class="string">&quot;android.intent.category.DEFAULT&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">name</span>=<span class="string">&quot;android.intent.category.OPENABLE&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">data</span> <span class="attr">mimeType</span>=<span class="string">&quot;image/*&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">      ...</span><br><span class="line">      </span><br><span class="line">      <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;com.lge.launcher2.THEME&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">name</span>=<span class="string">&quot;android.intent.category.DEFAULT&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activity</span> <span class="attr">theme</span>=<span class="string">&quot;@0x7f0b0059&quot;</span> <span class="attr">label</span>=<span class="string">&quot;@0x7f0800c6&quot;</span> <span class="attr">name</span>=<span class="string">&quot;jahirfiquitiva.iconshowcase.activities.AltWallpaperViewerActivity&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">service</span> <span class="attr">label</span>=<span class="string">&quot;@0x7f0800f9&quot;</span> <span class="attr">icon</span>=<span class="string">&quot;@0x7f020149&quot;</span> <span class="attr">name</span>=<span class="string">&quot;jahirfiquitiva.iconshowcase.services.MuzeiArtSourceService&quot;</span> <span class="attr">description</span>=<span class="string">&quot;@0x7f0800f8&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;com.google.android.apps.muzei.api.MuzeiArtSource&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">meta-data</span> <span class="attr">name</span>=<span class="string">&quot;color&quot;</span> <span class="attr">value</span>=<span class="string">&quot;@0x7f0e01be&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">meta-data</span> <span class="attr">name</span>=<span class="string">&quot;settingsActivity&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jahirfiquitiva.iconshowcase.activities.MuzeiSettings&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activity</span> <span class="attr">theme</span>=<span class="string">&quot;@0x7f0b00d1&quot;</span> <span class="attr">label</span>=<span class="string">&quot;@0x7f080080&quot;</span> <span class="attr">name</span>=<span class="string">&quot;jahirfiquitiva.iconshowcase.activities.MuzeiSettings&quot;</span> <span class="attr">exported</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">receiver</span> <span class="attr">label</span>=<span class="string">&quot;@0x7f080064&quot;</span> <span class="attr">icon</span>=<span class="string">&quot;@0x7f020064&quot;</span> <span class="attr">name</span>=<span class="string">&quot;jahirfiquitiva.iconshowcase.widgets.IconRestorerWidget&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;android.appwidget.action.APPWIDGET_UPDATE&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">meta-data</span> <span class="attr">name</span>=<span class="string">&quot;android.appwidget.provider&quot;</span> <span class="attr">resource</span>=<span class="string">&quot;@0x7f070005&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activity</span> <span class="attr">theme</span>=<span class="string">&quot;@0x7f0b0108&quot;</span> <span class="attr">label</span>=<span class="string">&quot;@0x7f0800f2&quot;</span> <span class="attr">name</span>=<span class="string">&quot;jahirfiquitiva.iconshowcase.activities.LauncherIconRestorerActivity&quot;</span> <span class="attr">noHistory</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">receiver</span> <span class="attr">label</span>=<span class="string">&quot;@0x7f080035&quot;</span> <span class="attr">name</span>=<span class="string">&quot;jahirfiquitiva.iconshowcase.widgets.ClockWidget&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;android.appwidget.action.APPWIDGET_UPDATE&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">meta-data</span> <span class="attr">name</span>=<span class="string">&quot;android.appwidget.oldName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.android.deskclock.AnalogAppWidgetProvider&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">meta-data</span> <span class="attr">name</span>=<span class="string">&quot;android.appwidget.provider&quot;</span> <span class="attr">resource</span>=<span class="string">&quot;@0x7f070003&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta-data</span> <span class="attr">name</span>=<span class="string">&quot;jahirfiquitiva.iconshowcase.utilities.GlideConfiguration&quot;</span> <span class="attr">value</span>=<span class="string">&quot;GlideModule&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">service</span> <span class="attr">name</span>=<span class="string">&quot;com.google.firebase.messaging.FirebaseMessagingService&quot;</span> <span class="attr">exported</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">intent-filter</span> <span class="attr">priority</span>=<span class="string">&quot;-500&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;com.google.firebase.MESSAGING_EVENT&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">receiver</span> <span class="attr">name</span>=<span class="string">&quot;com.google.firebase.iid.FirebaseInstanceIdReceiver&quot;</span> <span class="attr">permission</span>=<span class="string">&quot;com.google.android.c2dm.permission.SEND&quot;</span> <span class="attr">exported</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;com.google.android.c2dm.intent.RECEIVE&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;com.google.android.c2dm.intent.REGISTRATION&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">name</span>=<span class="string">&quot;com.zuoxia.iconpack&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">receiver</span> <span class="attr">name</span>=<span class="string">&quot;com.google.firebase.iid.FirebaseInstanceIdInternalReceiver&quot;</span> <span class="attr">exported</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">service</span> <span class="attr">name</span>=<span class="string">&quot;com.google.firebase.iid.FirebaseInstanceIdService&quot;</span> <span class="attr">exported</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">intent-filter</span> <span class="attr">priority</span>=<span class="string">&quot;-500&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;com.google.firebase.INSTANCE_ID_EVENT&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">provider</span> <span class="attr">name</span>=<span class="string">&quot;com.google.firebase.provider.FirebaseInitProvider&quot;</span> <span class="attr">exported</span>=<span class="string">&quot;false&quot;</span> <span class="attr">authorities</span>=<span class="string">&quot;com.zuoxia.iconpack.firebaseinitprovider&quot;</span> <span class="attr">initOrder</span>=<span class="string">&quot;100&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta-data</span> <span class="attr">name</span>=<span class="string">&quot;com.google.android.gms.version&quot;</span> <span class="attr">value</span>=<span class="string">&quot;@0x7f0d000e&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>实例 layout.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:http:</span>//<span class="attr">schemas.android.com</span>/<span class="attr">apk</span>/<span class="attr">res</span>/<span class="attr">android</span>=<span class="string">&quot;android&quot;</span> <span class="attr">xmlns:http:</span>//<span class="attr">schemas.android.com</span>/<span class="attr">apk</span>/<span class="attr">res-auto</span>=<span class="string">&quot;app&quot;</span> <span class="attr">layout_gravity</span>=<span class="string">&quot;0x00000050&quot;</span> <span class="attr">id</span>=<span class="string">&quot;@0x7f09002b&quot;</span> <span class="attr">background</span>=<span class="string">&quot;@0x0106000d&quot;</span> <span class="attr">layout_width</span>=<span class="string">&quot;-1&quot;</span> <span class="attr">layout_height</span>=<span class="string">&quot;-2&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">orientation</span>=<span class="string">&quot;0&quot;</span> <span class="attr">id</span>=<span class="string">&quot;@0x7f09002a&quot;</span> <span class="attr">background</span>=<span class="string">&quot;@0x7f08044a&quot;</span> <span class="attr">paddingTop</span>=<span class="string">&quot;@0x7f07006f&quot;</span> <span class="attr">paddingBottom</span>=<span class="string">&quot;@0x7f07006f&quot;</span> <span class="attr">layout_width</span>=<span class="string">&quot;-1&quot;</span> <span class="attr">layout_height</span>=<span class="string">&quot;-2&quot;</span> <span class="attr">baselineAligned</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">id</span>=<span class="string">&quot;@0x7f0900a1&quot;</span> <span class="attr">background</span>=<span class="string">&quot;@:id/0x7f040199&quot;</span> <span class="attr">clipChildren</span>=<span class="string">&quot;false&quot;</span> <span class="attr">layout_width</span>=<span class="string">&quot;1dip&quot;</span> <span class="attr">layout_height</span>=<span class="string">&quot;-2&quot;</span> <span class="attr">layout_weight</span>=<span class="string">&quot;1065353216&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ImageView</span> <span class="attr">id</span>=<span class="string">&quot;@0x7f0900a0&quot;</span> <span class="attr">padding</span>=<span class="string">&quot;@0x7f07006f&quot;</span> <span class="attr">focusable</span>=<span class="string">&quot;false&quot;</span> <span class="attr">clickable</span>=<span class="string">&quot;false&quot;</span> <span class="attr">clipChildren</span>=<span class="string">&quot;false&quot;</span> <span class="attr">layout_width</span>=<span class="string">&quot;-2&quot;</span> <span class="attr">layout_height</span>=<span class="string">&quot;-2&quot;</span> <span class="attr">layout_marginTop</span>=<span class="string">&quot;@0x7f07006f&quot;</span> <span class="attr">layout_marginBottom</span>=<span class="string">&quot;@0x7f07006f&quot;</span> <span class="attr">layout_centerInParent</span>=<span class="string">&quot;true&quot;</span> <span class="attr">contentDescription</span>=<span class="string">&quot;@0x7f100093&quot;</span> <span class="attr">srcCompat</span>=<span class="string">&quot;@0x7f0804ee&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">id</span>=<span class="string">&quot;@0x7f090065&quot;</span> <span class="attr">background</span>=<span class="string">&quot;@:id/0x7f040199&quot;</span> <span class="attr">clipChildren</span>=<span class="string">&quot;false&quot;</span> <span class="attr">layout_width</span>=<span class="string">&quot;1dip&quot;</span> <span class="attr">layout_height</span>=<span class="string">&quot;-2&quot;</span> <span class="attr">layout_weight</span>=<span class="string">&quot;1065353216&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ImageView</span> <span class="attr">id</span>=<span class="string">&quot;@0x7f090064&quot;</span> <span class="attr">padding</span>=<span class="string">&quot;@0x7f07006f&quot;</span> <span class="attr">focusable</span>=<span class="string">&quot;false&quot;</span> <span class="attr">clickable</span>=<span class="string">&quot;false&quot;</span> <span class="attr">layout_width</span>=<span class="string">&quot;-2&quot;</span> <span class="attr">layout_height</span>=<span class="string">&quot;-2&quot;</span> <span class="attr">layout_marginTop</span>=<span class="string">&quot;@0x7f07006f&quot;</span> <span class="attr">layout_marginBottom</span>=<span class="string">&quot;@0x7f07006f&quot;</span> <span class="attr">layout_centerInParent</span>=<span class="string">&quot;true&quot;</span> <span class="attr">contentDescription</span>=<span class="string">&quot;@0x7f100073&quot;</span> <span class="attr">srcCompat</span>=<span class="string">&quot;@0x7f0804e3&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">id</span>=<span class="string">&quot;@0x7f090024&quot;</span> <span class="attr">background</span>=<span class="string">&quot;@:id/0x7f040199&quot;</span> <span class="attr">clipChildren</span>=<span class="string">&quot;false&quot;</span> <span class="attr">layout_width</span>=<span class="string">&quot;1dip&quot;</span> <span class="attr">layout_height</span>=<span class="string">&quot;-2&quot;</span> <span class="attr">layout_weight</span>=<span class="string">&quot;1065353216&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ImageView</span> <span class="attr">id</span>=<span class="string">&quot;@0x7f090023&quot;</span> <span class="attr">padding</span>=<span class="string">&quot;@0x7f07006f&quot;</span> <span class="attr">focusable</span>=<span class="string">&quot;false&quot;</span> <span class="attr">clickable</span>=<span class="string">&quot;false&quot;</span> <span class="attr">layout_width</span>=<span class="string">&quot;-2&quot;</span> <span class="attr">layout_height</span>=<span class="string">&quot;-2&quot;</span> <span class="attr">layout_marginTop</span>=<span class="string">&quot;@0x7f07006f&quot;</span> <span class="attr">layout_marginBottom</span>=<span class="string">&quot;@0x7f07006f&quot;</span> <span class="attr">layout_centerInParent</span>=<span class="string">&quot;true&quot;</span> <span class="attr">contentDescription</span>=<span class="string">&quot;@0x7f100038&quot;</span> <span class="attr">srcCompat</span>=<span class="string">&quot;@0x7f0804d4&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">id</span>=<span class="string">&quot;@0x7f09007a&quot;</span> <span class="attr">background</span>=<span class="string">&quot;@:id/0x7f040199&quot;</span> <span class="attr">clipChildren</span>=<span class="string">&quot;false&quot;</span> <span class="attr">layout_width</span>=<span class="string">&quot;1dip&quot;</span> <span class="attr">layout_height</span>=<span class="string">&quot;-2&quot;</span> <span class="attr">layout_weight</span>=<span class="string">&quot;1065353216&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ImageView</span> <span class="attr">id</span>=<span class="string">&quot;@0x7f090079&quot;</span> <span class="attr">padding</span>=<span class="string">&quot;@0x7f07006f&quot;</span> <span class="attr">focusable</span>=<span class="string">&quot;false&quot;</span> <span class="attr">clickable</span>=<span class="string">&quot;false&quot;</span> <span class="attr">clipChildren</span>=<span class="string">&quot;false&quot;</span> <span class="attr">layout_width</span>=<span class="string">&quot;-2&quot;</span> <span class="attr">layout_height</span>=<span class="string">&quot;-2&quot;</span> <span class="attr">layout_marginTop</span>=<span class="string">&quot;@0x7f07006f&quot;</span> <span class="attr">layout_marginBottom</span>=<span class="string">&quot;@0x7f07006f&quot;</span> <span class="attr">layout_centerInParent</span>=<span class="string">&quot;true&quot;</span> <span class="attr">contentDescription</span>=<span class="string">&quot;@0x7f100080&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><p><a target="_blank" rel="noopener" href="https://github.com/l0neman/program-notes/blob/master/android-notes-reverse/project/android_arsc_parse/README.md">AXmlParser</a> 可直接打印标准格式的文档。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/luoshengyang/article/details/8744683">Android应用程序资源的编译和打包过程分析</a></li>
</ul>
</div><div class="article-licensing box"><div class="licensing-title"><p>Android 二进制 XML 文件解析</p><p><a href="https://l0neman.github.io/2020/05/04/android-二进制-xml-文件解析/">https://l0neman.github.io/2020/05/04/android-二进制-xml-文件解析/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>l0neman</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2020-05-04</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2020-05-04</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/android/">Android</a><a class="link-muted mr-2" rel="tag" href="/tags/aapt/">aapt</a></div><div class="addthis_inline_share_toolbox"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5f0f12c19a2af379" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/img/qrcode/alipay.jpg" alt="支付宝"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/img/qrcode/wxpay.jpg" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/06/03/8086-%E8%B4%AA%E5%90%83%E8%9B%87/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">8086 贪吃蛇</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2019/04/08/android-binder-%E8%AE%BE%E8%AE%A1%E5%88%86%E6%9E%90/"><span class="level-item">Android Binder 设计分析</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><script src="https://utteranc.es/client.js" repo="l0neman/l0neman.github.io" issue-term="pathname" label="comment" theme="github-light" crossorigin="anonymous" async></script></div></div></div><!--!--><div class="column column-right  order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#前言"><span class="level-left"><span class="level-item">1</span><span class="level-item">前言</span></span></a></li><li><a class="level is-mobile" href="#XML-文件结构"><span class="level-left"><span class="level-item">2</span><span class="level-item">XML 文件结构</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#XML-Chunk-Header"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">XML Chunk Header</span></span></a></li><li><a class="level is-mobile" href="#String-Pool-Chunk"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">String Pool Chunk</span></span></a></li><li><a class="level is-mobile" href="#Resource-Ids-Chunk"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">Resource Ids Chunk</span></span></a></li><li><a class="level is-mobile" href="#XML-Content-Chunk"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">XML Content Chunk</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#ResXMLTree-node"><span class="level-left"><span class="level-item">2.4.1</span><span class="level-item">ResXMLTree_node</span></span></a></li><li><a class="level is-mobile" href="#Start-Element-Chunk"><span class="level-left"><span class="level-item">2.4.2</span><span class="level-item">Start Element Chunk</span></span></a></li><li><a class="level is-mobile" href="#CData-Chunk"><span class="level-left"><span class="level-item">2.4.3</span><span class="level-item">CData Chunk</span></span></a></li><li><a class="level is-mobile" href="#End-Element-Chunk"><span class="level-left"><span class="level-item">2.4.4</span><span class="level-item">End Element Chunk</span></span></a></li><li><a class="level is-mobile" href="#End-Namespace-Chunk"><span class="level-left"><span class="level-item">2.4.5</span><span class="level-item">End Namespace Chunk</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Chunk-Header-Type"><span class="level-left"><span class="level-item">2.5</span><span class="level-item">Chunk Header Type</span></span></a></li></ul></li><li><a class="level is-mobile" href="#XML-文件解析"><span class="level-left"><span class="level-item">3</span><span class="level-item">XML 文件解析</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#解析方法"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">解析方法</span></span></a></li><li><a class="level is-mobile" href="#XML-Chunk-Header-1"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">XML Chunk Header</span></span></a></li><li><a class="level is-mobile" href="#String-Pool-Chunk-1"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">String Pool Chunk</span></span></a></li><li><a class="level is-mobile" href="#Resource-Ids-Chunk-1"><span class="level-left"><span class="level-item">3.4</span><span class="level-item">Resource Ids Chunk</span></span></a></li><li><a class="level is-mobile" href="#XML-Content-Chunk-1"><span class="level-left"><span class="level-item">3.5</span><span class="level-item">XML Content Chunk</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Start-Namespace-Chunk"><span class="level-left"><span class="level-item">3.5.1</span><span class="level-item">Start Namespace Chunk</span></span></a></li><li><a class="level is-mobile" href="#Start-Element-Chunk-1"><span class="level-left"><span class="level-item">3.5.2</span><span class="level-item">Start Element Chunk</span></span></a></li><li><a class="level is-mobile" href="#CData-Chunk-1"><span class="level-left"><span class="level-item">3.5.3</span><span class="level-item">CData Chunk</span></span></a></li><li><a class="level is-mobile" href="#End-Element-Chunk-1"><span class="level-left"><span class="level-item">3.5.4</span><span class="level-item">End Element Chunk</span></span></a></li><li><a class="level is-mobile" href="#End-Namespace-Chunk-1"><span class="level-left"><span class="level-item">3.5.5</span><span class="level-item">End Namespace Chunk</span></span></a></li></ul></li><li><a class="level is-mobile" href="#XML-文档输出"><span class="level-left"><span class="level-item">3.6</span><span class="level-item">XML 文档输出</span></span></a></li></ul></li><li><a class="level is-mobile" href="#源码"><span class="level-left"><span class="level-item">4</span><span class="level-item">源码</span></span></a></li><li><a class="level is-mobile" href="#参考"><span class="level-left"><span class="level-item">5</span><span class="level-item">参考</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/android-%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/"><span class="level-start"><span class="level-item">Android 实用工具</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/android-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/"><span class="level-start"><span class="level-item">Android 应用开发</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/categories/android-%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/"><span class="level-start"><span class="level-item">Android 系统原理</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/android-%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/"><span class="level-start"><span class="level-item">Android 逆向工程</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3/"><span class="level-start"><span class="level-item">参考文档</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/"><span class="level-start"><span class="level-item">实用工具</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/"><span class="level-start"><span class="level-item">编程基础</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-11-14T16:18:50.000Z">2021-11-15</time></p><p class="title"><a href="/2021/11/15/staruml-%E7%A0%B4%E8%A7%A3%E6%96%B9%E6%B3%95/">StarUML 破解方法</a></p><p class="categories"><a href="/categories/%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/">实用工具</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-11-14T15:59:06.000Z">2021-11-14</time></p><p class="title"><a href="/2021/11/14/android-filter-%E5%88%86%E6%9E%90/">Android Filter 分析</a></p><p class="categories"><a href="/categories/android-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/">Android 应用开发</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-06-29T16:45:50.000Z">2021-06-30</time></p><p class="title"><a href="/2021/06/30/%E6%94%AF%E6%8C%81%E8%A7%A6%E6%91%B8%E6%8B%96%E5%8A%A8%E7%9A%84-touchdelegate/">支持触摸拖动的 TouchDelegate</a></p><p class="categories"><a href="/categories/android-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/">Android 应用开发</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-04-21T15:08:15.000Z">2021-04-21</time></p><p class="title"><a href="/2021/04/21/gdb-arm-%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">GDB ARM 交叉编译环境搭建</a></p><p class="categories"><a href="/categories/android-%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/">Android 实用工具</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-04-21T15:04:39.000Z">2021-04-21</time></p><p class="title"><a href="/2021/04/21/dropbear-android-%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4/">Dropbear Android 安装步骤</a></p><p class="categories"><a href="/categories/android-%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/">Android 实用工具</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2021/11/"><span class="level-start"><span class="level-item">十一月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/06/"><span class="level-start"><span class="level-item">六月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">四月 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/01/"><span class="level-start"><span class="level-item">一月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/11/"><span class="level-start"><span class="level-item">十一月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">十月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/09/"><span class="level-start"><span class="level-item">九月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">七月 2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/06/"><span class="level-start"><span class="level-item">六月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/04/"><span class="level-start"><span class="level-item">四月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/02/"><span class="level-start"><span class="level-item">二月 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/arm/"><span class="tag">ARM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/avd/"><span class="tag">AVD</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/activity/"><span class="tag">Activity</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/android/"><span class="tag">Android</span><span class="tag">24</span></a></div><div class="control"><a class="tags has-addons" href="/tags/assembly/"><span class="tag">Assembly</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/binder/"><span class="tag">Binder</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/classloader/"><span class="tag">ClassLoader</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/computer/"><span class="tag">Computer</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dex/"><span class="tag">Dex</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/elf/"><span class="tag">ELF</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/emulator/"><span class="tag">Emulator</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">Git</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jni/"><span class="tag">JNI</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/java/"><span class="tag">Java</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/log/"><span class="tag">Log</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/make/"><span class="tag">Make</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/makefile/"><span class="tag">Makefile</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/markdown/"><span class="tag">MarkDown</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/metrial/"><span class="tag">Metrial</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ndk/"><span class="tag">NDK</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/regex/"><span class="tag">Regex</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssh/"><span class="tag">SSH</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/theme/"><span class="tag">Theme</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/touch/"><span class="tag">Touch</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/view/"><span class="tag">View</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xposed/"><span class="tag">Xposed</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/zygote/"><span class="tag">Zygote</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/aapt/"><span class="tag">aapt</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/uml/"><span class="tag">uml</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%83%AD%E4%BF%AE%E5%A4%8D/"><span class="tag">热修复</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%83%AD%E6%9B%B4%E6%96%B0/"><span class="tag">热更新</span><span class="tag">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="l0neman 的博客" height="28"></a><p class="is-size-7"><span>&copy; 2021 l0neman</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/l0neman"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>