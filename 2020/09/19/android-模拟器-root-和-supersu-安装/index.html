<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Android 模拟器 Root 和 SuperSU 安装 - l0neman 的博客</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="l0neman 的博客"><meta name="msapplication-TileImage" content="/img/avatar.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="l0neman 的博客"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="前言有时需要在 Android 模拟器上测试特定功能，需要使用到 Root 权限，例如访问某些系统配置、修改系统文件等。通常情况下在 adb shell 的环境下使用 su 命令以 Root 身份执行相关命令即可满足需求，但是还有命令行难以满足的情况，例如给一个第三方应用授予 Root 权限（赋予应用使用 su 命令的权限），如果直接使用命令修改 su 文件权限，使特定应用可以访问，不仅难以控制，"><meta property="og:type" content="blog"><meta property="og:title" content="Android 模拟器 Root 和 SuperSU 安装"><meta property="og:url" content="https://l0neman.github.io/2020/09/19/android-%E6%A8%A1%E6%8B%9F%E5%99%A8-root-%E5%92%8C-supersu-%E5%AE%89%E8%A3%85/"><meta property="og:site_name" content="l0neman 的博客"><meta property="og:description" content="前言有时需要在 Android 模拟器上测试特定功能，需要使用到 Root 权限，例如访问某些系统配置、修改系统文件等。通常情况下在 adb shell 的环境下使用 su 命令以 Root 身份执行相关命令即可满足需求，但是还有命令行难以满足的情况，例如给一个第三方应用授予 Root 权限（赋予应用使用 su 命令的权限），如果直接使用命令修改 su 文件权限，使特定应用可以访问，不仅难以控制，"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://l0neman.github.io/2020/09/19/android-%E6%A8%A1%E6%8B%9F%E5%99%A8-root-%E5%92%8C-supersu-%E5%AE%89%E8%A3%85/1.png"><meta property="og:image" content="https://l0neman.github.io/2020/09/19/android-%E6%A8%A1%E6%8B%9F%E5%99%A8-root-%E5%92%8C-supersu-%E5%AE%89%E8%A3%85/2.png"><meta property="og:image" content="https://l0neman.github.io/2020/09/19/android-%E6%A8%A1%E6%8B%9F%E5%99%A8-root-%E5%92%8C-supersu-%E5%AE%89%E8%A3%85/3.png"><meta property="og:image" content="https://l0neman.github.io/2020/09/19/android-%E6%A8%A1%E6%8B%9F%E5%99%A8-root-%E5%92%8C-supersu-%E5%AE%89%E8%A3%85/4.png"><meta property="og:image" content="https://l0neman.github.io/2020/09/19/android-%E6%A8%A1%E6%8B%9F%E5%99%A8-root-%E5%92%8C-supersu-%E5%AE%89%E8%A3%85/5.png"><meta property="og:image" content="https://l0neman.github.io/2020/09/19/android-%E6%A8%A1%E6%8B%9F%E5%99%A8-root-%E5%92%8C-supersu-%E5%AE%89%E8%A3%85/6.png"><meta property="og:image" content="https://l0neman.github.io/2020/09/19/android-%E6%A8%A1%E6%8B%9F%E5%99%A8-root-%E5%92%8C-supersu-%E5%AE%89%E8%A3%85/7.png"><meta property="og:image" content="https://l0neman.github.io/2020/09/19/android-%E6%A8%A1%E6%8B%9F%E5%99%A8-root-%E5%92%8C-supersu-%E5%AE%89%E8%A3%85/8.png"><meta property="og:image" content="https://l0neman.github.io/2020/09/19/android-%E6%A8%A1%E6%8B%9F%E5%99%A8-root-%E5%92%8C-supersu-%E5%AE%89%E8%A3%85/seq.png"><meta property="article:published_time" content="2020-09-19T14:35:00.000Z"><meta property="article:modified_time" content="2020-09-19T14:35:00.000Z"><meta property="article:author" content="l0neman"><meta property="article:tag" content="Android"><meta property="article:tag" content="Emulator"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="./1.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://l0neman.github.io/2020/09/19/android-%E6%A8%A1%E6%8B%9F%E5%99%A8-root-%E5%92%8C-supersu-%E5%AE%89%E8%A3%85/"},"headline":"Android 模拟器 Root 和 SuperSU 安装","image":["https://l0neman.github.io/2020/09/19/android-%E6%A8%A1%E6%8B%9F%E5%99%A8-root-%E5%92%8C-supersu-%E5%AE%89%E8%A3%85/1.png","https://l0neman.github.io/2020/09/19/android-%E6%A8%A1%E6%8B%9F%E5%99%A8-root-%E5%92%8C-supersu-%E5%AE%89%E8%A3%85/2.png","https://l0neman.github.io/2020/09/19/android-%E6%A8%A1%E6%8B%9F%E5%99%A8-root-%E5%92%8C-supersu-%E5%AE%89%E8%A3%85/3.png","https://l0neman.github.io/2020/09/19/android-%E6%A8%A1%E6%8B%9F%E5%99%A8-root-%E5%92%8C-supersu-%E5%AE%89%E8%A3%85/4.png","https://l0neman.github.io/2020/09/19/android-%E6%A8%A1%E6%8B%9F%E5%99%A8-root-%E5%92%8C-supersu-%E5%AE%89%E8%A3%85/5.png","https://l0neman.github.io/2020/09/19/android-%E6%A8%A1%E6%8B%9F%E5%99%A8-root-%E5%92%8C-supersu-%E5%AE%89%E8%A3%85/6.png","https://l0neman.github.io/2020/09/19/android-%E6%A8%A1%E6%8B%9F%E5%99%A8-root-%E5%92%8C-supersu-%E5%AE%89%E8%A3%85/7.png","https://l0neman.github.io/2020/09/19/android-%E6%A8%A1%E6%8B%9F%E5%99%A8-root-%E5%92%8C-supersu-%E5%AE%89%E8%A3%85/8.png","https://l0neman.github.io/2020/09/19/android-%E6%A8%A1%E6%8B%9F%E5%99%A8-root-%E5%92%8C-supersu-%E5%AE%89%E8%A3%85/seq.png"],"datePublished":"2020-09-19T14:35:00.000Z","dateModified":"2020-09-19T14:35:00.000Z","author":{"@type":"Person","name":"l0neman"},"publisher":{"@type":"Organization","name":"l0neman 的博客","logo":{"@type":"ImageObject","url":"https://l0neman.github.io/img/logo.png"}},"description":"前言有时需要在 Android 模拟器上测试特定功能，需要使用到 Root 权限，例如访问某些系统配置、修改系统文件等。通常情况下在 adb shell 的环境下使用 su 命令以 Root 身份执行相关命令即可满足需求，但是还有命令行难以满足的情况，例如给一个第三方应用授予 Root 权限（赋予应用使用 su 命令的权限），如果直接使用命令修改 su 文件权限，使特定应用可以访问，不仅难以控制，"}</script><link rel="canonical" href="https://l0neman.github.io/2020/09/19/android-%E6%A8%A1%E6%8B%9F%E5%99%A8-root-%E5%92%8C-supersu-%E5%AE%89%E8%A3%85/"><link rel="icon" href="/img/avatar.png"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.15.2/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?1727d76e0a823184efc8776f32a916a9";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="l0neman 的博客" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/l0neman"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-three-quarters"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-09-19T14:35:00.000Z" title="2020/9/19 下午10:35:00">2020-09-19</time>发表</span><span class="level-item"><time dateTime="2020-09-19T14:35:00.000Z" title="2020/9/19 下午10:35:00">2020-09-19</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/android-%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/">Android 实用工具</a></span><span class="level-item">16 分钟读完 (大约2354个字)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">Android 模拟器 Root 和 SuperSU 安装</h1><div class="content"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>有时需要在 Android 模拟器上测试特定功能，需要使用到 Root 权限，例如访问某些系统配置、修改系统文件等。通常情况下在 <code>adb shell</code> 的环境下使用 <code>su</code> 命令以 Root 身份执行相关命令即可满足需求，但是还有命令行难以满足的情况，例如给一个第三方应用授予 Root 权限（赋予应用使用 <code>su</code> 命令的权限），如果直接使用命令修改 <code>su</code> 文件权限，使特定应用可以访问，不仅难以控制，而且可能造成滥用 Root 权限的安全风险。所以需要一个统一管理 Root 权限授予的工具，那么可以使用 SuperSU 工具。</p>
<p>SuperSU 是 Android 系统上著名的 Root 权限管理工具，安装此软件后，可以方便的对 Root 权限进行管理，那么后面安装 Xposed 等依赖 Root 的工具时就很容易了。</p>
<p>在 Android 真机上安装 SuperSU 的方比较容易，只需要获得 Root 权限即可快速安装，在 Android 模拟器上安装略有不同。</p>
<p>下面是在 Android 官方模拟器上获取 Root 权限和安装 SuperSU 的方法。</p>
<span id="more"></span>


<h1 id="环境说明"><a href="#环境说明" class="headerlink" title="环境说明"></a>环境说明</h1><p>使用了如下环境进行操作：</p>
<ul>
<li><p>Android Studio 4.0.1。Android 开发集成环境，方便打开 AVD（Android Virtual Device），创建模拟器</p>
</li>
<li><p>官方模拟器镜像 API 27（Android 8.1）。使用 Android 8.1 是为了安装 Xposed 最新版本</p>
</li>
<li><p>Ubuntu 20.04.1 LTS。使用的操作系统版本</p>
</li>
<li><p>SuperSU 2.8.2。最新的 SuperSU 软件的版本</p>
</li>
</ul>
<p>安装 SuperSU 时首先需要获得 root 权限，如果直接创建默认模拟器虚拟设备，并且直接安装 Supersuer.apk 是不行的，可参考如下详细步骤来进行安装。</p>
<h1 id="安装步骤概述"><a href="#安装步骤概述" class="headerlink" title="安装步骤概述"></a>安装步骤概述</h1><ol>
<li>创建模拟器并获取 root 权限；</li>
<li>设置 SuperSU 所需环境；</li>
<li>安装 Superuser.apk。</li>
</ol>
<h1 id="1-创建模拟器并获取-root-权限"><a href="#1-创建模拟器并获取-root-权限" class="headerlink" title="1. 创建模拟器并获取 root 权限"></a>1. 创建模拟器并获取 root 权限</h1><p>首先从 Android Studio 右上角，点击一个手机右下角有 Android 机器人图标的按钮（AVD Manager），打开 AVD 管理界面。</p>
<p><img src="./1.png"></p>
<p>然后选择 [+ Create Virtual Device] 创建一个 Android 模拟器。</p>
<p>[Hardware] 可随意选择，这里选择 [Pixel 2]，[System Image] 这里选择了 [X86 Images] 中的 <code>Oreo-27-x86-Android 8.1 (Google APIS)</code>（注意：这里一要选择后面有 Google APIS 的镜像，否则不能获取 Root 权限）。</p>
<p><img src="./2.png"></p>
<p>名称这里设置为 <code>suavd</code>。创建后，此时 avd 列表中出现一个名为 <code>suavd</code> 的模拟器。</p>
<p><img src="./3.png"></p>
<p>接下来获取 Root 权限，非常简单，模拟器已经提供了 Root。</p>
<p>在 Shell（Unix、Linux）或 DOS（Windows）中输入如下命令，即可使用 Root 身份进入 Shell：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ adb shell</span><br><span class="line">generic_x86:/ $ su</span><br><span class="line">generic_x86:/ <span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>或者：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ adb root</span><br><span class="line">$ adb shell</span><br><span class="line">generic_x86:/ <span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>提示：如果使用了非 Google APIs 的镜像，进入 <code>adb shell</code> 后将不支持 <code>su</code> 命令；如果输入 <code>adb root</code> 将会出现如下错误提示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb root:</span><br><span class="line">adbd cannot run as root in production builds</span><br></pre></td></tr></table></figure>



<h1 id="2-设置-SuperSU-所需环境"><a href="#2-设置-SuperSU-所需环境" class="headerlink" title="2. 设置 SuperSU 所需环境"></a>2. 设置 SuperSU 所需环境</h1><p>有了 Root 权限，接下来为安装 SuperSU 做准备，SuperSU 本身是一个 Root 权限管理软件，但本身并不具有 Root 权限，要安装它，需要授予它 Root 权限。</p>
<p>SuperSU 包含一个 <code>su</code> 可执行文件和一个 Superuser.apk，只需要把 SuperSU 提供的 <code>su</code> 可执行文件替换系统的 <code>su</code> 文件，并且给予权限 <code>-rwsr-sr-x (6755)</code> 即可。</p>
<p>一般在实际设备上有两种方式替换文件：</p>
<ol>
<li>手动将 SuperSU 的 <code>su</code> 文件替换系统文件，需要 Root 权限；</li>
<li>通过 Recovery 模式直接将 <code>su</code> 文件已补丁包的形式刷入。</li>
</ol>
<p>对于模拟器来说，它没有 Recovery 模式，是直接使用 img 镜像启动的，所以只能使用第一种方法。</p>
<p>首先下载 SuperSU 的相关文件：</p>
<p>在这里下载：<a target="_blank" rel="noopener" href="https://supersuroot.org/download/">https://supersuroot.org/download/</a></p>
<p>选择 <code>Recovery V2.82 Flashable.zip</code> 进行下载，里面包含各个架构所需的 <code>su</code> 文件，以及 Superuser.apk 安装包。</p>
<p>现在查看模拟器原始的 <code>su</code> 文件位置：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">generic_x86:/ <span class="comment"># which su</span></span><br><span class="line">generic_x86:/ <span class="comment"># /system/xbin/su</span></span><br></pre></td></tr></table></figure>


<p>根据模拟器架构（这里是 x86），取出压缩包中的 <code>su.pie</code> 或 <code>su</code> 文件，</p>
<p>这里对于 Android 5.0 版本及之上的设备来说，需要使用 <code>su.pie</code> 文件，它是使用 <code>-fPIE</code> 标记编译的位置无关的可执行文件，具有地址空间随机化特性。</p>
<p>上面已经有了 Root 权限，现在可以进行替换了。</p>
<p>首先打开创建的模拟器 <code>suavd</code>（点击绿色三角形），然后进入并查看模拟器的 <code>su</code> 命令所在的路径：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ adb shell</span><br><span class="line">generic_x86:/ <span class="comment"># which su</span></span><br><span class="line">/system/xbin/su</span><br></pre></td></tr></table></figure>

<p>下面进行替换：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ adb root</span><br><span class="line">$ adb remount</span><br><span class="line">$ adb push su.pie /system/xbin/su</span><br><span class="line">adb: error: failed to copy &#x27;su.pie&#x27; to &#x27;/system/xbin/su&#x27;: remote couldn&#x27;t create file: Read-only file system</span><br></pre></td></tr></table></figure>

<p><code>adb remount</code> 是为了将 <code>/system</code> 挂载为可写。</p>
<p>然而出现了报错，提示 <code>/system</code> 是只读文件系统，无法写入文件。解决办法如下：</p>
<p>关闭模拟器，使用命令行重新启动模拟器，并指定 <code>-writable-system</code> 选项（<code>emulator</code> 程序在 Android SDK 的 <code>emulator</code> 路径中，如果配置了环境变量，可以直接使用 <code>emulator</code> 命令，这里使用了绝对路径）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ~/Android/Sdk/emulator/emulator -avd suavd -writable-system</span><br></pre></td></tr></table></figure>

<p>此时模拟器的 <code>/system</code> 就具备可写属性了，查看模拟器的文件路径（在 <code>~/.android/avd/suavd.avd</code>），会发现一个 <code>system.img.qcow2</code> 文件，它是模拟器的虚拟文件系统，目的是将只读镜像 <code>system.img</code> 具备可写的特性，修改 <code>/system</code> 的内容将被保存在 <code>system.img.qcow2</code> 中。</p>
<p><img src="./4.png"></p>
<p>如果不使用 <code>-writeable-system</code> 选项将不会创建这个文件，那么 <code>/system</code> 也就不可写。</p>
<p>现在重新执行上面的命令即可完成替换：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ adb root</span><br><span class="line">$ adb remount</span><br><span class="line">$ adb push su.pie /system/xbin/su</span><br><span class="line">su.pie: 1 file pushed. 14.1 MB/s (104012 bytes <span class="keyword">in</span> 0.007s)</span><br></pre></td></tr></table></figure>

<p>可以了，接下来按部就班设置 SuperUS：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ adb shell</span><br><span class="line">generic_x86:/ # chmod 6755 /system/xbin/su</span><br><span class="line"></span><br><span class="line">generic_x86:/ # ls -al /system/xbin/su                                         </span><br><span class="line">-rwsr-sr-x 1 root shell 104012 2008-02-29 03:33 /system/xbin/su</span><br><span class="line"></span><br><span class="line">generic_x86:/ # su --install</span><br><span class="line"></span><br><span class="line">generic_x86:/ # su --daemon&amp;                                                   </span><br><span class="line">[1] 3844</span><br><span class="line"></span><br><span class="line">generic_x86:/ # setenforce 0</span><br><span class="line">[1] + Done                 \su --daemon</span><br></pre></td></tr></table></figure>

<p>上面命令解释如下：</p>
<ol>
<li>设置权限，使 SuperSU 提供的 <code>su</code> 可执行文件能够被所有应用执行；</li>
<li>初始化安装 <code>su</code>；</li>
<li>设置 <code>su</code> 守护进程；</li>
<li>关闭 SELinux 安全策略，解除 Root 权限的限制。</li>
</ol>
<p>这样就完成了 SuperSU 环境的设置。</p>
<p>提示：如果高于 Android 5.0 版本使用了 <code>su</code> 文件替换，而不是 <code>su.pie</code> ，将会出现如下情况：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">generic_x86:/ <span class="comment"># su --install</span></span><br><span class="line"><span class="string">&quot;su&quot;</span>: error: Android 5.0 and later only support position-independent executables (-fPIE).</span><br></pre></td></tr></table></figure>



<h1 id="3-安装-SuperSU-App"><a href="#3-安装-SuperSU-App" class="headerlink" title="3. 安装 SuperSU App"></a>3. 安装 SuperSU App</h1><p>在环境设置完毕后，直接安装 Supersuer.apk 即可，在压缩包中 <code>common/Superuser.apk</code> 中。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ adb install Superuser.apk </span><br><span class="line">Success</span><br></pre></td></tr></table></figure>

<p>安装后打开在模拟器中打开，显示如下，则安装成功，如果显示 <code>Root undetected</code>，则安装失败，按照上面步骤进行检查。</p>
<p><img src="./5.png"></p>
<p>这里选择 <code>CANCEL</code> 就可以，如果选择 <code>CONTINUE</code> 更新文件，可能会卡在开机界面导致无法启动系统。</p>
<p>为了保证模拟器下次启动能够正常运行 SuperSU 保证 Root 状态，可以创建一个 Snapshot（快照），点击模拟器右下角的溢出菜单，点击 [TAKE SNAPSHOT]，创建一个快照，重命名为 <code>root</code>。</p>
<p>下次启动模拟器，从这里直接运行快照，将恢复到 Root 时的状态。</p>
<p><img src="./6.png"></p>
<p>注意：再次启动模拟器时，不能从 Android Studio 中的 AVD Manager 直接启动，依然需要使用命令行加 <code>-writable-system</code> 选项启动，因为默认的启动不具备 <code>/system</code> 写权限。</p>
<h1 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h1><p>为了测试 SuperSU 是否可用，这里选择安装 Xposed 框架进行测试。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ adb install XposedInstaller_3.1.5.apk</span><br><span class="line">Success</span><br></pre></td></tr></table></figure>

<p>进入主界面，点击 <code>INSTALL/UPDATE</code> 安装 Xposed 将会出现 Root 授权界面，点击授权后，重启，成功激活 Xposed 框架。</p>
<p><img src="./7.png"></p>
<p><img src="./8.png"></p>
<h1 id="SuperSU-工作原理"><a href="#SuperSU-工作原理" class="headerlink" title="SuperSU 工作原理"></a>SuperSU 工作原理</h1><p>根据开源版本的 superuser 了解 SuperSU 工作原理：</p>
<ol>
<li>daemonsu 为 <code>su</code> 启动的守护进程；</li>
<li>现在第三方应用开始调用 <code>su</code> 命令，请求申请 Root 权限；</li>
<li><code>su</code> 是一个可执行文件，内部与 <code>daemonsu</code> 进行通信，发送执行命令请求；</li>
<li><code>daemonsu</code> 创建 <code>sush</code> 子进程，<code>sush</code> 进程使用 <code>am</code>（Activity Manager）命令启动 Superuser 应用，请求授权，出现用户授权界面；</li>
<li>授权通过，Superuser 应用通过 socket 返回给 <code>sush</code> 用户授权结果，通过授权，则 <code>sush</code> 选择是否执行请求的命令。</li>
</ol>
<p>时序图如下：</p>
<p><img src="./seq.png"></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/cute/p/4095359.html">https://www.cnblogs.com/cute/p/4095359.html</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/5095234/how-to-get-root-access-on-android-emulator">https://stackoverflow.com/questions/5095234/how-to-get-root-access-on-android-emulator</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_39131177/article/details/85060694">https://blog.csdn.net/qq_39131177/article/details/85060694</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/xiaolli/article/details/70154998">https://blog.csdn.net/xiaolli/article/details/70154998</a></p>
</li>
</ul>
</div><div class="article-licensing box"><div class="licensing-title"><p>Android 模拟器 Root 和 SuperSU 安装</p><p><a href="https://l0neman.github.io/2020/09/19/android-模拟器-root-和-supersu-安装/">https://l0neman.github.io/2020/09/19/android-模拟器-root-和-supersu-安装/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>l0neman</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2020-09-19</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2020-09-19</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/android/">Android</a><a class="link-muted mr-2" rel="tag" href="/tags/emulator/">Emulator</a></div><div class="addthis_inline_share_toolbox"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5f0f12c19a2af379" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/img/qrcode/alipay.jpg" alt="支付宝"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/img/qrcode/wxpay.jpg" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/10/11/xposed-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Xposed 实现原理分析</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/09/09/android-dex-%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90/"><span class="level-item">Android Dex 文件解析</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><script src="https://utteranc.es/client.js" repo="l0neman/l0neman.github.io" issue-term="pathname" label="comment" theme="github-light" crossorigin="anonymous" async></script></div></div></div><!--!--><div class="column column-right  order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#前言"><span class="level-left"><span class="level-item">1</span><span class="level-item">前言</span></span></a></li><li><a class="level is-mobile" href="#环境说明"><span class="level-left"><span class="level-item">2</span><span class="level-item">环境说明</span></span></a></li><li><a class="level is-mobile" href="#安装步骤概述"><span class="level-left"><span class="level-item">3</span><span class="level-item">安装步骤概述</span></span></a></li><li><a class="level is-mobile" href="#1-创建模拟器并获取-root-权限"><span class="level-left"><span class="level-item">4</span><span class="level-item">1. 创建模拟器并获取 root 权限</span></span></a></li><li><a class="level is-mobile" href="#2-设置-SuperSU-所需环境"><span class="level-left"><span class="level-item">5</span><span class="level-item">2. 设置 SuperSU 所需环境</span></span></a></li><li><a class="level is-mobile" href="#3-安装-SuperSU-App"><span class="level-left"><span class="level-item">6</span><span class="level-item">3. 安装 SuperSU App</span></span></a></li><li><a class="level is-mobile" href="#测试"><span class="level-left"><span class="level-item">7</span><span class="level-item">测试</span></span></a></li><li><a class="level is-mobile" href="#SuperSU-工作原理"><span class="level-left"><span class="level-item">8</span><span class="level-item">SuperSU 工作原理</span></span></a></li><li><a class="level is-mobile" href="#参考"><span class="level-left"><span class="level-item">9</span><span class="level-item">参考</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/android-%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/"><span class="level-start"><span class="level-item">Android 实用工具</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/android-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/"><span class="level-start"><span class="level-item">Android 应用开发</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/android-%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/"><span class="level-start"><span class="level-item">Android 系统原理</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/android-%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/"><span class="level-start"><span class="level-item">Android 逆向工程</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3/"><span class="level-start"><span class="level-item">参考文档</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/"><span class="level-start"><span class="level-item">实用工具</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/"><span class="level-start"><span class="level-item">编程基础</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-06-29T16:45:50.000Z">2021-06-30</time></p><p class="title"><a href="/2021/06/30/%E6%94%AF%E6%8C%81%E8%A7%A6%E6%91%B8%E6%8B%96%E5%8A%A8%E7%9A%84-touchdelegate/">支持触摸拖动的 TouchDelegate</a></p><p class="categories"><a href="/categories/android-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/">Android 应用开发</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-04-21T15:08:15.000Z">2021-04-21</time></p><p class="title"><a href="/2021/04/21/gdb-arm-%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">GDB ARM 交叉编译环境搭建</a></p><p class="categories"><a href="/categories/android-%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/">Android 实用工具</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-04-21T15:04:39.000Z">2021-04-21</time></p><p class="title"><a href="/2021/04/21/dropbear-android-%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4/">Dropbear Android 安装步骤</a></p><p class="categories"><a href="/categories/android-%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/">Android 实用工具</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-04-21T14:49:48.000Z">2021-04-21</time></p><p class="title"><a href="/2021/04/21/material-design-%E5%8F%82%E8%80%83/">Material Design 参考</a></p><p class="categories"><a href="/categories/%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3/">参考文档</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-04-21T10:20:58.000Z">2021-04-21</time></p><p class="title"><a href="/2021/04/21/android-avd-%E4%BD%8D%E7%BD%AE%E4%BF%AE%E6%94%B9/">Android AVD 位置修改</a></p><p class="categories"><a href="/categories/android-%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/">Android 实用工具</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2021/06/"><span class="level-start"><span class="level-item">六月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">四月 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/01/"><span class="level-start"><span class="level-item">一月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/11/"><span class="level-start"><span class="level-item">十一月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">十月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/09/"><span class="level-start"><span class="level-item">九月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">七月 2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/06/"><span class="level-start"><span class="level-item">六月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/04/"><span class="level-start"><span class="level-item">四月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/02/"><span class="level-start"><span class="level-item">二月 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/arm/"><span class="tag">ARM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/avd/"><span class="tag">AVD</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/activity/"><span class="tag">Activity</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/android/"><span class="tag">Android</span><span class="tag">23</span></a></div><div class="control"><a class="tags has-addons" href="/tags/assembly/"><span class="tag">Assembly</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/binder/"><span class="tag">Binder</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/classloader/"><span class="tag">ClassLoader</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/computer/"><span class="tag">Computer</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dex/"><span class="tag">Dex</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/elf/"><span class="tag">ELF</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/emulator/"><span class="tag">Emulator</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">Git</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jni/"><span class="tag">JNI</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/java/"><span class="tag">Java</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/log/"><span class="tag">Log</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/make/"><span class="tag">Make</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/makefile/"><span class="tag">Makefile</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/markdown/"><span class="tag">MarkDown</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/metrial/"><span class="tag">Metrial</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ndk/"><span class="tag">NDK</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/regex/"><span class="tag">Regex</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssh/"><span class="tag">SSH</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/theme/"><span class="tag">Theme</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/touch/"><span class="tag">Touch</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/view/"><span class="tag">View</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xposed/"><span class="tag">Xposed</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/zygote/"><span class="tag">Zygote</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/aapt/"><span class="tag">aapt</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%83%AD%E4%BF%AE%E5%A4%8D/"><span class="tag">热修复</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%83%AD%E6%9B%B4%E6%96%B0/"><span class="tag">热更新</span><span class="tag">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="l0neman 的博客" height="28"></a><p class="is-size-7"><span>&copy; 2021 l0neman</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/l0neman"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>